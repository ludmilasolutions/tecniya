<!DOCTYPE html>
<html lang="es-AR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TecniYa - Encontr√° t√©cnicos certificados en Argentina</title>
    <meta name="description" content="Plomer√≠a, electricidad, gas, aire acondicionado. T√©cnicos verificados con contacto directo por WhatsApp.">
    
    <!-- Favicon optimizado -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%230a4fd8'/><text x='50' y='70' text-anchor='middle' font-size='60' fill='white'>üîß</text></svg>">
    
    <!-- CSS mejorado -->
    <style>
        /* ===== VARIABLES & RESET ===== */
        :root {
            --primary: #0a4fd8;
            --primary-dark: #083bb5;
            --secondary: #1db954;
            --secondary-dark: #17a344;
            --accent: #ff9800;
            --light: #f8f9fa;
            --dark: #333;
            --gray: #666;
            --light-gray: #e1e5e9;
            --shadow: 0 4px 12px rgba(10, 79, 216, 0.15);
            --radius: 12px;
            --transition: all 0.3s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
        }
        
        /* ===== LAYOUT ===== */
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* ===== HEADER ===== */
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, #1a60f0 100%);
            color: white;
            padding: 2rem 1rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }
        
        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 1rem;
            position: relative;
            z-index: 1;
        }
        
        .logo-icon {
            font-size: 2.5rem;
            background: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            box-shadow: var(--shadow);
        }
        
        .logo-text {
            font-size: 2.8rem;
            font-weight: 800;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        .tagline {
            font-size: 1.2rem;
            opacity: 0.95;
            max-width: 600px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }
        
        /* ===== BANNER ===== */
        .banner-container {
            margin: 2rem auto;
            max-width: 900px;
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: 0 8px 30px rgba(0,0,0,0.12);
            transition: var(--transition);
            background: white;
            min-height: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .banner-container:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.15);
        }
        
        .banner-content {
            width: 100%;
            text-align: center;
        }
        
        .banner-img {
            width: 100%;
            height: auto;
            display: block;
            border-radius: var(--radius);
        }
        
        .banner-link {
            display: block;
            width: 100%;
            height: 100%;
        }
        
        /* ===== SEARCH SECTION ===== */
        .search-section {
            background: white;
            border-radius: var(--radius);
            padding: 2.5rem;
            margin: 2rem auto;
            max-width: 800px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(10, 79, 216, 0.1);
        }
        
        .search-title {
            font-size: 1.8rem;
            color: var(--primary);
            margin-bottom: 1.5rem;
            text-align: center;
            font-weight: 700;
        }
        
        .search-grid {
            display: grid;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        @media (min-width: 768px) {
            .search-grid {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        .form-group {
            position: relative;
        }
        
        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--dark);
            font-size: 0.95rem;
        }
        
        .form-select {
            width: 100%;
            padding: 1rem;
            border: 2px solid var(--light-gray);
            border-radius: 10px;
            font-size: 1rem;
            background: white;
            transition: var(--transition);
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%230a4fd8' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: 16px;
        }
        
        .form-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(10, 79, 216, 0.1);
        }
        
        /* ===== BUTTONS ===== */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 1rem 2rem;
            border-radius: 10px;
            font-weight: 600;
            font-size: 1.1rem;
            border: none;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.5);
            opacity: 0;
            border-radius: 100%;
            transform: scale(1, 1) translate(-50%);
            transform-origin: 50% 50%;
        }
        
        .btn:focus:not(:active)::after {
            animation: ripple 1s ease-out;
        }
        
        @keyframes ripple {
            0% {
                transform: scale(0, 0);
                opacity: 0.5;
            }
            100% {
                transform: scale(20, 20);
                opacity: 0;
            }
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, #1a60f0 100%);
            color: white;
            width: 100%;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, var(--primary-dark) 0%, #0a4fd8 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(10, 79, 216, 0.3);
        }
        
        .btn-whatsapp {
            background: linear-gradient(135deg, #1db954 0%, #17a344 100%);
            color: white;
            padding: 0.8rem 1.5rem;
        }
        
        .btn-whatsapp:hover {
            background: linear-gradient(135deg, #17a344 0%, #128c3a 100%);
            transform: translateY(-2px);
        }
        
        /* ===== STATS ===== */
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 2rem auto;
            max-width: 800px;
        }
        
        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: var(--radius);
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            transition: var(--transition);
        }
        
        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }
        
        .stat-label {
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        /* ===== RESULTS ===== */
        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 2rem 0 1rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--light-gray);
        }
        
        .results-count {
            font-weight: 600;
            color: var(--primary);
        }
        
        .professional-grid {
            display: grid;
            gap: 1.5rem;
            margin: 2rem 0;
        }
        
        @media (min-width: 768px) {
            .professional-grid {
                grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            }
        }
        
        .professional-card {
            background: white;
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: 0 6px 20px rgba(0,0,0,0.08);
            transition: var(--transition);
            position: relative;
            border: 1px solid rgba(10, 79, 216, 0.1);
        }
        
        .professional-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(0,0,0,0.12);
        }
        
        .professional-featured {
            position: absolute;
            top: 15px;
            right: 15px;
            background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%);
            color: #333;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            z-index: 2;
            box-shadow: 0 2px 8px rgba(255, 152, 0, 0.3);
        }
        
        .professional-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--light-gray);
            display: flex;
            gap: 1rem;
            align-items: center;
        }
        
        .professional-photo {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--primary);
            flex-shrink: 0;
        }
        
        .professional-info {
            flex: 1;
        }
        
        .professional-name {
            font-size: 1.3rem;
            color: var(--dark);
            margin-bottom: 0.3rem;
            font-weight: 700;
        }
        
        .professional-rating {
            display: flex;
            align-items: center;
            gap: 5px;
            color: var(--accent);
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .professional-body {
            padding: 1.5rem;
        }
        
        .professional-services {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 1rem;
        }
        
        .service-tag {
            background: #f1f6ff;
            color: var(--primary);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .professional-footer {
            padding: 1rem 1.5rem;
            background: #f8f9fa;
            border-top: 1px solid var(--light-gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        /* ===== LOADER ===== */
        .loader {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 3rem;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* ===== MESSAGES ===== */
        .message {
            padding: 1.5rem;
            border-radius: var(--radius);
            margin: 1rem 0;
            text-align: center;
            font-weight: 600;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .message-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .message-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .message-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        /* ===== FOOTER ===== */
        .footer {
            background: var(--dark);
            color: #aaa;
            padding: 3rem 1rem;
            margin-top: 4rem;
        }
        
        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            gap: 2rem;
        }
        
        @media (min-width: 768px) {
            .footer-content {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        .footer-section h3 {
            color: white;
            margin-bottom: 1rem;
            font-size: 1.2rem;
        }
        
        .footer-links {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }
        
        .footer-links a {
            color: #aaa;
            text-decoration: none;
            transition: var(--transition);
        }
        
        .footer-links a:hover {
            color: white;
            padding-left: 5px;
        }
        
        .copyright {
            text-align: center;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid #444;
            color: #777;
            font-size: 0.9rem;
        }
        
        /* ===== RESPONSIVE ===== */
        @media (max-width: 768px) {
            .logo {
                flex-direction: column;
                text-align: center;
            }
            
            .logo-text {
                font-size: 2rem;
            }
            
            .search-section {
                padding: 1.5rem;
            }
            
            .professional-header {
                flex-direction: column;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <!-- HEADER -->
    <header class="header">
        <div class="container">
            <div class="logo">
                <div class="logo-icon">üîß</div>
                <h1 class="logo-text">TecniYa</h1>
            </div>
            <p class="tagline">Encontr√° t√©cnicos certificados en toda Argentina. Contacto directo por WhatsApp.</p>
        </div>
    </header>

    <!-- STATS -->
    <section class="container stats" id="statsContainer">
        <!-- Se llena din√°micamente -->
    </section>

    <!-- BANNER -->
    <div class="container banner-container" id="bannerContainer">
        <div class="banner-content" id="bannerContent">
            <!-- Banner se cargar√° aqu√≠ -->
        </div>
    </div>

    <!-- SEARCH -->
    <section class="container search-section">
        <h2 class="search-title">¬øQu√© servicio necesit√°s?</h2>
        <div class="search-grid">
            <div class="form-group">
                <label class="form-label">Provincia</label>
                <select id="provinciaSelect" class="form-select">
                    <option value="">Seleccion√° una provincia</option>
                    <!-- Se llena din√°micamente -->
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">Ciudad</label>
                <select id="ciudadSelect" class="form-select" disabled>
                    <option value="">Seleccion√° primero una provincia</option>
                </select>
            </div>
        </div>
        <div class="search-grid">
            <div class="form-group">
                <label class="form-label">Zona/Barrio</label>
                <select id="zonaSelect" class="form-select" disabled>
                    <option value="">Seleccion√° primero una ciudad</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">Rubro</label>
                <select id="rubroSelect" class="form-select">
                    <option value="">Todos los rubros</option>
                    <option value="plomeria">Plomer√≠a</option>
                    <option value="gas">Gas</option>
                    <option value="electricidad">Electricidad</option>
                    <option value="aire">Aire acondicionado</option>
                    <option value="albanileria">Alba√±iler√≠a</option>
                    <option value="pintura">Pintura</option>
                    <option value="cerrajeria">Cerrajer√≠a</option>
                    <option value="jardineria">Jardiner√≠a</option>
                    <option value="herreria">Herrer√≠a</option>
                    <option value="carpinteria">Carpinter√≠a</option>
                    <option value="limpieza">Limpieza</option>
                    <option value="mudanzas">Mudanzas</option>
                    <option value="otros">Otros servicios</option>
                </select>
            </div>
        </div>
        <button id="searchBtn" class="btn btn-primary">
            üîç Buscar t√©cnico
        </button>
    </section>

    <!-- RESULTS -->
    <section class="container">
        <div class="results-header" id="resultsHeader" style="display: none;">
            <h2>T√©cnicos Disponibles</h2>
            <span class="results-count" id="resultsCount"></span>
        </div>
        <div class="loader" id="loader" style="display: none;">
            <div class="spinner"></div>
        </div>
        <div class="professional-grid" id="resultsContainer"></div>
    </section>

    <!-- FOOTER -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>TecniYa</h3>
                <p>Conectamos a los argentinos con t√©cnicos certificados. R√°pido, seguro y confiable.</p>
            </div>
            <div class="footer-section">
                <h3>Enlaces</h3>
                <div class="footer-links">
                    <a href="#" onclick="alert('P√°gina de registro en desarrollo')">Registrate como Profesional</a>
                    <a href="admin.html">Panel de Administraci√≥n</a>
                    <a href="#legal">T√©rminos y Condiciones</a>
                    <a href="#privacidad">Pol√≠tica de Privacidad</a>
                </div>
            </div>
            <div class="footer-section">
                <h3>Contacto</h3>
                <p>Argentina</p>
                <p>contacto@tecniya.com</p>
            </div>
        </div>
        <div class="copyright">
            <p>¬© 2024 TecniYa - Todos los derechos reservados</p>
            <p><small>No realizamos trabajos. Conectamos clientes con profesionales.</small></p>
        </div>
    </footer>

    <!-- SCRIPTS -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    
    <script>
        // ============================================
        // CONFIGURACI√ìN FIREBASE
        // ============================================
        const firebaseConfig = {
            apiKey: "AIzaSyBzDfYDdzmN9J_Y8gG06aqH0OtlzFhafFY",
            authDomain: "tecniya-b4206.firebaseapp.com",
            projectId: "tecniya-b4206",
            storageBucket: "tecniya-b4206.firebasestorage.app",
            messagingSenderId: "166424133304",
            appId: "1:166424133304:web:d1ad23bd4ea1af10437e4d"
        };

        // ============================================
        // DATOS DE PROVINCIAS Y CIUDADES
        // ============================================
        const provinciasCiudades = {
            "Buenos Aires": ["La Plata", "Mar del Plata", "Bah√≠a Blanca", "Quilmes", "Lomas de Zamora", "San Isidro", "Tigre", "Pilar", "Merlo", "Moreno", "San Mart√≠n", "Mor√≥n", "Avellaneda", "Lan√∫s", "San Miguel", "Malvinas Argentinas", "Vicente L√≥pez", "Tres de Febrero", "Ituzaing√≥", "Hurlingham"],
            "CABA": ["Capital Federal"],
            "Catamarca": ["San Fernando del Valle de Catamarca", "Valle Viejo", "Andalgal√°", "Bel√©n", "Santa Mar√≠a"],
            "Chaco": ["Resistencia", "Barranqueras", "Fontana", "Presidencia Roque S√°enz Pe√±a", "Villa √Ångela"],
            "Chubut": ["Rawson", "Comodoro Rivadavia", "Trelew", "Puerto Madryn", "Esquel"],
            "C√≥rdoba": ["C√≥rdoba", "Villa Mar√≠a", "R√≠o Cuarto", "Alta Gracia", "Villa Carlos Paz", "Jes√∫s Mar√≠a", "Cosqu√≠n", "La Falda", "Villa General Belgrano", "Mina Clavero"],
            "Corrientes": ["Corrientes", "Goya", "Mercedes", "Curuz√∫ Cuati√°", "Paso de los Libres"],
            "Entre R√≠os": ["Paran√°", "Concordia", "Gualeguaych√∫", "Concepci√≥n del Uruguay", "Victoria", "Col√≥n", "Villaguay"],
            "Formosa": ["Formosa", "Clorinda", "Piran√©"],
            "Jujuy": ["San Salvador de Jujuy", "Palpal√°", "San Pedro de Jujuy", "Libertador General San Mart√≠n", "Perico"],
            "La Pampa": ["Santa Rosa", "General Pico", "Toay", "Realic√≥"],
            "La Rioja": ["La Rioja", "Chilecito", "Aimogasta", "Chamical"],
            "Mendoza": ["Mendoza", "San Rafael", "Godoy Cruz", "Guaymall√©n", "Las Heras", "Maip√∫", "Luj√°n de Cuyo", "Tunuy√°n", "San Mart√≠n", "Rivadavia"],
            "Misiones": ["Posadas", "Ober√°", "Eldorado", "Ap√≥stoles", "Puerto Iguaz√∫"],
            "Neuqu√©n": ["Neuqu√©n", "Cutral-C√≥", "Plottier", "Centenario", "San Mart√≠n de los Andes"],
            "R√≠o Negro": ["Viedma", "Bariloche", "General Roca", "Cipolletti", "Allen", "El Bols√≥n"],
            "Salta": ["Salta", "San Ram√≥n de la Nueva Or√°n", "Tartagal", "Met√°n", "Cafayate", "Cerrillos", "Rosario de Lerma"],
            "San Juan": ["San Juan", "Rivadavia", "Chimbas", "Rawson", "Pocito", "Caucete"],
            "San Luis": ["San Luis", "Villa Mercedes", "Juana Koslay", "La Punta", "Merlo"],
            "Santa Cruz": ["R√≠o Gallegos", "Caleta Olivia", "Puerto Deseado", "R√≠o Turbio", "El Calafate"],
            "Santa Fe": ["Rosario", "Santa Fe", "Rafaela", "Venado Tuerto", "Reconquista", "Sunchales", "Villa Gobernador G√°lvez", "Granadero Baigorria", "Capit√°n Berm√∫dez", "Funes", "Rold√°n", "San Lorenzo", "San Javier", "Esperanza"],
            "Santiago del Estero": ["Santiago del Estero", "La Banda", "Fr√≠as", "A√±atuya", "Termas de R√≠o Hondo"],
            "Tierra del Fuego": ["Ushuaia", "R√≠o Grande"],
            "Tucum√°n": ["San Miguel de Tucum√°n", "Yerba Buena", "Taf√≠ Viejo", "Concepci√≥n", "Monteros", "Famaill√°"]
        };

        const ciudadesZonas = {
            "Rosario": ["Centro", "Norte", "Sur", "Oeste", "NorOeste", "Echesortu", "Fisherton", "Alberdi", "Arroyito", "Rep√∫blica de la Sexta", "La Florida", "Alto Rosario", "Toda la ciudad"],
            "C√≥rdoba": ["Centro", "Nueva C√≥rdoba", "Alberdi", "G√ºemes", "Cerro de las Rosas", "Alta C√≥rdoba", "General Paz", "Jard√≠n", "Urca", "Arg√ºello", "Toda la ciudad"],
            "Mendoza": ["Centro", "Godoy Cruz", "Guaymall√©n", "Las Heras", "Maip√∫", "Chacras de Coria", "General Guti√©rrez", "Toda la ciudad"],
            "La Plata": ["Centro", "City Bell", "Gonnet", "Ringuelet", "Tolosa", "Los Hornos", "Villa Elisa", "Toda la ciudad"],
            "Mar del Plata": ["Centro", "La Perla", "Bristol", "Playa Grande", "Altafulla", "Las Toscas", "Toda la ciudad"],
            "Bah√≠a Blanca": ["Centro", "Ingeniero White", "Villa Mitre", "Villa Rosas", "Villa Harding Green", "Toda la ciudad"],
            "Salta": ["Centro", "Norte", "Sur", "Oeste", "Cerritos", "Toda la ciudad"],
            "San Miguel de Tucum√°n": ["Centro", "Norte", "Sur", "Oeste", "Yerba Buena", "Toda la ciudad"],
            "San Juan": ["Centro", "Rivadavia", "Chimbas", "Rawson", "Toda la ciudad"],
            "Santa Fe": ["Centro", "Norte", "Sur", "Oeste", "Toda la ciudad"],
            "Paran√°": ["Centro", "Norte", "Sur", "Oeste", "Toda la ciudad"],
            "Resistencia": ["Centro", "Norte", "Sur", "Oeste", "Toda la ciudad"],
            "Corrientes": ["Centro", "Norte", "Sur", "Oeste", "Toda la ciudad"],
            "Posadas": ["Centro", "Norte", "Sur", "Oeste", "Toda la ciudad"],
            "Neuqu√©n": ["Centro", "Norte", "Sur", "Oeste", "Toda la ciudad"],
            "Bariloche": ["Centro", "Cerro Catedral", "Llao Llao", "Melipal", "Toda la ciudad"],
            "Ushuaia": ["Centro", "Andorra", "La Cantera", "Malvinas Argentinas", "Toda la ciudad"],
            "Comodoro Rivadavia": ["Centro", "Norte", "Sur", "Oeste", "Toda la ciudad"],
            "Trelew": ["Centro", "Norte", "Sur", "Oeste", "Toda la ciudad"],
            "Rawson": ["Centro", "Playa Uni√≥n", "Toda la ciudad"],
            "Villa Mar√≠a": ["Centro", "Norte", "Sur", "Oeste", "Toda la ciudad"],
            "R√≠o Cuarto": ["Centro", "Norte", "Sur", "Oeste", "Toda la ciudad"],
            "San Rafael": ["Centro", "Norte", "Sur", "Oeste", "Toda la ciudad"],
            "San Luis": ["Centro", "Norte", "Sur", "Oeste", "Toda la ciudad"],
            "Villa Mercedes": ["Centro", "Norte", "Sur", "Oeste", "Toda la ciudad"],
            "Jujuy": ["Centro", "Norte", "Sur", "Oeste", "Toda la ciudad"],
            "Formosa": ["Centro", "Norte", "Sur", "Oeste", "Toda la ciudad"],
            "La Rioja": ["Centro", "Norte", "Sur", "Oeste", "Toda la ciudad"],
            "Catamarca": ["Centro", "Norte", "Sur", "Oeste", "Toda la ciudad"],
            "Santiago del Estero": ["Centro", "Norte", "Sur", "Oeste", "Toda la ciudad"]
        };

        // ============================================
        // INICIALIZACI√ìN
        // ============================================
        let db;

        document.addEventListener('DOMContentLoaded', async () => {
            await initFirebase();
            initApp();
        });

        async function initFirebase() {
            try {
                if (!firebase.apps.length) {
                    firebase.initializeApp(firebaseConfig);
                    console.log('Firebase inicializado correctamente');
                }
                
                db = firebase.firestore();
                
            } catch (error) {
                console.error('Error inicializando Firebase:', error);
                showMessage('Error de conexi√≥n. Por favor, recarg√° la p√°gina.', 'error');
            }
        }

        function initApp() {
            if (!db) {
                console.error('Firestore no disponible');
                return;
            }
            
            // Cargar datos geogr√°ficos
            loadProvincias();
            
            // Establecer Santa Fe/Rosario como predeterminada
            setTimeout(() => {
                setRosarioDefault();
            }, 500);
            
            // Cargar estad√≠sticas
            loadStats();
            
            // Cargar banner inicial
            loadBanner();
            
            // Configurar eventos
            document.getElementById('searchBtn').addEventListener('click', searchProfessionals);
            document.getElementById('provinciaSelect').addEventListener('change', handleProvinciaChange);
            document.getElementById('ciudadSelect').addEventListener('change', handleCiudadChange);
            document.getElementById('rubroSelect').addEventListener('change', loadBanner);
        }

        // ============================================
        // FUNCIONES PRINCIPALES
        // ============================================
        function loadProvincias() {
            const provinciaSelect = document.getElementById('provinciaSelect');
            
            // Ordenar provincias alfab√©ticamente
            const provinciasOrdenadas = Object.keys(provinciasCiudades).sort();
            
            provinciasOrdenadas.forEach(provincia => {
                const option = document.createElement('option');
                option.value = provincia;
                option.textContent = provincia;
                provinciaSelect.appendChild(option);
            });
        }

        function setRosarioDefault() {
            const provinciaSelect = document.getElementById('provinciaSelect');
            const ciudadSelect = document.getElementById('ciudadSelect');
            const zonaSelect = document.getElementById('zonaSelect');
            
            // Establecer Santa Fe como provincia predeterminada
            provinciaSelect.value = "Santa Fe";
            
            // Cargar ciudades de Santa Fe
            const ciudades = provinciasCiudades["Santa Fe"];
            ciudadSelect.innerHTML = '<option value="">Seleccion√° una ciudad</option>';
            ciudades.forEach(ciudad => {
                const option = document.createElement('option');
                option.value = ciudad;
                option.textContent = ciudad;
                if (ciudad === "Rosario") option.selected = true;
                ciudadSelect.appendChild(option);
            });
            ciudadSelect.disabled = false;
            
            // Cargar zonas de Rosario
            const zonas = ciudadesZonas["Rosario"] || ["Centro", "Norte", "Sur", "Oeste", "Toda la ciudad"];
            zonaSelect.innerHTML = '<option value="">Seleccion√° una zona</option>';
            zonas.forEach(zona => {
                const option = document.createElement('option');
                option.value = zona.toLowerCase().replace(/ /g, '_');
                option.textContent = zona;
                zonaSelect.appendChild(option);
            });
            zonaSelect.disabled = false;
        }

        function handleProvinciaChange() {
            const provincia = this.value;
            const ciudadSelect = document.getElementById('ciudadSelect');
            const zonaSelect = document.getElementById('zonaSelect');
            
            if (!provincia) {
                ciudadSelect.innerHTML = '<option value="">Seleccion√° primero una provincia</option>';
                ciudadSelect.disabled = true;
                zonaSelect.innerHTML = '<option value="">Seleccion√° primero una ciudad</option>';
                zonaSelect.disabled = true;
                return;
            }
            
            // Cargar ciudades de la provincia seleccionada
            const ciudades = provinciasCiudades[provincia] || [];
            ciudadSelect.innerHTML = '<option value="">Seleccion√° una ciudad</option>';
            
            ciudades.forEach(ciudad => {
                const option = document.createElement('option');
                option.value = ciudad;
                option.textContent = ciudad;
                ciudadSelect.appendChild(option);
            });
            
            ciudadSelect.disabled = false;
            zonaSelect.innerHTML = '<option value="">Seleccion√° primero una ciudad</option>';
            zonaSelect.disabled = true;
        }

        function handleCiudadChange() {
            const ciudad = this.value;
            const zonaSelect = document.getElementById('zonaSelect');
            
            if (!ciudad) {
                zonaSelect.innerHTML = '<option value="">Seleccion√° primero una ciudad</option>';
                zonaSelect.disabled = true;
                return;
            }
            
            // Cargar zonas de la ciudad seleccionada
            const zonas = ciudadesZonas[ciudad] || ["Centro", "Norte", "Sur", "Oeste", "Toda la ciudad"];
            zonaSelect.innerHTML = '<option value="">Seleccion√° una zona</option>';
            
            zonas.forEach(zona => {
                const option = document.createElement('option');
                option.value = zona.toLowerCase().replace(/ /g, '_');
                option.textContent = zona;
                zonaSelect.appendChild(option);
            });
            
            zonaSelect.disabled = false;
        }

        async function loadStats() {
            try {
                const statsRef = db.collection('stats').doc('global');
                const doc = await statsRef.get();
                
                const statsContainer = document.getElementById('statsContainer');
                
                if (doc.exists) {
                    const data = doc.data();
                    statsContainer.innerHTML = `
                        <div class="stat-card">
                            <div class="stat-number">${data.totalProfessionals || '500+'}</div>
                            <div class="stat-label">T√©cnicos Activos</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${data.totalJobs || '5000+'}</div>
                            <div class="stat-label">Trabajos Realizados</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${data.avgRating || '4.8'}/5</div>
                            <div class="stat-label">Rating Promedio</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">24h</div>
                            <div class="stat-label">Respuesta R√°pida</div>
                        </div>
                    `;
                } else {
                    // Estad√≠sticas por defecto
                    statsContainer.innerHTML = `
                        <div class="stat-card">
                            <div class="stat-number">500+</div>
                            <div class="stat-label">T√©cnicos Activos</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">5000+</div>
                            <div class="stat-label">Trabajos Realizados</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">4.8/5</div>
                            <div class="stat-label">Rating Promedio</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">24h</div>
                            <div class="stat-label">Respuesta R√°pida</div>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error cargando estad√≠sticas:', error);
            }
        }

        async function loadBanner() {
            try {
                const provincia = document.getElementById('provinciaSelect').value;
                const ciudad = document.getElementById('ciudadSelect').value;
                const rubro = document.getElementById('rubroSelect').value;
                
                console.log('Cargando banner para:', { provincia, ciudad, rubro });
                
                const bannerContainer = document.getElementById('bannerContent');
                
                if (!provincia || !ciudad) {
                    bannerContainer.innerHTML = `
                        <div style="padding: 3rem; text-align: center; color: #666;">
                            <h3>üîß TecniYa Argentina</h3>
                            <p>Seleccion√° tu ubicaci√≥n para ver t√©cnicos disponibles</p>
                        </div>
                    `;
                    return;
                }
                
                // Mostrar banner de carga
                bannerContainer.innerHTML = `
                    <div style="padding: 2rem; text-align: center;">
                        <div class="spinner" style="width: 40px; height: 40px; margin: 0 auto;"></div>
                        <p style="margin-top: 1rem; color: #666;">Cargando banner...</p>
                    </div>
                `;
                
                const now = new Date();
                console.log('Fecha actual:', now);
                
                // Buscar TODOS los banners activos (sin filtros iniciales)
                let bannersSnapshot = await db.collection('banners').get();
                
                console.log('Total de banners en la base de datos:', bannersSnapshot.size);
                
                if (bannersSnapshot.empty) {
                    console.log('No hay banners en la base de datos');
                    // Mostrar banner por defecto
                    bannerContainer.innerHTML = `
                        <div style="padding: 3rem; text-align: center; color: white; background: linear-gradient(135deg, #0a4fd8 0%, #1a60f0 100%); border-radius: 12px;">
                            <h3 style="margin-bottom: 1rem;">üîß TecniYa Argentina</h3>
                            <p>Conectamos clientes con t√©cnicos certificados</p>
                            <p style="margin-top: 1rem; font-size: 0.9rem; opacity: 0.9;">Publicit√° tu negocio aqu√≠</p>
                        </div>
                    `;
                    return;
                }
                
                // Filtrar banners manualmente
                const banners = [];
                bannersSnapshot.forEach(doc => {
                    const banner = { id: doc.id, ...doc.data() };
                    
                    console.log('Procesando banner:', banner.title, {
                        active: banner.active,
                        provincia: banner.provincia,
                        ciudad: banner.ciudad,
                        rubros: banner.rubros,
                        startDate: banner.startDate,
                        endDate: banner.endDate
                    });
                    
                    // Verificar que est√© activo
                    if (!banner.active) {
                        console.log('Banner no activo:', banner.title);
                        return;
                    }
                    
                    // Verificar fecha
                    const startDate = banner.startDate ? banner.startDate.toDate() : null;
                    const endDate = banner.endDate ? banner.endDate.toDate() : null;
                    
                    if (!startDate || !endDate) {
                        console.log('Banner sin fechas v√°lidas:', banner.title);
                        return;
                    }
                    
                    if (startDate > now) {
                        console.log('Banner con fecha de inicio en el futuro:', banner.title, startDate);
                        return;
                    }
                    
                    if (endDate < now) {
                        console.log('Banner con fecha de fin en el pasado:', banner.title, endDate);
                        return;
                    }
                    
                    // Verificar ubicaci√≥n
                    let pasaUbicacion = false;
                    
                    if (banner.provincia === 'toda') {
                        // Banner nacional - pasa para cualquier provincia
                        pasaUbicacion = true;
                        console.log('Banner nacional - pasa ubicaci√≥n');
                    } else if (banner.provincia === provincia) {
                        // Misma provincia
                        if (banner.ciudad === 'toda') {
                            // Toda la provincia
                            pasaUbicacion = true;
                            console.log('Banner provincial - pasa ubicaci√≥n');
                        } else if (banner.ciudad === ciudad) {
                            // Misma ciudad
                            pasaUbicacion = true;
                            console.log('Banner local - pasa ubicaci√≥n');
                        }
                    }
                    
                    if (!pasaUbicacion) {
                        console.log('Banner no pasa por ubicaci√≥n:', banner.title);
                        return;
                    }
                    
                    // Verificar rubro
                    if (rubro && rubro !== '') {
                        if (!banner.rubros || !Array.isArray(banner.rubros)) {
                            console.log('Banner sin rubros definidos:', banner.title);
                            return;
                        }
                        
                        // Verificar si el banner aplica para "todos" los rubros o para este rubro espec√≠fico
                        if (!banner.rubros.includes('todos') && !banner.rubros.includes(rubro)) {
                            console.log('Banner no pasa por rubro:', banner.title, 'rubros:', banner.rubros, 'rubro buscado:', rubro);
                            return;
                        }
                    }
                    
                    console.log('¬°Banner v√°lido encontrado!:', banner.title);
                    banners.push(banner);
                });
                
                console.log('Banners v√°lidos despu√©s de filtrar:', banners.length);
                
                if (banners.length === 0) {
                    // Mostrar banner por defecto
                    bannerContainer.innerHTML = `
                        <div style="padding: 3rem; text-align: center; color: white; background: linear-gradient(135deg, #0a4fd8 0%, #1a60f0 100%); border-radius: 12px;">
                            <h3 style="margin-bottom: 1rem;">üîß TecniYa Argentina</h3>
                            <p>Conectamos clientes con t√©cnicos certificados en ${ciudad}</p>
                        </div>
                    `;
                    return;
                }
                
                // Ordenar por prioridad (mayor primero)
                banners.sort((a, b) => (b.priority || 5) - (a.priority || 5));
                
                // Tomar el banner con mayor prioridad
                const selectedBanner = banners[0];
                console.log('Banner seleccionado:', selectedBanner.title, 'prioridad:', selectedBanner.priority);
                
                // Crear contenedor del banner
                bannerContainer.innerHTML = `
                    <a href="${selectedBanner.link}" target="_blank" class="banner-link" id="bannerLink">
                        <img src="${selectedBanner.imageUrl}" 
                             alt="${selectedBanner.title || 'Banner'}" 
                             class="banner-img"
                             onerror="this.onerror=null; this.src='https://via.placeholder.com/900x300/0a4fd8/ffffff?text=BANNER+TECNIYA'">
                    </a>
                `;
                
                // Registrar clic en el banner
                const bannerLink = document.getElementById('bannerLink');
                bannerLink.addEventListener('click', async () => {
                    try {
                        await db.collection('ads_clicks').add({
                            bannerId: selectedBanner.id,
                            bannerTitle: selectedBanner.title,
                            provincia: provincia,
                            ciudad: ciudad,
                            rubro: rubro,
                            clickedAt: firebase.firestore.FieldValue.serverTimestamp(),
                            userAgent: navigator.userAgent,
                            timestamp: new Date().toISOString()
                        });
                        console.log('Clic registrado para banner:', selectedBanner.title);
                    } catch (error) {
                        console.error('Error registrando clic:', error);
                    }
                });
                
            } catch (error) {
                console.error('Error cargando banner:', error);
                const bannerContainer = document.getElementById('bannerContent');
                bannerContainer.innerHTML = `
                    <div style="padding: 3rem; text-align: center; color: white; background: linear-gradient(135deg, #0a4fd8 0%, #1a60f0 100%); border-radius: 12px;">
                        <h3 style="margin-bottom: 1rem;">üîß TecniYa Argentina</h3>
                        <p>Encontr√° t√©cnicos certificados en tu ciudad</p>
                    </div>
                `;
            }
        }

        async function searchProfessionals() {
            const provincia = document.getElementById('provinciaSelect').value;
            const ciudad = document.getElementById('ciudadSelect').value;
            const zona = document.getElementById('zonaSelect').value;
            const rubro = document.getElementById('rubroSelect').value;
            
            if (!provincia || !ciudad) {
                showMessage('Por favor seleccion√° provincia y ciudad para buscar.', 'error');
                return;
            }
            
            const loader = document.getElementById('loader');
            const resultsContainer = document.getElementById('resultsContainer');
            const resultsHeader = document.getElementById('resultsHeader');
            const resultsCount = document.getElementById('resultsCount');
            
            loader.style.display = 'flex';
            resultsContainer.innerHTML = '';
            resultsHeader.style.display = 'none';
            
            try {
                // Construir consulta base
                let query = db.collection('professionals')
                    .where('profileCompleted', '==', true)
                    .where('blocked', '==', false)
                    .where('provincia', '==', provincia)
                    .where('ciudad', '==', ciudad);
                
                if (rubro && rubro !== '') {
                    query = query.where('rubros', 'array-contains', rubro);
                }
                
                const snapshot = await query.get();
                
                if (snapshot.empty) {
                    showMessage('No se encontraron t√©cnicos para tu b√∫squeda.', 'info');
                    return;
                }
                
                // Filtrar y ordenar
                const professionals = [];
                const now = new Date();
                
                snapshot.forEach(doc => {
                    const prof = { id: doc.id, ...doc.data() };
                    
                    // Filtrar por zona
                    if (zona && zona !== '' && zona !== 'toda_la_ciudad' && prof.zonas) {
                        const zonasProf = prof.zonas.map(z => z.toLowerCase().replace(/ /g, '_'));
                        if (!zonasProf.includes(zona)) {
                            return;
                        }
                    }
                    
                    // Calcular score para ranking
                    let score = 0;
                    score += (prof.rating || 0) * 10;
                    score += (prof.jobsCompleted || 0) * 2;
                    
                    // Destacados activos
                    if (prof.isFeatured && prof.featuredUntil && prof.featuredUntil.toDate() > now) {
                        score += 100;
                        prof.isFeaturedActive = true;
                    }
                    
                    // Actividad reciente
                    if (prof.lastActive) {
                        const days = (now - prof.lastActive.toDate()) / (1000 * 60 * 60 * 24);
                        if (days < 7) score += 5;
                    }
                    
                    // Certificaciones
                    if (prof.certified) score += 20;
                    
                    // Perfil completo
                    if (prof.profileCompleted) score += 10;
                    
                    prof.score = score;
                    professionals.push(prof);
                });
                
                if (professionals.length === 0) {
                    showMessage('No hay t√©cnicos disponibles en la zona seleccionada.', 'info');
                    return;
                }
                
                // Ordenar por score
                professionals.sort((a, b) => b.score - a.score);
                
                // Mostrar resultados
                displayProfessionals(professionals);
                
                // Actualizar contador
                resultsCount.textContent = `${professionals.length} t√©cnico${professionals.length !== 1 ? 's' : ''} encontrado${professionals.length !== 1 ? 's' : ''}`;
                resultsHeader.style.display = 'flex';
                
                // Recargar banner con los nuevos filtros
                loadBanner();
                
            } catch (error) {
                console.error('Error buscando t√©cnicos:', error);
                showMessage('Error en la b√∫squeda. Por favor, intent√° nuevamente.', 'error');
            } finally {
                loader.style.display = 'none';
            }
        }

        function displayProfessionals(professionals) {
            const container = document.getElementById('resultsContainer');
            container.innerHTML = '';
            
            professionals.forEach(prof => {
                const now = new Date();
                const isFeatured = prof.isFeatured && prof.featuredUntil && prof.featuredUntil.toDate() > now;
                
                const card = document.createElement('div');
                card.className = 'professional-card';
                
                card.innerHTML = `
                    ${isFeatured ? '<div class="professional-featured">‚≠ê DESTACADO</div>' : ''}
                    ${prof.certified ? '<div class="professional-featured" style="top: 45px; background: linear-gradient(135deg, #28a745 0%, #20c997 100%);">‚úì CERTIFICADO</div>' : ''}
                    <div class="professional-header">
                        <img src="${prof.photoUrl || 'https://via.placeholder.com/80x80/0a4fd8/ffffff?text=T√âCNICO'}" 
                             alt="${prof.name}"
                             class="professional-photo"
                             loading="lazy"
                             onerror="this.src='https://via.placeholder.com/80x80/0a4fd8/ffffff?text=T√âCNICO'">
                        <div class="professional-info">
                            <h3 class="professional-name">${prof.name}</h3>
                            <div class="professional-rating">
                                ‚≠ê ${prof.rating ? prof.rating.toFixed(1) : 'Nuevo'}
                                <span>(${prof.jobsCompleted || 0} trabajos)</span>
                            </div>
                            <div style="font-size: 0.9rem; color: var(--gray); margin-top: 0.5rem;">
                                üìç ${prof.ciudad}, ${prof.provincia}
                            </div>
                        </div>
                    </div>
                    <div class="professional-body">
                        <div class="professional-services">
                            ${prof.rubros ? prof.rubros.map(rubro => 
                                `<span class="service-tag">${getRubroName(rubro)}</span>`
                            ).join('') : ''}
                        </div>
                        <p style="margin-top: 1rem;">${prof.bio || 'T√©cnico especializado con experiencia comprobada.'}</p>
                        ${prof.certified ? '<p style="color: #28a745; font-weight: 600; margin-top: 0.5rem;">‚úì T√©cnico certificado</p>' : ''}
                    </div>
                    <div class="professional-footer">
                        <span>üìç ${prof.zonas ? prof.zonas.join(', ') : 'Toda la ciudad'}</span>
                        <a href="https://wa.me/${prof.phone}?text=Hola ${prof.name.split(' ')[0]}, te contacto desde TecniYa para consultar por tus servicios" 
                           target="_blank"
                           class="btn btn-whatsapp">
                            üì± Contactar
                        </a>
                    </div>
                `;
                
                container.appendChild(card);
            });
        }

        function getRubroName(rubroKey) {
            const rubros = {
                'plomeria': 'Plomer√≠a',
                'gas': 'Gas',
                'electricidad': 'Electricidad',
                'aire': 'Aire Acondicionado',
                'albanileria': 'Alba√±iler√≠a',
                'pintura': 'Pintura',
                'cerrajeria': 'Cerrajer√≠a',
                'jardineria': 'Jardiner√≠a',
                'herreria': 'Herrer√≠a',
                'carpinteria': 'Carpinter√≠a',
                'limpieza': 'Limpieza',
                'mudanzas': 'Mudanzas',
                'otros': 'Otros servicios'
            };
            return rubros[rubroKey] || rubroKey;
        }

        function showMessage(text, type) {
            const container = document.getElementById('resultsContainer');
            const message = document.createElement('div');
            message.className = `message message-${type}`;
            message.textContent = text;
            container.innerHTML = '';
            container.appendChild(message);
            
            setTimeout(() => {
                message.remove();
            }, 5000);
        }
    </script>
</body>
</html>
