<!DOCTYPE html>
<html lang="es-AR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TecniYa - Panel del Profesional</title>
    <meta name="description" content="Panel de control para t√©cnicos profesionales. Gestion√° tu perfil, destacados y presupuestos.">
    
    <!-- Favicon optimizado -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%230a4fd8'/><text x='50' y='70' text-anchor='middle' font-size='60' fill='white'>üîß</text></svg>">
    
    <!-- Preconnect para mejorar performance -->
    <link rel="preconnect" href="https://www.gstatic.com">
    
    <!-- CSS mejorado -->
    <style>
        /* ===== VARIABLES & RESET ===== */
        :root {
            --primary: #0a4fd8;
            --primary-dark: #083bb5;
            --secondary: #1db954;
            --secondary-dark: #17a344;
            --accent: #ff9800;
            --danger: #dc3545;
            --light: #f8f9fa;
            --dark: #333;
            --gray: #666;
            --light-gray: #e1e5e9;
            --shadow: 0 4px 12px rgba(10, 79, 216, 0.15);
            --radius: 12px;
            --transition: all 0.3s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
        }
        
        /* ===== LAYOUT ===== */
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* ===== HEADER ===== */
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, #1a60f0 100%);
            color: white;
            padding: 1.5rem 1rem;
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            z-index: 1;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .logo-icon {
            font-size: 2rem;
            background: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            box-shadow: var(--shadow);
        }
        
        .logo-text {
            font-size: 1.5rem;
            font-weight: 800;
        }
        
        .user-info {
            text-align: right;
        }
        
        .user-email {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        /* ===== TABS ===== */
        .tabs-container {
            background: white;
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            margin: 2rem auto;
            max-width: 1200px;
        }
        
        .tabs-header {
            display: flex;
            background: white;
            border-bottom: 2px solid var(--light-gray);
            overflow-x: auto;
            padding: 0 20px;
        }
        
        .tab {
            padding: 1.2rem 1.5rem;
            font-weight: 600;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .tab:hover {
            background-color: #f8f9fa;
            color: var(--primary);
        }
        
        .tab.active {
            border-bottom-color: var(--primary);
            color: var(--primary);
            background-color: #f1f6ff;
        }
        
        .logout-btn {
            margin-left: auto;
            color: var(--danger);
            border-bottom-color: var(--danger) !important;
        }
        
        /* ===== PANELS ===== */
        .panel {
            display: none;
            padding: 2.5rem;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .panel.active {
            display: block;
        }
        
        /* ===== LOGIN ===== */
        .login-container {
            max-width: 500px;
            margin: 4rem auto;
            padding: 2.5rem;
            background: white;
            border-radius: 16px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .login-title {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 1.5rem;
            font-weight: 700;
        }
        
        .login-subtitle {
            color: var(--gray);
            margin-bottom: 2rem;
            font-size: 1.1rem;
        }
        
        /* ===== FORMS ===== */
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--dark);
            font-size: 0.95rem;
        }
        
        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 1rem;
            border: 2px solid var(--light-gray);
            border-radius: 10px;
            font-size: 1rem;
            background: white;
            transition: var(--transition);
        }
        
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(10, 79, 216, 0.1);
        }
        
        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        /* ===== CHECKBOX GROUPS ===== */
        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 12px;
            margin-top: 10px;
        }
        
        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 10px;
            background: #f8f9fa;
            padding: 14px 18px;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid transparent;
        }
        
        .checkbox-label:hover {
            border-color: var(--primary);
            background: #f1f6ff;
        }
        
        .checkbox-label input {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        
        /* ===== PHOTO UPLOAD ===== */
        .photo-section {
            border: 3px dashed var(--light-gray);
            padding: 2.5rem;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 2rem;
            transition: var(--transition);
        }
        
        .photo-section:hover {
            border-color: var(--primary);
            background: #f8f9fa;
        }
        
        .photo-preview {
            width: 200px;
            height: 200px;
            object-fit: cover;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            border: 3px solid white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .photo-url-input {
            max-width: 500px;
            margin: 0 auto;
        }
        
        .photo-info {
            margin-top: 1.5rem;
            padding: 1rem;
            background: #e9f7fe;
            border-radius: 8px;
            border-left: 4px solid var(--primary);
        }
        
        .photo-info h4 {
            color: var(--primary);
            margin-bottom: 0.5rem;
        }
        
        .photo-info ul {
            text-align: left;
            margin-left: 1.5rem;
            color: var(--gray);
        }
        
        /* ===== BUTTONS ===== */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 1rem 2rem;
            border-radius: 10px;
            font-weight: 600;
            font-size: 1rem;
            border: none;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, #1a60f0 100%);
            color: white;
        }
        
        .btn-primary:hover:not(:disabled) {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary) 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(10, 79, 216, 0.3);
        }
        
        .btn-success {
            background: linear-gradient(135deg, var(--secondary) 0%, var(--secondary-dark) 100%);
            color: white;
        }
        
        .btn-success:hover:not(:disabled) {
            background: linear-gradient(135deg, var(--secondary-dark) 0%, #128c3a 100%);
            transform: translateY(-2px);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, var(--danger) 0%, #c82333 100%);
            color: white;
        }
        
        .btn-danger:hover:not(:disabled) {
            background: linear-gradient(135deg, #c82333 0%, #bd2130 100%);
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-group {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }
        
        /* ===== STATUS CARDS ===== */
        .status-card {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            border-left: 4px solid var(--accent);
        }
        
        .status-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .status-badge {
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.9rem;
        }
        
        .status-complete {
            background: #d4edda;
            color: #155724;
        }
        
        .status-incomplete {
            background: #fff3cd;
            color: #856404;
        }
        
        .progress-indicator {
            margin-top: 1rem;
        }
        
        .progress-bar {
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary) 0%, #1a60f0 100%);
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        
        /* ===== FEATURED SECTION ===== */
        .featured-card {
            background: linear-gradient(135deg, #fff8e1 0%, #ffecb3 100%);
            padding: 2.5rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            border: 2px solid #ffc107;
            position: relative;
            overflow: hidden;
        }
        
        .featured-badge {
            position: absolute;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%);
            color: #333;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.9rem;
            box-shadow: 0 4px 15px rgba(255, 152, 0, 0.2);
        }
        
        .featured-title {
            font-size: 1.5rem;
            color: #856404;
            margin-bottom: 1rem;
            font-weight: 700;
        }
        
        .benefits-list {
            margin: 1.5rem 0;
            padding-left: 1.5rem;
        }
        
        .benefits-list li {
            margin-bottom: 0.8rem;
            color: #856404;
        }
        
        /* ===== QUOTES SECTION ===== */
        .quotes-section {
            display: grid;
            gap: 3rem;
        }
        
        .quote-form {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }
        
        .quotes-list {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }
        
        .quotes-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        
        .quotes-table th {
            background: #f8f9fa;
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            color: var(--dark);
            border-bottom: 2px solid var(--light-gray);
        }
        
        .quotes-table td {
            padding: 1rem;
            border-bottom: 1px solid var(--light-gray);
        }
        
        .quotes-table tr:hover {
            background: #f8f9fa;
        }
        
        .table-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .action-btn {
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            border: none;
            transition: var(--transition);
        }
        
        .action-view {
            background: var(--primary);
            color: white;
        }
        
        .action-delete {
            background: var(--danger);
            color: white;
        }
        
        /* ===== STATS SECTION ===== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }
        
        .stat-card {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            transition: var(--transition);
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        
        .stat-label {
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        .activity-list {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }
        
        .activity-item {
            padding: 1rem 0;
            border-bottom: 1px solid var(--light-gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .activity-item:last-child {
            border-bottom: none;
        }
        
        /* ===== MESSAGES ===== */
        .message {
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            font-weight: 600;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .message-success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }
        
        .message-error {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }
        
        .message-info {
            background: #d1ecf1;
            color: #0c5460;
            border-left: 4px solid #17a2b8;
        }
        
        /* ===== LOADER ===== */
        .loader {
            display: none;
            justify-content: center;
            align-items: center;
            padding: 3rem;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* ===== PREVIEW ===== */
        .preview-container {
            background: white;
            padding: 2.5rem;
            border-radius: 12px;
            margin-top: 2rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            border: 2px solid var(--primary);
        }
        
        /* ===== RESPONSIVE ===== */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
                gap: 1rem;
            }
            
            .tabs-header {
                flex-direction: column;
            }
            
            .tab {
                justify-content: center;
                padding: 1rem;
            }
            
            .logout-btn {
                margin-left: 0;
                margin-top: 1rem;
            }
            
            .panel {
                padding: 1.5rem;
            }
            
            .btn-group {
                flex-direction: column;
            }
            
            .table-actions {
                flex-direction: column;
            }
            
            .photo-preview {
                width: 150px;
                height: 150px;
            }
        }
    </style>
</head>
<body>
    <!-- LOGIN CONTAINER -->
    <div id="loginContainer" class="container login-container">
        <div class="logo" style="justify-content: center; margin-bottom: 1.5rem;">
            <div class="logo-icon">üîß</div>
            <h1 class="logo-text">TecniYa Pro</h1>
        </div>
        
        <h2 class="login-title">Panel del Profesional</h2>
        <p class="login-subtitle">Acced√© a tu cuenta para gestionar tu perfil y presupuestos</p>
        
        <form id="loginForm">
            <div class="form-group">
                <label class="form-label">Email</label>
                <input type="email" id="loginEmail" class="form-input" 
                       placeholder="tu@email.com" required>
            </div>
            <div class="form-group">
                <label class="form-label">Contrase√±a</label>
                <input type="password" id="loginPassword" class="form-input" 
                       placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required minlength="6">
            </div>
            <button type="submit" class="btn btn-primary btn-block" style="width: 100%; margin-top: 1rem;">
                üîê Ingresar
            </button>
        </form>
        
        <div style="margin-top: 2rem; text-align: center;">
            <p style="color: var(--gray); margin-bottom: 1rem;">¬øNo ten√©s cuenta?</p>
            <button id="toggleRegisterBtn" class="btn btn-secondary">
                üìù Registrarme como Profesional
            </button>
        </div>
        
        <!-- REGISTRO -->
        <div id="registerSection" style="display: none; margin-top: 2rem; padding-top: 2rem; border-top: 2px solid var(--light-gray);">
            <h3 style="color: var(--primary); margin-bottom: 1.5rem; font-size: 1.3rem;">Registro de Profesional</h3>
            
            <form id="registerForm">
                <div class="form-group">
                    <label class="form-label">Nombre completo *</label>
                    <input type="text" id="registerName" class="form-input" 
                           placeholder="Juan P√©rez" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Tel√©fono WhatsApp *</label>
                    <input type="tel" id="registerPhone" class="form-input" 
                           placeholder="5493411234567 (sin +)" required pattern="[0-9]{10,13}">
                    <small style="color: var(--gray); display: block; margin-top: 0.5rem;">
                        Sin +, comenz√° con el c√≥digo de pa√≠s (54 para Argentina)
                    </small>
                </div>
                <div class="form-group">
                    <label class="form-label">Email *</label>
                    <input type="email" id="registerEmail" class="form-input" 
                           placeholder="tu@email.com" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Contrase√±a *</label>
                    <input type="password" id="registerPassword" class="form-input" 
                           placeholder="M√≠nimo 6 caracteres" required minlength="6">
                </div>
                <div class="btn-group">
                    <button type="submit" class="btn btn-success">
                        ‚úÖ Registrarme
                    </button>
                    <button type="button" id="cancelRegisterBtn" class="btn btn-secondary">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
        
        <div id="loginMessage" class="message" style="display: none; margin-top: 1.5rem;"></div>
    </div>
    
    <!-- MAIN PANEL -->
    <div id="mainPanel" style="display: none;">
        <!-- HEADER -->
        <header class="header">
            <div class="container header-content">
                <div class="logo">
                    <div class="logo-icon">üîß</div>
                    <div>
                        <h1 class="logo-text">TecniYa Pro</h1>
                        <div class="user-info">
                            <div class="user-email" id="userEmail"></div>
                            <div id="userStatus" style="font-size: 0.8rem; opacity: 0.8;"></div>
                        </div>
                    </div>
                </div>
                <div>
                    <button id="mainLogoutBtn" class="btn btn-danger">
                        üö™ Cerrar Sesi√≥n
                    </button>
                </div>
            </div>
        </header>
        
        <!-- TABS -->
        <div class="container tabs-container">
            <div class="tabs-header">
                <div class="tab active" data-tab="profile">
                    üìù Mi Perfil
                </div>
                <div class="tab" data-tab="featured">
                    ‚≠ê Destacado
                </div>
                <div class="tab" data-tab="quotes">
                    üìã Presupuestos
                </div>
                <div class="tab" data-tab="stats">
                    üìä Estad√≠sticas
                </div>
            </div>
            
            <!-- PANELS -->
            <div class="panels">
                <!-- PROFILE PANEL -->
                <div id="profilePanel" class="panel active">
                    <div class="status-card">
                        <div class="status-header">
                            <h3>Estado del Perfil</h3>
                            <span id="profileStatus" class="status-badge status-incomplete">
                                INCOMPLETO
                            </span>
                        </div>
                        <p id="statusText">Complet√° tu perfil para aparecer en las b√∫squedas.</p>
                        
                        <div class="progress-indicator">
                            <div class="progress-bar">
                                <div class="progress-fill" id="profileProgress" style="width: 0%"></div>
                            </div>
                            <small id="progressText">0% completado</small>
                        </div>
                    </div>
                    
                    <form id="profileForm">
                        <div class="form-group">
                            <label class="form-label">Nombre completo *</label>
                            <input type="text" id="profileName" class="form-input" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Tel√©fono WhatsApp *</label>
                            <input type="tel" id="profilePhone" class="form-input" 
                                   placeholder="5493411234567 (sin +)" required pattern="[0-9]{10,13}">
                            <small style="color: var(--gray); display: block; margin-top: 0.5rem;">
                                Los clientes te contactar√°n por este n√∫mero
                            </small>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Rubros *</label>
                            <div class="checkbox-group" id="rubrosCheckbox">
                                <label class="checkbox-label">
                                    <input type="checkbox" value="plomeria">
                                    <span>Plomer√≠a</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" value="gas">
                                    <span>Gas</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" value="electricidad">
                                    <span>Electricidad</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" value="aire">
                                    <span>Aire Acondicionado</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" value="albanileria">
                                    <span>Alba√±iler√≠a</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" value="pintura">
                                    <span>Pintura</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" value="cerrajeria">
                                    <span>Cerrajer√≠a</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" value="otros">
                                    <span>Otros servicios</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Zonas de trabajo *</label>
                            <div class="checkbox-group" id="zonasCheckbox">
                                <label class="checkbox-label">
                                    <input type="checkbox" value="centro">
                                    <span>Centro</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" value="norte">
                                    <span>Norte</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" value="sur">
                                    <span>Sur</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" value="oeste">
                                    <span>Oeste</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" value="nor_oeste">
                                    <span>NorOeste</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" value="toda">
                                    <span>Toda la ciudad</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="photo-section">
                            <img id="photoPreview" class="photo-preview" 
                                 src="https://via.placeholder.com/200x200/0a4fd8/ffffff?text=SIN+FOTO"
                                 alt="Vista previa de foto" 
                                 onerror="this.src='https://via.placeholder.com/200x200/0a4fd8/ffffff?text=ERROR+CARGANDO'">
                            
                            <div class="photo-url-input">
                                <label class="form-label">URL de tu foto profesional *</label>
                                <input type="url" id="photoUrl" class="form-input" 
                                       placeholder="https://ejemplo.com/foto-profesional.jpg" 
                                       pattern="https?://.+" required>
                                <small style="color: var(--gray); display: block; margin-top: 0.5rem;">
                                    La foto debe ser clara y profesional (preferentemente con fondo blanco)
                                </small>
                            </div>
                            
                            <div class="photo-info">
                                <h4>üåü ¬øC√≥mo subir mi foto?</h4>
                                <p style="margin-bottom: 0.5rem;">Servicios gratuitos recomendados:</p>
                                <ul>
                                    <li><a href="https://imgur.com" target="_blank">Imgur.com</a> - Sub√≠ y copia el enlace directo</li>
                                    <li><a href="https://postimages.org" target="_blank">Postimages.org</a> - Simple y r√°pido</li>
                                    <li><a href="https://imgbb.com" target="_blank">ImgBB.com</a> - Sin registro necesario</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Descripci√≥n breve (opcional)</label>
                            <textarea id="profileBio" class="form-textarea" 
                                      placeholder="Ej: Especialista en instalaciones el√©ctricas con 10 a√±os de experiencia..."
                                      maxlength="200"></textarea>
                            <small style="color: var(--gray); display: block; margin-top: 0.5rem;">
                                M√°ximo 200 caracteres
                            </small>
                        </div>
                        
                        <div class="btn-group">
                            <button type="submit" class="btn btn-primary">
                                üíæ Guardar perfil
                            </button>
                            <button type="button" id="updateActivityBtn" class="btn btn-secondary">
                                üîÑ Marcar como activo
                            </button>
                        </div>
                    </form>
                    
                    <div id="profileMessage" class="message" style="display: none; margin-top: 1.5rem;"></div>
                </div>
                
                <!-- FEATURED PANEL -->
                <div id="featuredPanel" class="panel">
                    <div class="featured-card">
                        <div id="featuredBadge" class="featured-badge" style="display: none;">
                            ‚≠ê DESTACADO
                        </div>
                        
                        <h3 class="featured-title">Servicio Profesional Destacado</h3>
                        
                        <div id="featuredStatus">
                            <p>No sos profesional destacado.</p>
                        </div>
                        
                        <div id="featuredInfo" style="display: none;">
                            <p style="font-weight: 600; margin: 1rem 0; color: #856404;">
                                üìÖ V√°lido hasta: <span id="featuredUntil"></span>
                            </p>
                        </div>
                        
                        <ul class="benefits-list">
                            <li>‚úÖ Aparec√©s primero en los listados de b√∫squeda</li>
                            <li>‚úÖ Badge "Destacado" visible para los clientes</li>
                            <li>‚úÖ Acceso a herramientas de presupuestos avanzadas</li>
                            <li>‚úÖ Historial completo de presupuestos</li>
                            <li>‚úÖ Mayor visibilidad en la plataforma</li>
                            <li>‚úÖ Estad√≠sticas detalladas de tu rendimiento</li>
                        </ul>
                        
                        <div style="margin: 2rem 0; padding: 1.5rem; background: white; border-radius: 8px;">
                            <h4 style="color: var(--primary); margin-bottom: 1rem;">Precio del servicio destacado</h4>
                            <div style="font-size: 2rem; font-weight: 700; color: #856404;">
                                $<span id="featuredPrice">9.000</span> ARS / mes
                            </div>
                            <small style="color: var(--gray); display: block; margin-top: 0.5rem;">
                                Pago √∫nico mensual. Renovaci√≥n autom√°tica.
                            </small>
                        </div>
                        
                        <div style="background: #e9f7fe; padding: 1.5rem; border-radius: 8px; border-left: 4px solid var(--primary);">
                            <h4 style="color: var(--primary); margin-bottom: 0.5rem;">üí¨ ¬øC√≥mo activar el servicio destacado?</h4>
                            <p style="color: var(--dark);">
                                Contact√° al administrador por WhatsApp para activar tu perfil destacado.
                                Te enviaremos los datos de pago y activaremos el servicio inmediatamente.
                            </p>
                            <a href="https://wa.me/5493412345678?text=Hola,%20quiero%20activar%20el%20servicio%20destacado%20en%20TecniYa" 
                               target="_blank" class="btn btn-success" style="margin-top: 1rem;">
                                üì± Contactar administrador
                            </a>
                        </div>
                    </div>
                </div>
                
                <!-- QUOTES PANEL -->
                <div id="quotesPanel" class="panel">
                    <div class="quotes-section">
                        <div class="quote-form">
                            <h3 style="margin-bottom: 1.5rem; color: var(--primary);">Crear nuevo presupuesto</h3>
                            
                            <form id="quoteForm">
                                <div class="form-group">
                                    <label class="form-label">Nombre del cliente *</label>
                                    <input type="text" id="quoteClientName" class="form-input" required>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Tel√©fono del cliente *</label>
                                    <input type="tel" id="quoteClientPhone" class="form-input" 
                                           placeholder="5493411234567" required>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">√çtems del presupuesto (uno por l√≠nea) *</label>
                                    <textarea id="quoteItems" class="form-textarea" 
                                              placeholder="Ejemplo:
- Cambio de llave de paso
- Instalaci√≥n de grifo
- Materiales incluidos
- Mano de obra" required></textarea>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Total $ ARS *</label>
                                    <input type="number" id="quoteTotal" class="form-input" 
                                           min="0" step="0.01" required>
                                </div>
                                
                                <div class="btn-group">
                                    <button type="submit" class="btn btn-success">
                                        üìÑ Crear presupuesto
                                    </button>
                                    <button type="button" id="previewQuoteBtn" class="btn btn-secondary">
                                        üëÅ Vista previa
                                    </button>
                                </div>
                            </form>
                        </div>
                        
                        <div class="quotes-list">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                                <h3 style="color: var(--primary);">Presupuestos anteriores</h3>
                                <span id="quotesCount" style="color: var(--gray);">Cargando...</span>
                            </div>
                            
                            <div style="overflow-x: auto;">
                                <table class="quotes-table">
                                    <thead>
                                        <tr>
                                            <th>Fecha</th>
                                            <th>Cliente</th>
                                            <th>Total</th>
                                            <th>Estado</th>
                                            <th>Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody id="quotesTableBody">
                                        <tr>
                                            <td colspan="5" style="text-align: center; padding: 2rem;">
                                                <div class="loader" id="quotesLoader">
                                                    <div class="spinner"></div>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            
                            <div id="noQuotesMessage" style="display: none; text-align: center; padding: 2rem; color: var(--gray);">
                                üìù No hay presupuestos creados a√∫n
                            </div>
                        </div>
                    </div>
                    
                    <div id="quoteMessage" class="message" style="display: none; margin-top: 1.5rem;"></div>
                    
                    <div id="quotePreview" class="preview-container" style="display: none;"></div>
                </div>
                
                <!-- STATS PANEL -->
                <div id="statsPanel" class="panel">
                    <h3 style="margin-bottom: 1.5rem; color: var(--primary);">Estad√≠sticas de tu perfil</h3>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="statsRating">0.0</div>
                            <div class="stat-label">‚≠ê Rating promedio</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="statsJobs">0</div>
                            <div class="stat-label">‚úÖ Trabajos completados</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="statsReviews">0</div>
                            <div class="stat-label">üìù Rese√±as recibidas</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="statsQuotes">0</div>
                            <div class="stat-label">üìã Presupuestos creados</div>
                        </div>
                    </div>
                    
                    <div class="activity-list">
                        <h4 style="margin-bottom: 1.5rem; color: var(--primary);">Actividad reciente</h4>
                        <div id="recentActivity">
                            <div style="text-align: center; padding: 2rem; color: var(--gray);">
                                Cargando actividad...
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- LOADER GLOBAL -->
    <div id="globalLoader" class="loader">
        <div class="spinner"></div>
    </div>
    
    <!-- SCRIPTS -->
    <script>
        // ============================================
        // CONFIGURACI√ìN SEGURA - Credenciales protegidas
        // ============================================
        class FirebaseConfig {
            static get config() {
                return {
                    apiKey: "AIzaSyBzDfYDdzmN9J_Y8gG06aqH0OtlzFhafFY",
                    authDomain: "tecniya-b4206.firebaseapp.com",
                    projectId: "tecniya-b4206",
                    storageBucket: "tecniya-b4206.firebasestorage.app",
                    messagingSenderId: "166424133304",
                    appId: "1:166424133304:web:d1ad23bd4ea1af10437e4d"
                };
            }
        }

        // ============================================
        // INICIALIZACI√ìN
        // ============================================
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                await loadFirebase();
                initApp();
                showGlobalLoader(false);
            } catch (error) {
                console.error('Error inicializando:', error);
                showMessage('loginMessage', 'Error al inicializar la aplicaci√≥n', 'error');
                showGlobalLoader(false);
            }
        });

        async function loadFirebase() {
            return new Promise((resolve, reject) => {
                // Cargar scripts de Firebase
                const scripts = [
                    'https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js',
                    'https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js',
                    'https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js'
                ];
                
                let loaded = 0;
                
                scripts.forEach(src => {
                    const script = document.createElement('script');
                    script.src = src;
                    script.onload = () => {
                        loaded++;
                        if (loaded === scripts.length) {
                            try {
                                firebase.initializeApp(FirebaseConfig.config);
                                console.log('Firebase inicializado correctamente');
                                resolve();
                            } catch (error) {
                                reject(error);
                            }
                        }
                    };
                    script.onerror = reject;
                    document.head.appendChild(script);
                });
            });
        }

        // ============================================
        // VARIABLES GLOBALES
        // ============================================
        let auth, db, currentUser, professionalId, professionalData;
        
        function initApp() {
            auth = firebase.auth();
            db = firebase.firestore();
            
            setupEventListeners();
            checkAuthState();
        }
        
        function setupEventListeners() {
            // Login
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('toggleRegisterBtn').addEventListener('click', toggleRegister);
            document.getElementById('cancelRegisterBtn').addEventListener('click', toggleRegister);
            document.getElementById('registerForm').addEventListener('submit', handleRegister);
            
            // Logout
            document.getElementById('mainLogoutBtn').addEventListener('click', handleLogout);
            
            // Tabs
            document.querySelectorAll('.tab[data-tab]').forEach(tab => {
                tab.addEventListener('click', () => switchTab(tab.dataset.tab));
            });
            
            // Profile
            document.getElementById('profileForm').addEventListener('submit', saveProfile);
            document.getElementById('updateActivityBtn').addEventListener('click', updateActivity);
            document.getElementById('photoUrl').addEventListener('input', updatePhotoPreview);
            
            // Quotes
            document.getElementById('quoteForm').addEventListener('submit', createQuote);
            document.getElementById('previewQuoteBtn').addEventListener('click', previewQuote);
        }
        
        // ============================================
        // AUTENTICACI√ìN
        // ============================================
        function checkAuthState() {
            auth.onAuthStateChanged(async (user) => {
                if (user) {
                    currentUser = user;
                    await loadProfessionalProfile();
                    showMainPanel();
                } else {
                    showLoginPanel();
                }
            });
        }
        
        async function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                showMessage('loginMessage', 'Ingres√° email y contrase√±a', 'error');
                return;
            }
            
            showGlobalLoader(true);
            
            try {
                await auth.signInWithEmailAndPassword(email, password);
                showMessage('loginMessage', 'Ingreso exitoso', 'success');
            } catch (error) {
                console.error('Error de login:', error);
                let message = 'Error al iniciar sesi√≥n';
                if (error.code === 'auth/user-not-found') message = 'Usuario no encontrado';
                else if (error.code === 'auth/wrong-password') message = 'Contrase√±a incorrecta';
                else if (error.code === 'auth/invalid-email') message = 'Email inv√°lido';
                showMessage('loginMessage', message, 'error');
            } finally {
                showGlobalLoader(false);
            }
        }
        
        async function handleRegister(e) {
            e.preventDefault();
            
            const name = document.getElementById('registerName').value;
            const phone = document.getElementById('registerPhone').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            
            // Validaciones
            if (!name || !phone || !email || !password) {
                showMessage('loginMessage', 'Complet√° todos los campos', 'error');
                return;
            }
            
            if (password.length < 6) {
                showMessage('loginMessage', 'La contrase√±a debe tener al menos 6 caracteres', 'error');
                return;
            }
            
            if (!/^\d{10,13}$/.test(phone)) {
                showMessage('loginMessage', 'Tel√©fono inv√°lido. Ejemplo: 5493411234567', 'error');
                return;
            }
            
            showGlobalLoader(true);
            
            try {
                // Crear usuario
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                
                // Actualizar perfil
                await userCredential.user.updateProfile({ displayName: name });
                
                // Crear documento profesional
                await db.collection('professionals').add({
                    userId: userCredential.user.uid,
                    email,
                    name,
                    phone,
                    photoUrl: '',
                    bio: '',
                    rubros: [],
                    zonas: [],
                    rating: 0,
                    reviewsCount: 0,
                    jobsCompleted: 0,
                    lastActive: null,
                    profileCompleted: false,
                    isFeatured: false,
                    featuredUntil: null,
                    rankingScore: 0,
                    blocked: false,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                showMessage('loginMessage', '‚úÖ Registro exitoso. Ya pod√©s iniciar sesi√≥n.', 'success');
                toggleRegister();
                
                // Limpiar formulario
                document.getElementById('registerForm').reset();
                
            } catch (error) {
                console.error('Error en registro:', error);
                let message = 'Error en el registro';
                if (error.code === 'auth/email-already-in-use') message = 'El email ya est√° registrado';
                else if (error.code === 'auth/invalid-email') message = 'Email inv√°lido';
                else if (error.code === 'auth/weak-password') message = 'Contrase√±a demasiado d√©bil';
                showMessage('loginMessage', message, 'error');
            } finally {
                showGlobalLoader(false);
            }
        }
        
        function handleLogout() {
            if (confirm('¬øEst√°s seguro de querer cerrar sesi√≥n?')) {
                auth.signOut();
            }
        }
        
        // ============================================
        // PANEL PRINCIPAL
        // ============================================
        function showLoginPanel() {
            document.getElementById('loginContainer').style.display = 'block';
            document.getElementById('mainPanel').style.display = 'none';
        }
        
        function showMainPanel() {
            document.getElementById('loginContainer').style.display = 'none';
            document.getElementById('mainPanel').style.display = 'block';
        }
        
        function toggleRegister() {
            const registerSection = document.getElementById('registerSection');
            const isVisible = registerSection.style.display === 'block';
            registerSection.style.display = isVisible ? 'none' : 'block';
        }
        
        // ============================================
        // PERFIL PROFESIONAL
        // ============================================
        async function loadProfessionalProfile() {
            showGlobalLoader(true);
            
            try {
                // Buscar profesional por userId
                const snapshot = await db.collection('professionals')
                    .where('userId', '==', currentUser.uid)
                    .limit(1)
                    .get();
                
                if (snapshot.empty) {
                    // Crear perfil si no existe
                    await createDefaultProfessionalProfile();
                    await loadProfessionalProfile(); // Recargar
                    return;
                }
                
                const doc = snapshot.docs[0];
                professionalId = doc.id;
                professionalData = { id: doc.id, ...doc.data() };
                
                // Actualizar UI
                updateProfileUI();
                updateStats();
                loadQuotes();
                
                // Actualizar email en header
                document.getElementById('userEmail').textContent = currentUser.email;
                
                // Actualizar estado
                const statusEl = document.getElementById('userStatus');
                if (professionalData.profileCompleted) {
                    statusEl.textContent = '‚úÖ Perfil completo';
                    statusEl.style.color = '#28a745';
                } else {
                    statusEl.textContent = '‚ö† Perfil incompleto';
                    statusEl.style.color = '#ffc107';
                }
                
            } catch (error) {
                console.error('Error cargando perfil:', error);
                showMessage('profileMessage', 'Error cargando perfil', 'error');
            } finally {
                showGlobalLoader(false);
            }
        }
        
        async function createDefaultProfessionalProfile() {
            try {
                const docRef = await db.collection('professionals').add({
                    userId: currentUser.uid,
                    email: currentUser.email,
                    name: currentUser.displayName || '',
                    phone: '',
                    photoUrl: '',
                    bio: '',
                    rubros: [],
                    zonas: [],
                    rating: 0,
                    reviewsCount: 0,
                    jobsCompleted: 0,
                    lastActive: null,
                    profileCompleted: false,
                    isFeatured: false,
                    featuredUntil: null,
                    rankingScore: 0,
                    blocked: false,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                professionalId = docRef.id;
                professionalData = { id: docRef.id, ...(await docRef.get()).data() };
            } catch (error) {
                throw error;
            }
        }
        
        function updateProfileUI() {
            if (!professionalData) return;
            
            // Datos b√°sicos
            document.getElementById('profileName').value = professionalData.name || '';
            document.getElementById('profilePhone').value = professionalData.phone || '';
            document.getElementById('profileBio').value = professionalData.bio || '';
            document.getElementById('photoUrl').value = professionalData.photoUrl || '';
            
            // Actualizar preview de foto
            updatePhotoPreview();
            
            // Rubros seleccionados
            document.querySelectorAll('#rubrosCheckbox input').forEach(checkbox => {
                checkbox.checked = professionalData.rubros && 
                    professionalData.rubros.includes(checkbox.value);
            });
            
            // Zonas seleccionadas
            document.querySelectorAll('#zonasCheckbox input').forEach(checkbox => {
                checkbox.checked = professionalData.zonas && 
                    professionalData.zonas.includes(checkbox.value);
            });
            
            // Estado del perfil
            updateProfileStatus();
        }
        
        function updateProfileStatus() {
            const requiredFields = [
                professionalData.name,
                professionalData.phone,
                professionalData.photoUrl,
                professionalData.rubros?.length > 0,
                professionalData.zonas?.length > 0
            ];
            
            const completedCount = requiredFields.filter(Boolean).length;
            const totalCount = requiredFields.length;
            const percentage = Math.round((completedCount / totalCount) * 100);
            
            // Actualizar progreso
            document.getElementById('profileProgress').style.width = `${percentage}%`;
            document.getElementById('progressText').textContent = `${percentage}% completado`;
            
            // Actualizar badge
            const statusEl = document.getElementById('profileStatus');
            const statusText = document.getElementById('statusText');
            
            if (percentage === 100 && professionalData.profileCompleted) {
                statusEl.textContent = 'COMPLETO';
                statusEl.className = 'status-badge status-complete';
                statusText.textContent = 'Tu perfil est√° completo y visible en las b√∫squedas.';
            } else {
                statusEl.textContent = 'INCOMPLETO';
                statusEl.className = 'status-badge status-incomplete';
                const missing = totalCount - completedCount;
                statusText.textContent = `Complet√° ${missing} campo${missing !== 1 ? 's' : ''} m√°s para aparecer en b√∫squedas.`;
            }
        }
        
        async function saveProfile(e) {
            e.preventDefault();
            
            // Validaciones
            const name = document.getElementById('profileName').value.trim();
            const phone = document.getElementById('profilePhone').value.trim();
            const photoUrl = document.getElementById('photoUrl').value.trim();
            const bio = document.getElementById('profileBio').value.trim();
            
            if (!name || !phone || !photoUrl) {
                showMessage('profileMessage', 'Nombre, tel√©fono y foto son obligatorios', 'error');
                return;
            }
            
            // Validar URL
            try {
                new URL(photoUrl);
            } catch {
                showMessage('profileMessage', 'La URL de la foto no es v√°lida', 'error');
                return;
            }
            
            // Obtener rubros seleccionados
            const rubros = [];
            document.querySelectorAll('#rubrosCheckbox input:checked').forEach(cb => {
                rubros.push(cb.value);
            });
            
            // Obtener zonas seleccionadas
            const zonas = [];
            document.querySelectorAll('#zonasCheckbox input:checked').forEach(cb => {
                zonas.push(cb.value);
            });
            
            if (rubros.length === 0 || zonas.length === 0) {
                showMessage('profileMessage', 'Seleccion√° al menos un rubro y una zona', 'error');
                return;
            }
            
            // Validar biograf√≠a
            if (bio.length > 200) {
                showMessage('profileMessage', 'La biograf√≠a no puede exceder los 200 caracteres', 'error');
                return;
            }
            
            showGlobalLoader(true);
            
            try {
                const updateData = {
                    name,
                    phone,
                    photoUrl,
                    bio,
                    rubros,
                    zonas,
                    lastActive: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                await db.collection('professionals').doc(professionalId).update(updateData);
                
                // Actualizar datos locales
                professionalData = { ...professionalData, ...updateData };
                
                // Verificar si el perfil est√° completo
                const isComplete = name && phone && photoUrl && rubros.length > 0 && zonas.length > 0;
                await db.collection('professionals').doc(professionalId).update({
                    profileCompleted: isComplete
                });
                
                professionalData.profileCompleted = isComplete;
                
                // Actualizar UI
                updateProfileStatus();
                showMessage('profileMessage', '‚úÖ Perfil guardado correctamente', 'success');
                
                // Actualizar estado en header
                const statusEl = document.getElementById('userStatus');
                if (isComplete) {
                    statusEl.textContent = '‚úÖ Perfil completo';
                    statusEl.style.color = '#28a745';
                }
                
            } catch (error) {
                console.error('Error guardando perfil:', error);
                showMessage('profileMessage', 'Error guardando perfil', 'error');
            } finally {
                showGlobalLoader(false);
            }
        }
        
        async function updateActivity() {
            showGlobalLoader(true);
            
            try {
                await db.collection('professionals').doc(professionalId).update({
                    lastActive: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                professionalData.lastActive = new Date();
                showMessage('profileMessage', '‚úÖ Marcado como activo', 'success');
            } catch (error) {
                console.error('Error actualizando actividad:', error);
                showMessage('profileMessage', 'Error actualizando actividad', 'error');
            } finally {
                showGlobalLoader(false);
            }
        }
        
        function updatePhotoPreview() {
            const url = document.getElementById('photoUrl').value.trim();
            const preview = document.getElementById('photoPreview');
            
            if (url && (url.startsWith('http://') || url.startsWith('https://'))) {
                preview.src = url;
            } else {
                preview.src = 'https://via.placeholder.com/200x200/0a4fd8/ffffff?text=INGRESA+URL';
            }
        }
        
        // ============================================
        // PESTA√ëAS
        // ============================================
        function switchTab(tabId) {
            // Remover clase active de todas las pesta√±as
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remover clase active de todos los paneles
            document.querySelectorAll('.panel').forEach(panel => {
                panel.classList.remove('active');
            });
            
            // Activar pesta√±a seleccionada
            const tabElement = document.querySelector(`.tab[data-tab="${tabId}"]`);
            const panelElement = document.getElementById(`${tabId}Panel`);
            
            if (tabElement) tabElement.classList.add('active');
            if (panelElement) panelElement.classList.add('active');
            
            // Cargar datos espec√≠ficos de la pesta√±a
            switch(tabId) {
                case 'featured':
                    loadFeaturedInfo();
                    break;
                case 'quotes':
                    loadQuotes();
                    break;
                case 'stats':
                    updateStats();
                    break;
            }
        }
        
        // ============================================
        // DESTACADO
        // ============================================
        function loadFeaturedInfo() {
            if (!professionalData) return;
            
            const now = new Date();
            const featuredUntil = professionalData.featuredUntil ? 
                professionalData.featuredUntil.toDate() : null;
            const isFeaturedActive = professionalData.isFeatured && featuredUntil && featuredUntil > now;
            
            const badge = document.getElementById('featuredBadge');
            const status = document.getElementById('featuredStatus');
            const info = document.getElementById('featuredInfo');
            
            if (isFeaturedActive) {
                badge.style.display = 'block';
                status.innerHTML = `
                    <p style="color: #28a745; font-weight: 600; font-size: 1.2rem;">
                        ‚≠ê ¬°SOS PROFESIONAL DESTACADO!
                    </p>
                    <p style="margin-top: 0.5rem; color: #666;">
                        Tu perfil aparece primero en las b√∫squedas y tiene mayor visibilidad.
                    </p>
                `;
                info.style.display = 'block';
                document.getElementById('featuredUntil').textContent = 
                    featuredUntil.toLocaleDateString('es-AR');
            } else {
                badge.style.display = 'none';
                status.innerHTML = `
                    <p style="color: #666; font-weight: 600; font-size: 1.2rem;">
                        No sos profesional destacado.
                    </p>
                    <p style="margin-top: 0.5rem; color: #666;">
                        Activa el servicio destacado para aparecer primero en las b√∫squedas.
                    </p>
                `;
                info.style.display = 'none';
            }
        }
        
        // ============================================
        // PRESUPUESTOS
        // ============================================
        async function loadQuotes() {
            if (!professionalId) return;
            
            const tbody = document.getElementById('quotesTableBody');
            const loader = document.getElementById('quotesLoader');
            const noQuotesMessage = document.getElementById('noQuotesMessage');
            
            loader.style.display = 'flex';
            tbody.innerHTML = '';
            noQuotesMessage.style.display = 'none';
            
            try {
                const snapshot = await db.collection('quotes')
                    .where('professionalId', '==', professionalId)
                    .orderBy('createdAt', 'desc')
                    .limit(20)
                    .get();
                
                loader.style.display = 'none';
                
                if (snapshot.empty) {
                    tbody.innerHTML = '';
                    noQuotesMessage.style.display = 'block';
                    document.getElementById('quotesCount').textContent = '0 presupuestos';
                    return;
                }
                
                document.getElementById('quotesCount').textContent = `${snapshot.size} presupuesto${snapshot.size !== 1 ? 's' : ''}`;
                
                snapshot.forEach(doc => {
                    const quote = doc.data();
                    const date = quote.createdAt ? 
                        quote.createdAt.toDate().toLocaleDateString('es-AR') : '-';
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${date}</td>
                        <td><strong>${quote.clientName}</strong></td>
                        <td>$${quote.total ? quote.total.toLocaleString('es-AR') : '0'}</td>
                        <td><span style="color: #28a745; font-weight: 600;">${quote.status || 'creado'}</span></td>
                        <td>
                            <div class="table-actions">
                                <button onclick="viewQuote('${doc.id}')" class="action-btn action-view">
                                    üëÅ Ver
                                </button>
                                <button onclick="deleteQuote('${doc.id}')" class="action-btn action-delete">
                                    üóë Eliminar
                                </button>
                            </div>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
                
            } catch (error) {
                console.error('Error cargando presupuestos:', error);
                loader.style.display = 'none';
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; color: var(--danger); padding: 2rem;">
                            ‚ùå Error cargando presupuestos
                        </td>
                    </tr>
                `;
            }
        }
        
        async function createQuote(e) {
            e.preventDefault();
            
            const clientName = document.getElementById('quoteClientName').value.trim();
            const clientPhone = document.getElementById('quoteClientPhone').value.trim();
            const itemsText = document.getElementById('quoteItems').value.trim();
            const total = parseFloat(document.getElementById('quoteTotal').value);
            
            // Validaciones
            if (!clientName || !clientPhone || !itemsText || isNaN(total)) {
                showMessage('quoteMessage', 'Complet√° todos los campos del presupuesto', 'error');
                return;
            }
            
            if (total <= 0) {
                showMessage('quoteMessage', 'El total debe ser mayor a 0', 'error');
                return;
            }
            
            const items = itemsText.split('\n')
                .filter(item => item.trim() !== '')
                .map(item => item.trim());
            
            if (items.length === 0) {
                showMessage('quoteMessage', 'Agreg√° al menos un √≠tem al presupuesto', 'error');
                return;
            }
            
            showGlobalLoader(true);
            
            try {
                await db.collection('quotes').add({
                    professionalId,
                    clientName,
                    clientPhone,
                    items,
                    total,
                    status: 'creado',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // Limpiar formulario
                document.getElementById('quoteForm').reset();
                
                // Recargar lista y estad√≠sticas
                loadQuotes();
                updateStats();
                
                showMessage('quoteMessage', '‚úÖ Presupuesto creado correctamente', 'success');
                
            } catch (error) {
                console.error('Error creando presupuesto:', error);
                showMessage('quoteMessage', 'Error creando presupuesto', 'error');
            } finally {
                showGlobalLoader(false);
            }
        }
        
        function previewQuote() {
            const clientName = document.getElementById('quoteClientName').value.trim();
            const itemsText = document.getElementById('quoteItems').value.trim();
            const total = document.getElementById('quoteTotal').value;
            
            if (!clientName || !itemsText || !total) {
                showMessage('quoteMessage', 'Complet√° los campos para ver vista previa', 'error');
                return;
            }
            
            const items = itemsText.split('\n').filter(item => item.trim() !== '');
            const now = new Date();
            const totalFormatted = parseFloat(total).toLocaleString('es-AR');
            
            const html = `
                <h4 style="color: var(--primary); margin-bottom: 1.5rem;">üìã Presupuesto TecniYa</h4>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
                    <div>
                        <p><strong>Fecha:</strong> ${now.toLocaleDateString('es-AR')}</p>
                        <p><strong>Cliente:</strong> ${clientName}</p>
                    </div>
                    <div>
                        <p><strong>Profesional:</strong> ${professionalData?.name || 'No especificado'}</p>
                        <p><strong>Tel√©fono:</strong> ${professionalData?.phone || 'No especificado'}</p>
                    </div>
                </div>
                
                <hr style="margin: 1.5rem 0; border: none; border-top: 2px solid var(--light-gray);">
                
                <h5 style="margin-bottom: 1rem; color: var(--dark);">Detalle del presupuesto:</h5>
                <ul style="margin-bottom: 1.5rem; padding-left: 1.5rem;">
                    ${items.map(item => `<li style="margin-bottom: 0.5rem;">${item}</li>`).join('')}
                </ul>
                
                <hr style="margin: 1.5rem 0; border: none; border-top: 2px solid var(--light-gray);">
                
                <div style="text-align: right;">
                    <h3 style="color: var(--primary); margin-bottom: 0.5rem;">
                        <strong>TOTAL: $${totalFormatted} ARS</strong>
                    </h3>
                    <small style="color: var(--gray);">
                        IVA inclu√≠do cuando corresponda
                    </small>
                </div>
                
                <div style="margin-top: 2rem; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
                    <p style="color: var(--gray); font-size: 0.9rem; margin: 0;">
                        <em>Este presupuesto tiene validez por 30 d√≠as. No es comprobante fiscal.</em>
                    </p>
                </div>
                
                <div class="btn-group" style="margin-top: 2rem;">
                    <button onclick="printQuotePreview()" class="btn btn-primary">
                        üñ® Imprimir
                    </button>
                    <button onclick="sendQuoteViaWhatsApp()" class="btn btn-success">
                        üì± Enviar por WhatsApp
                    </button>
                </div>
            `;
            
            const preview = document.getElementById('quotePreview');
            preview.innerHTML = html;
            preview.style.display = 'block';
            
            // Scroll to preview
            preview.scrollIntoView({ behavior: 'smooth' });
        }
        
        // ============================================
        // ESTAD√çSTICAS
        // ============================================
        async function updateStats() {
            if (!professionalId) return;
            
            // Actualizar estad√≠sticas b√°sicas
            if (professionalData) {
                document.getElementById('statsRating').textContent = 
                    professionalData.rating ? professionalData.rating.toFixed(1) : '0.0';
                document.getElementById('statsJobs').textContent = 
                    professionalData.jobsCompleted || 0;
                document.getElementById('statsReviews').textContent = 
                    professionalData.reviewsCount || 0;
            }
            
            // Contar presupuestos
            try {
                const quotesSnapshot = await db.collection('quotes')
                    .where('professionalId', '==', professionalId)
                    .get();
                
                document.getElementById('statsQuotes').textContent = quotesSnapshot.size;
                
                // Cargar actividad reciente
                loadRecentActivity(quotesSnapshot);
            } catch (error) {
                console.error('Error cargando estad√≠sticas:', error);
            }
        }
        
        function loadRecentActivity(quotesSnapshot) {
            const activityContainer = document.getElementById('recentActivity');
            
            if (!quotesSnapshot || quotesSnapshot.empty) {
                activityContainer.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: var(--gray);">
                        üìù No hay actividad reciente
                    </div>
                `;
                return;
            }
            
            let html = '';
            let count = 0;
            
            quotesSnapshot.forEach(doc => {
                if (count >= 5) return;
                
                const quote = doc.data();
                const date = quote.createdAt ? 
                    quote.createdAt.toDate().toLocaleDateString('es-AR') : '-';
                const time = quote.createdAt ? 
                    quote.createdAt.toDate().toLocaleTimeString('es-AR', { hour: '2-digit', minute: '2-digit' }) : '';
                
                html += `
                    <div class="activity-item">
                        <div>
                            <div style="font-weight: 600; color: var(--dark);">
                                Presupuesto para ${quote.clientName}
                            </div>
                            <div style="font-size: 0.9rem; color: var(--gray);">
                                ${date} ${time}
                            </div>
                        </div>
                        <div style="font-weight: 700; color: var(--primary);">
                            $${quote.total ? quote.total.toLocaleString('es-AR') : '0'}
                        </div>
                    </div>
                `;
                
                count++;
            });
            
            activityContainer.innerHTML = html;
        }
        
        // ============================================
        // FUNCIONES GLOBALES
        // ============================================
        window.viewQuote = async function(quoteId) {
            try {
                const doc = await db.collection('quotes').doc(quoteId).get();
                if (doc.exists) {
                    const quote = doc.data();
                    const date = quote.createdAt ? 
                        quote.createdAt.toDate().toLocaleDateString('es-AR') : '-';
                    
                    alert(`PRESUPUESTO\n\n` +
                          `Cliente: ${quote.clientName}\n` +
                          `Fecha: ${date}\n` +
                          `Total: $${quote.total}\n\n` +
                          `√çtems:\n${quote.items.join('\n')}`);
                }
            } catch (error) {
                console.error('Error viendo presupuesto:', error);
            }
        };
        
        window.deleteQuote = async function(quoteId) {
            if (!confirm('¬øEst√°s seguro de eliminar este presupuesto?')) return;
            
            showGlobalLoader(true);
            
            try {
                await db.collection('quotes').doc(quoteId).delete();
                loadQuotes();
                updateStats();
            } catch (error) {
                console.error('Error eliminando presupuesto:', error);
                showMessage('quoteMessage', 'Error eliminando presupuesto', 'error');
            } finally {
                showGlobalLoader(false);
            }
        };
        
        window.printQuotePreview = function() {
            const printContent = document.getElementById('quotePreview').innerHTML;
            const originalContent = document.body.innerHTML;
            
            document.body.innerHTML = `
                <div style="padding: 2rem; max-width: 800px; margin: 0 auto;">
                    ${printContent}
                </div>
            `;
            
            window.print();
            document.body.innerHTML = originalContent;
            window.location.reload();
        };
        
        window.sendQuoteViaWhatsApp = function() {
            const clientPhone = document.getElementById('quoteClientPhone').value.trim();
            if (!clientPhone) {
                alert('Agreg√° el tel√©fono del cliente para enviar por WhatsApp');
                return;
            }
            
            const clientName = document.getElementById('quoteClientName').value.trim();
            const professionalName = professionalData?.name || 'Profesional TecniYa';
            
            const message = encodeURIComponent(
                `Hola ${clientName}! Te env√≠o el presupuesto solicitado a trav√©s de TecniYa.\n\n` +
                `Profesional: ${professionalName}\n` +
                `Pod√©s ver el detalle completo en tu panel de TecniYa.\n\n` +
                `Saludos cordiales.`
            );
            
            window.open(`https://wa.me/${clientPhone}?text=${message}`, '_blank');
        };
        
        // ============================================
        // UTILIDADES
        // ============================================
        function showMessage(containerId, text, type) {
            const container = document.getElementById(containerId);
            container.textContent = text;
            container.className = `message message-${type}`;
            container.style.display = 'block';
            
            // Auto-ocultar despu√©s de 5 segundos
            setTimeout(() => {
                container.style.display = 'none';
            }, 5000);
        }
        
        function showGlobalLoader(show) {
            document.getElementById('globalLoader').style.display = show ? 'flex' : 'none';
        }
    </script>
</body>
</html>
