<!DOCTYPE html>
<html lang="es-AR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TecniYa - Panel del Profesional</title>
    <meta name="description" content="Panel de control para t√©cnicos profesionales. Gestion√° tu perfil, destacados, presupuestos y ranking.">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%230a4fd8'/><text x='50' y='70' text-anchor='middle' font-size='60' fill='white'>üîß</text></svg>">
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
    
    <!-- CSS -->
    <style>
        :root {
            --primary: #0a4fd8;
            --primary-dark: #083bb5;
            --secondary: #1db954;
            --secondary-dark: #17a344;
            --accent: #ff9800;
            --danger: #dc3545;
            --warning: #ffc107;
            --info: #17a2b8;
            --light: #f8f9fa;
            --dark: #333;
            --gray: #666;
            --light-gray: #e1e5e9;
            --shadow: 0 4px 12px rgba(10, 79, 216, 0.15);
            --radius: 12px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
        }
        
        /* Layout */
        .container {
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, #1a60f0 100%);
            color: white;
            padding: 1.5rem 1rem;
            position: relative;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .logo-icon {
            font-size: 2rem;
            background: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            box-shadow: var(--shadow);
        }
        
        .logo-text {
            font-size: 1.5rem;
            font-weight: 800;
        }
        
        .user-info {
            text-align: right;
        }
        
        .user-email {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        /* Tabs */
        .tabs-container {
            background: white;
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            margin: 2rem auto;
        }
        
        .tabs-header {
            display: flex;
            background: white;
            border-bottom: 2px solid var(--light-gray);
            overflow-x: auto;
            padding: 0 20px;
        }
        
        .tab {
            padding: 1.2rem 1.5rem;
            font-weight: 600;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .tab.active {
            border-bottom-color: var(--primary);
            color: var(--primary);
            background-color: #f1f6ff;
        }
        
        .logout-btn {
            margin-left: auto;
            color: var(--danger);
            border-bottom-color: var(--danger) !important;
        }
        
        /* Panels */
        .panel {
            display: none;
            padding: 2.5rem;
        }
        
        .panel.active {
            display: block;
        }
        
        /* Login Container */
        .login-container {
            max-width: 500px;
            margin: 4rem auto;
            padding: 2.5rem;
            background: white;
            border-radius: 16px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .login-title {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 1.5rem;
            font-weight: 700;
        }
        
        .login-subtitle {
            color: var(--gray);
            margin-bottom: 2rem;
            font-size: 1.1rem;
        }
        
        /* Google Login */
        .google-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            width: 100%;
            padding: 1rem;
            background: white;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin: 1rem 0;
        }
        
        .google-btn:hover {
            background: #f8f9fa;
            border-color: #ccc;
        }
        
        .google-btn img {
            width: 20px;
            height: 20px;
        }
        
        /* Forms */
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--dark);
            font-size: 0.95rem;
        }
        
        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 1rem;
            border: 2px solid var(--light-gray);
            border-radius: 10px;
            font-size: 1rem;
            background: white;
        }
        
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(10, 79, 216, 0.1);
        }
        
        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        /* Checkbox Groups */
        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 12px;
            margin-top: 10px;
        }
        
        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 10px;
            background: #f8f9fa;
            padding: 14px 18px;
            border-radius: 8px;
            cursor: pointer;
            border: 2px solid transparent;
        }
        
        .checkbox-label input {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        
        /* File Upload */
        .file-upload {
            border: 3px dashed var(--light-gray);
            padding: 2.5rem;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 2rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .file-upload:hover {
            border-color: var(--primary);
            background: #f8f9fa;
        }
        
        .file-upload input {
            display: none;
        }
        
        .photo-preview {
            width: 200px;
            height: 200px;
            object-fit: cover;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            border: 3px solid white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 1rem 2rem;
            border-radius: 10px;
            font-weight: 600;
            font-size: 1rem;
            border: none;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.3s;
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--primary-dark);
        }
        
        .btn-success {
            background: var(--secondary);
            color: white;
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        
        .btn-warning {
            background: var(--warning);
            color: #333;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
        }
        
        .btn-group {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
            flex-wrap: wrap;
        }
        
        /* Status Cards */
        .status-card {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            border-left: 4px solid var(--accent);
        }
        
        .status-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .status-badge {
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.9rem;
        }
        
        .status-complete {
            background: #d4edda;
            color: #155724;
        }
        
        .status-incomplete {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-featured {
            background: #ffd700;
            color: #333;
        }
        
        .status-expired {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status-professional {
            background: #007bff;
            color: white;
        }
        
        .status-blocked {
            background: var(--danger);
            color: white;
        }
        
        /* Ranking Section */
        .ranking-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .ranking-score {
            font-size: 3rem;
            font-weight: 800;
            color: var(--primary);
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }
        
        .stat-card {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        
        .stat-label {
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        /* Jobs Section */
        .job-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .job-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .job-status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .job-pending {
            background: #fff3cd;
            color: #856404;
        }
        
        .job-in-progress {
            background: #cce5ff;
            color: #004085;
        }
        
        .job-completed {
            background: #d4edda;
            color: #155724;
        }
        
        .job-cancelled {
            background: #f8d7da;
            color: #721c24;
        }
        
        /* Notifications */
        .notification-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            border-left: 4px solid var(--warning);
        }
        
        .notification-urgent {
            border-left-color: var(--danger);
            background: #fff5f5;
        }
        
        /* Progress Bars */
        .progress-bar {
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--primary);
            border-radius: 4px;
        }
        
        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            border-radius: 16px;
            overflow-y: auto;
            padding: 2rem;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
        }
        
        /* Messages */
        .message {
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            font-weight: 600;
        }
        
        .message-success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }
        
        .message-error {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }
        
        .message-info {
            background: #d1ecf1;
            color: #0c5460;
            border-left: 4px solid #17a2b8;
        }
        
        /* Loader */
        .loader {
            display: none;
            justify-content: center;
            align-items: center;
            padding: 3rem;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
                gap: 1rem;
            }
            
            .tabs-header {
                flex-direction: column;
            }
            
            .tab {
                justify-content: center;
                padding: 1rem;
            }
            
            .logout-btn {
                margin-left: 0;
                margin-top: 1rem;
            }
            
            .panel {
                padding: 1.5rem;
            }
            
            .btn-group {
                flex-direction: column;
            }
            
            .checkbox-group {
                grid-template-columns: 1fr;
            }
            
            .photo-preview {
                width: 150px;
                height: 150px;
            }
        }

        /* New Styles for Improvements */
        .profile-completion-hint {
            font-size: 0.9rem;
            color: var(--gray);
            margin-top: 0.5rem;
        }

        .profile-completion-hint ul {
            margin-top: 0.5rem;
            padding-left: 1.5rem;
        }

        .profile-completion-hint li {
            margin-bottom: 0.25rem;
        }

        .profile-completion-hint .completed {
            color: var(--secondary);
        }

        .profile-completion-hint .pending {
            color: var(--warning);
        }

        .job-time-indicator {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 8px;
        }

        .job-time-normal {
            background: #d1ecf1;
            color: #0c5460;
        }

        .job-time-warning {
            background: #fff3cd;
            color: #856404;
        }

        .job-time-danger {
            background: #f8d7da;
            color: #721c24;
        }

        .notification-read-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
            color: var(--gray);
            margin-top: 1rem;
        }

        .notification-read-toggle input {
            width: 16px;
            height: 16px;
        }

        .certification-preview {
            max-width: 100%;
            max-height: 200px;
            border-radius: 8px;
            margin-top: 10px;
            border: 2px solid var(--light-gray);
        }

        .bulk-action-confirm {
            background: #fff3cd;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border-left: 4px solid var(--warning);
        }

        .change-history-item {
            padding: 0.75rem;
            border-bottom: 1px solid var(--light-gray);
            font-size: 0.9rem;
        }

        .change-history-item:last-child {
            border-bottom: none;
        }

        .change-field {
            font-weight: 600;
            color: var(--primary);
        }

        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 2rem;
        }

        .pagination-btn {
            padding: 8px 16px;
            border: 1px solid var(--light-gray);
            border-radius: 6px;
            background: white;
            cursor: pointer;
        }

        .pagination-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <!-- Login Container -->
    <div id="loginContainer" class="container login-container">
        <div class="logo" style="justify-content: center; margin-bottom: 1.5rem;">
            <div class="logo-icon">üîß</div>
            <h1 class="logo-text">TecniYa Pro</h1>
        </div>
        
        <h2 class="login-title">Panel del Profesional</h2>
        <p class="login-subtitle">Acced√© con tu cuenta de Google</p>
        
        <button id="googleLoginBtn" class="google-btn">
            <img src="https://www.google.com/favicon.ico" alt="Google">
            Ingresar con Google
        </button>
        
        <div id="loginMessage" class="message" style="display: none; margin-top: 1.5rem;"></div>
    </div>
    
    <!-- Main Panel -->
    <div id="mainPanel" style="display: none;">
        <!-- Header -->
        <header class="header">
            <div class="container header-content">
                <div class="logo">
                    <div class="logo-icon">üîß</div>
                    <div>
                        <h1 class="logo-text">TecniYa Pro</h1>
                        <div class="user-info">
                            <div class="user-email" id="userEmail"></div>
                            <div id="userStatus" style="font-size: 0.8rem; opacity: 0.8;"></div>
                        </div>
                    </div>
                </div>
                <div>
                    <button id="mainLogoutBtn" class="btn btn-danger">
                        üö™ Cerrar Sesi√≥n
                    </button>
                </div>
            </div>
        </header>
        
        <!-- Tabs -->
        <div class="container tabs-container">
            <div class="tabs-header">
                <div class="tab active" data-tab="dashboard">
                    üìä Dashboard
                </div>
                <div class="tab" data-tab="profile">
                    üë§ Perfil
                </div>
                <div class="tab" data-tab="jobs">
                    üõ†Ô∏è Trabajos
                </div>
                <div class="tab" data-tab="notifications">
                    üîî Notificaciones
                </div>
                <div class="tab" data-tab="featured">
                    ‚≠ê Destacados
                </div>
                <div class="tab" data-tab="certifications">
                    üìú Certificaciones
                </div>
                <div class="tab logout-btn" id="logoutBtn">
                    üö™ Cerrar Sesi√≥n
                </div>
            </div>
            
            <!-- Panels -->
            <div class="panels">
                <!-- DASHBOARD PANEL -->
                <div id="dashboardPanel" class="panel active">
                    <div class="status-card">
                        <div class="status-header">
                            <h2>Estado de tu Cuenta</h2>
                            <span id="accountStatusBadge" class="status-badge status-incomplete">
                                INCOMPLETO
                            </span>
                        </div>
                        
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-value" id="totalJobsCount">0</div>
                                <div class="stat-label">Total Trabajos</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="activeJobsCount">0</div>
                                <div class="stat-label">Trabajos Activos</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="ratingAverage">0.0</div>
                                <div class="stat-label">Rating Promedio</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="rankingScore">0</div>
                                <div class="stat-label">Puntaje Ranking</div>
                            </div>
                        </div>
                        
                        <div class="progress-bar">
                            <div class="progress-fill" id="profileCompleteProgress" style="width: 0%"></div>
                        </div>
                        <div id="completeProgressText">0% completado</div>
                        <div id="profileCompletionHint" class="profile-completion-hint"></div>
                    </div>
                    
                    <div class="status-card">
                        <div class="status-header">
                            <h3>Notificaciones Recientes</h3>
                        </div>
                        <div id="recentNotifications"></div>
                    </div>
                </div>
                
                <!-- PROFILE PANEL -->
                <div id="profilePanel" class="panel">
                    <div class="status-card">
                        <div class="status-header">
                            <h3>Estado del Perfil</h3>
                            <span id="profileStatusBadge" class="status-badge status-incomplete">
                                INCOMPLETO
                            </span>
                        </div>
                        <p>Complet√° tu perfil para aparecer en las b√∫squedas.</p>
                    </div>
                    
                    <form id="profileForm">
                        <div class="form-group">
                            <label class="form-label">Nombre completo *</label>
                            <input type="text" id="profileName" class="form-input" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Tel√©fono WhatsApp *</label>
                            <input type="tel" id="profilePhone" class="form-input" 
                                   placeholder="3417558966" required pattern="[0-9]{10,13}">
                            <small style="color: var(--gray); display: block; margin-top: 0.5rem;">
                                Los clientes te contactar√°n por este n√∫mero
                            </small>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Provincia *</label>
                            <select id="profileProvincia" class="form-select" required>
                                <option value="">Seleccion√° una provincia</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Ciudad *</label>
                            <select id="profileCiudad" class="form-select" required disabled>
                                <option value="">Seleccion√° una ciudad</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Zonas/Barrios donde trabaj√°s *</label>
                            <input type="text" id="profileZonas" class="form-input" 
                                   placeholder="Ej: Centro, Norte, Oeste (separ√° con comas)" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Rubros *</label>
                            <div class="checkbox-group" id="rubrosCheckbox">
                                <label class="checkbox-label">
                                    <input type="checkbox" value="plomeria">
                                    <span>Plomer√≠a</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" value="gas">
                                    <span>Gas</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" value="electricidad">
                                    <span>Electricidad</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" value="aire">
                                    <span>Aire Acondicionado</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" value="albanileria">
                                    <span>Alba√±iler√≠a</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" value="pintura">
                                    <span>Pintura</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" value="cerrajeria">
                                    <span>Cerrajer√≠a</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" value="jardineria">
                                    <span>Jardiner√≠a</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" value="herreria">
                                    <span>Herrer√≠a</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" value="carpinteria">
                                    <span>Carpinter√≠a</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" value="limpieza">
                                    <span>Limpieza</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" value="mudanzas">
                                    <span>Mudanzas</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" value="otros">
                                    <span>Otros servicios</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Foto de perfil *</label>
                            <div class="file-upload" onclick="document.getElementById('photoUpload').click()">
                                <img id="photoPreview" class="photo-preview" 
                                     src="https://via.placeholder.com/200x200/0a4fd8/ffffff?text=SUBIR+FOTO"
                                     alt="Vista previa de foto">
                                <p>üì∏ Hac√© clic para subir una foto</p>
                                <p style="color: var(--gray); font-size: 0.9rem; margin-top: 0.5rem;">
                                    La foto debe ser clara y profesional (max. 5MB, JPG/PNG)
                                </p>
                                <input type="file" id="photoUpload" accept="image/jpeg,image/png">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Descripci√≥n breve *</label>
                            <textarea id="profileBio" class="form-textarea" 
                                      placeholder="Ej: Especialista en instalaciones el√©ctricas con 10 a√±os de experiencia..."
                                      maxlength="200" required></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">A√±os de experiencia *</label>
                            <input type="number" id="profileExperience" class="form-input" 
                                   min="0" max="50" required>
                        </div>
                        
                        <div class="btn-group">
                            <button type="submit" class="btn btn-primary">
                                üíæ Guardar perfil
                            </button>
                            <button type="button" id="updateActivityBtn" class="btn btn-secondary">
                                üîÑ Marcar como activo
                            </button>
                        </div>
                    </form>
                    
                    <div id="profileMessage" class="message" style="display: none; margin-top: 1.5rem;"></div>

                    <!-- Change History -->
                    <div class="status-card" id="changeHistorySection" style="display: none;">
                        <div class="status-header">
                            <h3>üìù Historial de Cambios</h3>
                        </div>
                        <div id="changeHistoryList"></div>
                    </div>
                </div>
                
                <!-- JOBS PANEL -->
                <div id="jobsPanel" class="panel">
                    <div class="status-card">
                        <div class="status-header">
                            <h3>Mis Trabajos</h3>
                            <div style="display: flex; gap: 10px;">
                                <button id="sendRemindersBtn" class="btn btn-warning btn-sm">
                                    ‚è∞ Recordatorios
                                </button>
                                <button id="exportJobsBtn" class="btn btn-secondary btn-sm">
                                    üìä Exportar
                                </button>
                            </div>
                        </div>
                        
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-value" id="pendingJobsCount">0</div>
                                <div class="stat-label">Pendientes</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="inProgressJobsCount">0</div>
                                <div class="stat-label">En Progreso</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="completedJobsCount">0</div>
                                <div class="stat-label">Completados</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="cancelledJobsCount">0</div>
                                <div class="stat-label">Cancelados</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <div style="flex: 1; min-width: 200px;">
                                <label class="form-label">Filtrar por estado</label>
                                <select id="jobFilter" class="form-select">
                                    <option value="">Todos los trabajos</option>
                                    <option value="pendiente">Pendientes</option>
                                    <option value="en_progreso">En Progreso</option>
                                    <option value="completado">Completados</option>
                                    <option value="cancelado">Cancelados</option>
                                </select>
                            </div>
                            <div style="flex: 1; min-width: 200px;">
                                <label class="form-label">Ordenar por</label>
                                <select id="jobSort" class="form-select">
                                    <option value="fecha_desc">Fecha (m√°s reciente)</option>
                                    <option value="fecha_asc">Fecha (m√°s antigua)</option>
                                    <option value="precio_desc">Precio (mayor)</option>
                                    <option value="precio_asc">Precio (menor)</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div id="jobsList"></div>
                    
                    <!-- Pagination -->
                    <div class="pagination" id="jobsPagination" style="display: none;">
                        <button id="prevPage" class="pagination-btn">‚Üê Anterior</button>
                        <span id="pageInfo" style="padding: 8px 16px;"></span>
                        <button id="nextPage" class="pagination-btn">Siguiente ‚Üí</button>
                    </div>
                </div>
                
                <!-- NOTIFICATIONS PANEL -->
                <div id="notificationsPanel" class="panel">
                    <div class="status-card">
                        <div class="status-header">
                            <h3>üîî Sistema de Notificaciones</h3>
                            <div>
                                <label class="notification-read-toggle">
                                    <input type="checkbox" id="autoMarkRead">
                                    Marcar como le√≠das autom√°ticamente
                                </label>
                            </div>
                        </div>
                        <p style="margin-bottom: 1rem;">Aqu√≠ recibir√°s notificaciones importantes sobre tu cuenta y trabajos.</p>
                    </div>
                    
                    <div id="notificationsList"></div>
                </div>
                
                <!-- FEATURED PANEL -->
                <div id="featuredPanel" class="panel">
                    <div class="status-card">
                        <div class="status-header">
                            <h3>Estado del Destacado</h3>
                            <span id="featuredStatusBadge" class="status-badge status-incomplete">
                                NO DESTACADO
                            </span>
                        </div>
                        <div id="featuredInfo"></div>
                    </div>
                    
                    <div class="status-card">
                        <h3>üåü Planes de Destacado</h3>
                        <p style="color: var(--gray); margin-bottom: 1rem;">
                            <strong>üí≥ M√©todo de pago:</strong> Transferencia bancaria o Mercado Pago
                        </p>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 2rem 0;">
                            <div style="background: white; border: 2px solid var(--light-gray); border-radius: 12px; padding: 2rem; text-align: center;">
                                <div style="font-size: 1.5rem; font-weight: 700; color: var(--primary); margin-bottom: 1rem;">1 mes</div>
                                <div style="font-size: 2.5rem; font-weight: 800; margin: 1rem 0;">$5.000</div>
                                <ul style="text-align: left; margin: 1.5rem 0; list-style: none; padding: 0;">
                                    <li>‚úÖ Aparec√© primero en b√∫squedas</li>
                                    <li>‚úÖ Badge especial en tu perfil</li>
                                    <li>‚úÖ Mayor visibilidad</li>
                                </ul>
                                <button onclick="selectFeaturedPlan(1)" class="btn btn-primary btn-sm">
                                    Seleccionar
                                </button>
                            </div>
                            
                            <div style="background: white; border: 2px solid var(--primary); border-radius: 12px; padding: 2rem; text-align: center; position: relative;">
                                <div style="position: absolute; top: -10px; left: 50%; transform: translateX(-50%); background: var(--primary); color: white; padding: 5px 15px; border-radius: 20px; font-size: 0.8rem; font-weight: bold;">
                                    RECOMENDADO
                                </div>
                                <div style="font-size: 1.5rem; font-weight: 700; color: var(--primary); margin-bottom: 1rem;">12 meses</div>
                                <div style="font-size: 2.5rem; font-weight: 800; margin: 1rem 0;">$42.000</div>
                                <div style="color: var(--gray); margin-bottom: 1rem;">$3.500/mes</div>
                                <ul style="text-align: left; margin: 1.5rem 0; list-style: none; padding: 0;">
                                    <li>‚úÖ TODOS los beneficios del plan b√°sico</li>
                                    <li>‚úÖ Habilita certificaciones</li>
                                    <li>‚úÖ Plan Profesional incluido</li>
                                    <li>‚úÖ +10 puntos en el ranking</li>
                                </ul>
                                <button onclick="selectFeaturedPlan(12)" class="btn btn-primary btn-sm">
                                    Seleccionar
                                </button>
                            </div>
                        </div>
                        
                        <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px; margin-top: 2rem;">
                            <h4>üìã Datos para Transferencia</h4>
                            <div style="margin-top: 1rem;">
                                <p><strong>üè¶ Banco:</strong> Banco de la Naci√≥n Argentina</p>
                                <p><strong>üí∞ CBU:</strong> 0110599540000415590015</p>
                                <p><strong>üìù Alias:</strong> TECNIYA.DESTACADOS</p>
                                <p><strong>üë§ Titular:</strong> TecniYa S.R.L.</p>
                                <p><strong>üìß Enviar comprobante a:</strong> comprobantes@tecniya.com</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- CERTIFICATIONS PANEL -->
                <div id="certificationsPanel" class="panel">
                    <div class="status-card">
                        <div class="status-header">
                            <h3>Estado de Certificaciones</h3>
                            <span id="certificationStatusBadge" class="status-badge status-incomplete">
                                NO DISPONIBLE
                            </span>
                        </div>
                        
                        <div id="certificationInfo">
                            <p style="color: var(--gray); margin-bottom: 1rem;">
                                Las certificaciones est√°n disponibles solo con Plan Profesional activo.
                            </p>
                            <p><strong>‚úÖ Plan Profesional incluye:</strong></p>
                            <ul style="margin: 1rem 0 1rem 1.5rem; color: var(--dark);">
                                <li>Subida de certificaciones verificadas</li>
                                <li>Badge especial en tu perfil</li>
                                <li>Mayor confianza para los clientes</li>
                                <li>+10 puntos en el ranking</li>
                            </ul>
                            <p><strong>üí° ¬øC√≥mo activar Plan Profesional?</strong></p>
                            <p>Complet√° 12 meses de plan Destacado para habilitar las certificaciones autom√°ticamente.</p>
                        </div>
                    </div>
                    
                    <div id="certificationUploadSection" style="display: none;">
                        <div class="status-card">
                            <h3>üìú Subir Certificaciones</h3>
                            <div class="file-upload" onclick="document.getElementById('certificationUpload').click()" style="margin: 1.5rem 0;">
                                <p style="font-size: 3rem;">üìÑ</p>
                                <p><strong>‚ûï Agregar nueva certificaci√≥n</strong></p>
                                <p style="color: var(--gray); font-size: 0.9rem; margin-top: 0.5rem;">
                                    Hac√© clic para subir certificaci√≥n (PDF o imagen, max. 10MB)
                                </p>
                                <input type="file" id="certificationUpload" accept=".pdf,.jpg,.jpeg,.png">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">T√≠tulo de la certificaci√≥n *</label>
                                <input type="text" id="certificationTitle" class="form-input" placeholder="Ej: Gasista Matriculado Clase III">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Instituci√≥n emisora *</label>
                                <input type="text" id="certificationInstitution" class="form-input" placeholder="Ej: ENARGAS">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">N√∫mero de certificaci√≥n</label>
                                <input type="text" id="certificationNumber" class="form-input" placeholder="N√∫mero de matr√≠cula">
                            </div>
                            
                            <button id="addCertificationBtn" class="btn btn-primary" disabled>‚ûï Agregar Certificaci√≥n</button>
                        </div>
                        
                        <h4 style="margin-top: 2rem;">üìã Mis Certificaciones</h4>
                        <div id="certificationsList"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Job Detail Modal -->
    <div id="jobModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="jobModalTitle">Detalle del Trabajo</h3>
                <button class="modal-close" onclick="closeJobModal()">&times;</button>
            </div>
            <div id="jobModalContent"></div>
        </div>
    </div>

    <!-- Bulk Action Confirm Modal -->
    <div id="bulkConfirmModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Confirmar Acci√≥n Masiva</h3>
                <button class="modal-close" onclick="closeBulkConfirmModal()">&times;</button>
            </div>
            <div id="bulkConfirmContent"></div>
            <div style="display: flex; gap: 10px; margin-top: 2rem;">
                <button id="confirmBulkAction" class="btn btn-danger">Confirmar</button>
                <button onclick="closeBulkConfirmModal()" class="btn btn-secondary">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Global Loader -->
    <div id="globalLoader" class="loader">
        <div class="spinner"></div>
    </div>

    <script>
        // Configuraci√≥n Firebase - ACTUALIZADA
        const firebaseConfig = {
            apiKey: "AIzaSyBzDfYDdzmN9J_Y8gG06aqH0OtlzFhafFY",
            authDomain: "tecniya-b4206.firebaseapp.com",
            projectId: "tecniya-b4206",
            storageBucket: "tecniya-b4206.firebasestorage.app",
            messagingSenderId: "166424133304",
            appId: "1:166424133304:web:d1ad23bd4ea1af10437e4d"
        };

        // Variables globales
        let auth, db, storage, currentUser, professionalId = null, professionalData = null;
        let selectedFeaturedPlan = null;
        let currentCertificationFile = null;
        let currentPage = 1;
        const jobsPerPage = 10;
        let totalJobs = 0;
        let jobFilter = '';
        let jobSort = 'fecha_desc';
        let userBlocked = false;

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                // Verificar si ya hay una app inicializada
                if (!firebase.apps.length) {
                    firebase.initializeApp(firebaseConfig);
                }
                auth = firebase.auth();
                db = firebase.firestore();
                storage = firebase.storage();
                
                // Configurar Google Provider
                const googleProvider = new firebase.auth.GoogleAuthProvider();
                googleProvider.addScope('email');
                googleProvider.addScope('profile');
                
                // Event listeners
                document.getElementById('googleLoginBtn').addEventListener('click', () => {
                    auth.signInWithPopup(googleProvider).catch(error => {
                        showMessage('loginMessage', '‚ùå Error al iniciar sesi√≥n: ' + error.message, 'error');
                    });
                });
                
                document.getElementById('mainLogoutBtn')?.addEventListener('click', handleLogout);
                document.getElementById('logoutBtn')?.addEventListener('click', handleLogout);
                
                // Tabs
                document.querySelectorAll('.tab[data-tab]').forEach(tab => {
                    tab.addEventListener('click', () => switchTab(tab.dataset.tab));
                });
                
                // Formulario de perfil
                document.getElementById('profileForm')?.addEventListener('submit', saveProfile);
                document.getElementById('updateActivityBtn')?.addEventListener('click', updateActivity);
                
                // Upload de foto
                document.getElementById('photoUpload').addEventListener('change', handlePhotoUpload);
                
                // Upload de certificaci√≥n
                document.getElementById('certificationUpload').addEventListener('change', handleCertificationUpload);
                document.getElementById('addCertificationBtn').addEventListener('click', addCertification);
                
                // Filtros y ordenamiento de trabajos
                document.getElementById('jobFilter').addEventListener('change', function() {
                    jobFilter = this.value;
                    currentPage = 1;
                    loadJobs();
                });
                
                document.getElementById('jobSort').addEventListener('change', function() {
                    jobSort = this.value;
                    currentPage = 1;
                    loadJobs();
                });
                
                // Paginaci√≥n
                document.getElementById('prevPage').addEventListener('click', () => {
                    if (currentPage > 1) {
                        currentPage--;
                        loadJobs();
                    }
                });
                
                document.getElementById('nextPage').addEventListener('click', () => {
                    const totalPages = Math.ceil(totalJobs / jobsPerPage);
                    if (currentPage < totalPages) {
                        currentPage++;
                        loadJobs();
                    }
                });
                
                // Recordatorios
                document.getElementById('sendRemindersBtn').addEventListener('click', sendJobReminders);
                
                // Exportar trabajos
                document.getElementById('exportJobsBtn').addEventListener('click', exportJobsToCSV);
                
                // Auto mark read notifications
                document.getElementById('autoMarkRead').addEventListener('change', function() {
                    localStorage.setItem('autoMarkRead', this.checked);
                });
                
                // Cargar preferencia de auto mark read
                const autoMarkRead = localStorage.getItem('autoMarkRead') === 'true';
                document.getElementById('autoMarkRead').checked = autoMarkRead;
                
                // Cargar provincias
                await loadProvincias();
                
                // Verificar autenticaci√≥n
                auth.onAuthStateChanged(handleAuthStateChange);
                
            } catch (error) {
                console.error('Error inicializando:', error);
                showMessage('loginMessage', '‚ùå Error al inicializar la aplicaci√≥n', 'error');
            }
        });

        // Manejo de autenticaci√≥n
        async function handleAuthStateChange(user) {
            if (user) {
                currentUser = user;
                const professionalExists = await checkProfessionalExists(user.uid);
                
                if (!professionalExists) {
                    await createProfessionalProfile(user);
                }
                
                await loadProfessionalProfile();
                showMainPanel();
            } else {
                showLoginPanel();
            }
        }

        async function checkProfessionalExists(userId) {
            try {
                const snapshot = await db.collection('professionals')
                    .where('userId', '==', userId)
                    .limit(1)
                    .get();
                return !snapshot.empty;
            } catch (error) {
                console.error('Error verificando profesional:', error);
                return false;
            }
        }

        async function createProfessionalProfile(user) {
            try {
                const professionalRef = await db.collection('professionals').add({
                    userId: user.uid,
                    email: user.email,
                    name: user.displayName || '',
                    phone: '',
                    photoUrl: user.photoURL || '',
                    bio: '',
                    provincia: '',
                    ciudad: '',
                    zonas: [],
                    rubros: [],
                    certifications: [],
                    experienceYears: 0,
                    completedJobs: 0,
                    totalJobs: 0,
                    active: true,
                    profileCompleted: false,
                    isFeatured: false,
                    featuredUntil: null,
                    hasProfessionalPlan: false,
                    rankingScore: 0,
                    averageRating: 0,
                    totalRatings: 0,
                    lastActive: firebase.firestore.FieldValue.serverTimestamp(),
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    blocked: false,
                    notifications: [],
                    changeHistory: [{
                        field: 'account_created',
                        oldValue: null,
                        newValue: 'active',
                        timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                        changedBy: 'system'
                    }]
                });
                
                professionalId = professionalRef.id;
                
                // Crear notificaci√≥n de bienvenida
                await db.collection('professionals').doc(professionalId).update({
                    notifications: firebase.firestore.FieldValue.arrayUnion({
                        type: 'welcome',
                        title: '¬°Bienvenido a TecniYa Pro!',
                        message: 'Complet√° tu perfil para comenzar a recibir trabajos.',
                        date: new Date().toISOString(),
                        read: false,
                        id: Date.now().toString()
                    })
                });
                
            } catch (error) {
                console.error('Error creando perfil profesional:', error);
                throw error;
            }
        }

        async function loadProfessionalProfile() {
            showGlobalLoader(true);
            
            try {
                // Buscar profesional por userId (m√°s confiable que email)
                const snapshot = await db.collection('professionals')
                    .where('userId', '==', currentUser.uid)
                    .limit(1)
                    .get();
                
                if (snapshot.empty) {
                    showMessage('loginMessage', '‚ùå No se encontr√≥ tu perfil profesional', 'error');
                    auth.signOut();
                    return;
                }
                
                const doc = snapshot.docs[0];
                professionalId = doc.id;
                professionalData = { id: doc.id, ...doc.data() };
                
                // Verificar si la cuenta est√° bloqueada
                if (professionalData.blocked) {
                    userBlocked = true;
                    showBlockedMessage();
                    return;
                }
                
                // Verificar trabajos pendientes por m√°s de 30 d√≠as (con notificaci√≥n previa)
                await checkOverdueJobs();
                
                updateUserInfo();
                loadDashboardData();
                updateProfileUI();
                loadJobs();
                loadNotifications();
                checkFeaturedStatus();
                loadChangeHistory();
                
            } catch (error) {
                console.error('Error cargando perfil:', error);
                showMessage('profileMessage', '‚ùå Error cargando perfil', 'error');
            } finally {
                showGlobalLoader(false);
            }
        }

        function showBlockedMessage() {
            document.getElementById('loginContainer').style.display = 'none';
            document.getElementById('mainPanel').style.display = 'block';
            
            // Mostrar solo el dashboard con mensaje de bloqueo
            switchTab('dashboard');
            document.querySelectorAll('.tab').forEach(tab => {
                if (tab.dataset.tab !== 'dashboard') {
                    tab.style.display = 'none';
                }
            });
            
            document.getElementById('dashboardPanel').innerHTML = `
                <div class="status-card" style="border-left-color: var(--danger);">
                    <div class="status-header">
                        <h2>‚ùå Cuenta Bloqueada</h2>
                        <span class="status-badge status-blocked">BLOQUEADO</span>
                    </div>
                    <p style="margin-bottom: 1rem;">Tu cuenta ha sido bloqueada por las siguientes razones:</p>
                    <p style="color: var(--danger); font-weight: 600; margin-bottom: 1rem;">
                        ${professionalData.blockedReason || 'Violaci√≥n de los t√©rminos del servicio'}
                    </p>
                    <p style="margin-bottom: 1.5rem;">
                        Para apelar esta decisi√≥n, contactate con nuestro equipo de soporte:
                    </p>
                    <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px;">
                        <p><strong>üìß Email:</strong> soporte@tecniya.com</p>
                        <p><strong>üìû Tel√©fono:</strong> 341 755-8966</p>
                        <p><strong>üïê Horario:</strong> Lunes a Viernes de 9:00 a 18:00</p>
                    </div>
                    <div style="margin-top: 2rem;">
                        <button onclick="auth.signOut()" class="btn btn-danger">
                            üö™ Cerrar Sesi√≥n
                        </button>
                    </div>
                </div>
            `;
        }

        function updateUserInfo() {
            document.getElementById('userEmail').textContent = currentUser.email;
            
            const statusEl = document.getElementById('userStatus');
            if (professionalData.profileCompleted) {
                statusEl.textContent = '‚úÖ Perfil completo';
                statusEl.style.color = '#28a745';
            } else {
                statusEl.textContent = '‚ö† Perfil incompleto';
                statusEl.style.color = '#ffc107';
            }
        }

        // Verificar trabajos vencidos con notificaci√≥n previa
        async function checkOverdueJobs() {
            if (!professionalId) return;
            
            const now = new Date();
            const twentyFiveDaysAgo = new Date(now.getTime() - (25 * 24 * 60 * 60 * 1000));
            const thirtyDaysAgo = new Date(now.getTime() - (30 * 24 * 60 * 60 * 1000));
            const thirtyFiveDaysAgo = new Date(now.getTime() - (35 * 24 * 60 * 60 * 1000));
            
            try {
                const snapshot = await db.collection('jobs')
                    .where('professionalId', '==', professionalId)
                    .where('status', '==', 'en_progreso')
                    .get();
                
                if (!snapshot.empty) {
                    const overdueJobs = [];
                    const criticalJobs = [];
                    
                    snapshot.forEach(doc => {
                        const job = doc.data();
                        const jobDate = job.createdAt?.toDate ? job.createdAt.toDate() : new Date(job.createdAt);
                        
                        if (jobDate < thirtyFiveDaysAgo) {
                            criticalJobs.push({ id: doc.id, ...job });
                        } else if (jobDate < thirtyDaysAgo) {
                            overdueJobs.push({ id: doc.id, ...job });
                        }
                    });
                    
                    // Notificaci√≥n a los 25 d√≠as
                    if (overdueJobs.length > 0) {
                        await db.collection('professionals').doc(professionalId).update({
                            notifications: firebase.firestore.FieldValue.arrayUnion({
                                type: 'warning',
                                title: 'Trabajos pr√≥ximos a vencer',
                                message: `Ten√©s ${overdueJobs.length} trabajo(s) en progreso por m√°s de 25 d√≠as. Finalizalos pronto para evitar bloqueos.`,
                                date: new Date().toISOString(),
                                read: false,
                                id: Date.now().toString()
                            })
                        });
                    }
                    
                    // Bloqueo a los 35 d√≠as con notificaci√≥n previa
                    if (criticalJobs.length > 0) {
                        // Primero, notificar sobre el bloqueo inminente
                        await db.collection('professionals').doc(professionalId).update({
                            notifications: firebase.firestore.FieldValue.arrayUnion({
                                type: 'urgent',
                                title: '‚ö†Ô∏è BLOQUEO INMINENTE DE CUENTA',
                                message: `Ten√©s ${criticalJobs.length} trabajo(s) en progreso por m√°s de 35 d√≠as. Tu cuenta ser√° bloqueada en 48 horas si no los finaliz√°s.`,
                                date: new Date().toISOString(),
                                read: false,
                                id: Date.now().toString()
                            })
                        });
                        
                        // Esperar 48 horas antes de bloquear
                        const blockTime = new Date(now.getTime() + (48 * 60 * 60 * 1000));
                        
                        // Programar bloqueo (en producci√≥n, usar Cloud Functions)
                        setTimeout(async () => {
                            // Verificar si los trabajos siguen pendientes
                            const currentSnapshot = await db.collection('jobs')
                                .where('professionalId', '==', professionalId)
                                .where('status', '==', 'en_progreso')
                                .where('createdAt', '<', thirtyFiveDaysAgo)
                                .get();
                            
                            if (!currentSnapshot.empty) {
                                // Bloquear cuenta
                                await db.collection('professionals').doc(professionalId).update({
                                    blocked: true,
                                    blockedReason: 'Trabajos pendientes por m√°s de 35 d√≠as',
                                    blockedAt: firebase.firestore.FieldValue.serverTimestamp()
                                });
                                
                                // Notificar al administrador
                                await db.collection('admin_notifications').add({
                                    type: 'account_blocked_auto',
                                    professionalId: professionalId,
                                    professionalName: professionalData.name,
                                    reason: 'Trabajos pendientes por m√°s de 35 d√≠as',
                                    count: currentSnapshot.size,
                                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                                });
                            }
                        }, 48 * 60 * 60 * 1000);
                    }
                }
            } catch (error) {
                console.error('Error verificando trabajos vencidos:', error);
            }
        }

        // UI Functions
        function showLoginPanel() {
            document.getElementById('loginContainer').style.display = 'block';
            document.getElementById('mainPanel').style.display = 'none';
            userBlocked = false;
        }

        function showMainPanel() {
            document.getElementById('loginContainer').style.display = 'none';
            document.getElementById('mainPanel').style.display = 'block';
        }

        function switchTab(tabId) {
            if (userBlocked && tabId !== 'dashboard') {
                showMessage('profileMessage', '‚ùå Tu cuenta est√° bloqueada. Solo pod√©s ver el dashboard.', 'error');
                return;
            }
            
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.panel').forEach(panel => {
                panel.classList.remove('active');
            });
            
            const tabElement = document.querySelector(`.tab[data-tab="${tabId}"]`);
            const panelElement = document.getElementById(`${tabId}Panel`);
            
            if (tabElement) tabElement.classList.add('active');
            if (panelElement) panelElement.classList.add('active');
            
            if (tabId === 'dashboard') loadDashboardData();
            if (tabId === 'jobs') loadJobs();
            if (tabId === 'notifications') loadNotifications();
            if (tabId === 'certifications') loadCertifications();
        }

        function handleLogout() {
            if (confirm('¬øEst√°s seguro de querer cerrar sesi√≥n?')) {
                auth.signOut();
            }
        }

        // Dashboard
        async function loadDashboardData() {
            if (!professionalId) return;
            
            try {
                // Actualizar estad√≠sticas
                document.getElementById('totalJobsCount').textContent = professionalData.totalJobs || 0;
                document.getElementById('activeJobsCount').textContent = professionalData.totalJobs - (professionalData.completedJobs || 0);
                document.getElementById('ratingAverage').textContent = (professionalData.averageRating || 0).toFixed(1);
                document.getElementById('rankingScore').textContent = professionalData.rankingScore || 0;
                
                // Calcular porcentaje de perfil completado con campos espec√≠ficos
                const requiredFields = [
                    { field: 'name', value: professionalData.name, label: 'Nombre completo' },
                    { field: 'phone', value: professionalData.phone, label: 'Tel√©fono WhatsApp' },
                    { field: 'photoUrl', value: professionalData.photoUrl, label: 'Foto de perfil' },
                    { field: 'provincia', value: professionalData.provincia, label: 'Provincia' },
                    { field: 'ciudad', value: professionalData.ciudad, label: 'Ciudad' },
                    { field: 'zonas', value: professionalData.zonas?.length > 0, label: 'Zonas de trabajo' },
                    { field: 'rubros', value: professionalData.rubros?.length > 0, label: 'Rubros' },
                    { field: 'bio', value: professionalData.bio, label: 'Descripci√≥n breve' },
                    { field: 'experienceYears', value: professionalData.experienceYears, label: 'A√±os de experiencia' }
                ];
                
                const completedCount = requiredFields.filter(field => field.value && 
                    (typeof field.value !== 'boolean' ? field.value.toString().trim() : field.value)).length;
                const totalCount = requiredFields.length;
                const percentage = Math.round((completedCount / totalCount) * 100);
                
                document.getElementById('profileCompleteProgress').style.width = `${percentage}%`;
                document.getElementById('completeProgressText').textContent = `${percentage}% completado`;
                
                // Mostrar campos faltantes
                const missingFields = requiredFields.filter(field => !field.value || 
                    (typeof field.value === 'boolean' ? !field.value : !field.value.toString().trim()));
                
                let hintHTML = '';
                if (missingFields.length > 0) {
                    hintHTML = '<p>Campos faltantes para completar el perfil:</p><ul>';
                    missingFields.forEach(field => {
                        hintHTML += `<li class="pending">${field.label}</li>`;
                    });
                    hintHTML += '</ul>';
                } else {
                    hintHTML = '<p class="completed">‚úÖ ¬°Tu perfil est√° completo!</p>';
                }
                
                document.getElementById('profileCompletionHint').innerHTML = hintHTML;
                
                const statusBadge = document.getElementById('accountStatusBadge');
                if (percentage === 100 && professionalData.profileCompleted) {
                    statusBadge.textContent = 'ACTIVO';
                    statusBadge.className = 'status-badge status-complete';
                } else {
                    statusBadge.textContent = 'INCOMPLETO';
                    statusBadge.className = 'status-badge status-incomplete';
                }
                
                // Cargar notificaciones recientes
                await loadRecentNotifications();
                
            } catch (error) {
                console.error('Error cargando dashboard:', error);
            }
        }

        async function loadRecentNotifications() {
            const container = document.getElementById('recentNotifications');
            if (!container) return;
            
            try {
                const notifications = professionalData.notifications || [];
                const recent = notifications.slice(-5).reverse();
                
                if (recent.length === 0) {
                    container.innerHTML = '<p style="color: var(--gray);">No hay notificaciones recientes.</p>';
                    return;
                }
                
                let html = '';
                recent.forEach(notif => {
                    html += `
                        <div class="notification-card ${notif.type === 'urgent' ? 'notification-urgent' : ''}">
                            <div style="display: flex; justify-content: space-between; align-items: start;">
                                <div>
                                    <h4 style="margin: 0;">${notif.title}</h4>
                                    <p style="margin: 0.5rem 0;">${notif.message}</p>
                                    <small style="color: var(--gray);">${new Date(notif.date).toLocaleDateString('es-AR')}</small>
                                </div>
                                ${!notif.read ? '<span style="background: var(--primary); color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.8rem;">NUEVO</span>' : ''}
                            </div>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
                
            } catch (error) {
                console.error('Error cargando notificaciones:', error);
            }
        }

        // Perfil
        async function loadProvincias() {
            try {
                // Intentar cargar desde Firestore
                const doc = await db.collection('config').doc('provincias').get();
                let provinciasData = {};
                
                if (doc.exists) {
                    provinciasData = doc.data();
                } else {
                    // Datos por defecto
                    provinciasData = {
                        "Buenos Aires": ["La Plata", "Mar del Plata", "Bah√≠a Blanca", "Quilmes", "Lomas de Zamora"],
                        "CABA": ["Capital Federal"],
                        "C√≥rdoba": ["C√≥rdoba", "Villa Mar√≠a", "R√≠o Cuarto", "Alta Gracia"],
                        "Santa Fe": ["Rosario", "Santa Fe", "Rafaela", "Venado Tuerto"],
                        "Mendoza": ["Mendoza", "San Rafael", "Godoy Cruz", "Guaymall√©n"],
                        "Tucum√°n": ["San Miguel de Tucum√°n", "Yerba Buena", "Taf√≠ Viejo"],
                        "Salta": ["Salta", "San Ram√≥n de la Nueva Or√°n", "Tartagal"],
                        "Entre R√≠os": ["Paran√°", "Concordia", "Gualeguaych√∫"],
                        "Corrientes": ["Corrientes", "Goya", "Mercedes"],
                        "Chaco": ["Resistencia", "Barranqueras", "Fontana"],
                        "Misiones": ["Posadas", "Ober√°", "Eldorado"],
                        "Santiago del Estero": ["Santiago del Estero", "La Banda", "Fr√≠as"],
                        "San Juan": ["San Juan", "Rivadavia", "Chimbas"],
                        "San Luis": ["San Luis", "Villa Mercedes", "Juana Koslay"],
                        "Neuqu√©n": ["Neuqu√©n", "Cutral-C√≥", "Plottier"],
                        "R√≠o Negro": ["Viedma", "Bariloche", "General Roca"],
                        "Chubut": ["Rawson", "Comodoro Rivadavia", "Trelew"],
                        "Santa Cruz": ["R√≠o Gallegos", "Caleta Olivia", "Puerto Deseado"],
                        "Tierra del Fuego": ["Ushuaia", "R√≠o Grande"],
                        "La Pampa": ["Santa Rosa", "General Pico", "Toay"],
                        "La Rioja": ["La Rioja", "Chilecito", "Aimogasta"],
                        "Catamarca": ["San Fernando del Valle de Catamarca", "Valle Viejo"],
                        "Formosa": ["Formosa", "Clorinda", "Piran√©"],
                        "Jujuy": ["San Salvador de Jujuy", "Palpal√°", "San Pedro"]
                    };
                    
                    // Guardar en Firestore
                    await db.collection('config').doc('provincias').set(provinciasData);
                }
                
                const select = document.getElementById('profileProvincia');
                Object.keys(provinciasData).sort().forEach(provincia => {
                    const option = document.createElement('option');
                    option.value = provincia;
                    option.textContent = provincia;
                    select.appendChild(option);
                });
                
                select.addEventListener('change', function() {
                    const ciudadSelect = document.getElementById('profileCiudad');
                    const provincia = this.value;
                    
                    if (!provincia) {
                        ciudadSelect.innerHTML = '<option value="">Seleccion√° una ciudad</option>';
                        ciudadSelect.disabled = true;
                        return;
                    }
                    
                    const ciudades = provinciasData[provincia] || ["Ciudad principal"];
                    ciudadSelect.innerHTML = '<option value="">Seleccion√° una ciudad</option>';
                    ciudades.forEach(ciudad => {
                        const option = document.createElement('option');
                        option.value = ciudad;
                        option.textContent = ciudad;
                        ciudadSelect.appendChild(option);
                    });
                    ciudadSelect.disabled = false;
                });
                
            } catch (error) {
                console.error('Error cargando provincias:', error);
            }
        }

        function updateProfileUI() {
            if (!professionalData) return;
            
            document.getElementById('profileName').value = professionalData.name || '';
            document.getElementById('profilePhone').value = professionalData.phone || '';
            document.getElementById('profileBio').value = professionalData.bio || '';
            document.getElementById('profileExperience').value = professionalData.experienceYears || 0;
            document.getElementById('profileZonas').value = professionalData.zonas ? professionalData.zonas.join(', ') : '';
            
            if (professionalData.provincia) {
                document.getElementById('profileProvincia').value = professionalData.provincia;
                
                // Disparar el evento change para cargar ciudades
                const event = new Event('change');
                document.getElementById('profileProvincia').dispatchEvent(event);
                
                // Esperar un momento para que se carguen las ciudades
                setTimeout(() => {
                    if (professionalData.ciudad) {
                        document.getElementById('profileCiudad').value = professionalData.ciudad;
                    }
                }, 100);
            }
            
            document.querySelectorAll('#rubrosCheckbox input').forEach(checkbox => {
                checkbox.checked = professionalData.rubros && 
                    professionalData.rubros.includes(checkbox.value);
            });
            
            const photoPreview = document.getElementById('photoPreview');
            if (professionalData.photoUrl && professionalData.photoUrl.startsWith('http')) {
                photoPreview.src = professionalData.photoUrl;
            } else if (professionalData.photoUrl) {
                // Si es una referencia a Storage, obtener la URL
                const storageRef = storage.ref(professionalData.photoUrl);
                storageRef.getDownloadURL().then(url => {
                    photoPreview.src = url;
                }).catch(() => {
                    photoPreview.src = 'https://via.placeholder.com/200x200/0a4fd8/ffffff?text=SIN+FOTO';
                });
            }
            
            updateProfileStatus();
        }

        function updateProfileStatus() {
            const statusBadge = document.getElementById('profileStatusBadge');
            if (professionalData.profileCompleted) {
                statusBadge.textContent = 'COMPLETO';
                statusBadge.className = 'status-badge status-complete';
            } else {
                statusBadge.textContent = 'INCOMPLETO';
                statusBadge.className = 'status-badge status-incomplete';
            }
        }

        async function handlePhotoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // Validaciones
            const validTypes = ['image/jpeg', 'image/png'];
            if (!validTypes.includes(file.type)) {
                alert('‚ùå Por favor seleccion√° una imagen v√°lida (JPG o PNG)');
                return;
            }
            
            if (file.size > 5 * 1024 * 1024) {
                alert('‚ùå La imagen debe ser menor a 5MB');
                return;
            }
            
            showGlobalLoader(true);
            
            try {
                // Subir a Firebase Storage
                const storageRef = storage.ref(`professionals/${professionalId}/profile/${Date.now()}_${file.name}`);
                const snapshot = await storageRef.put(file);
                const downloadURL = await snapshot.ref.getDownloadURL();
                
                // Actualizar vista previa
                document.getElementById('photoPreview').src = downloadURL;
                
                // Actualizar en Firestore
                await db.collection('professionals').doc(professionalId).update({
                    photoUrl: downloadURL,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                professionalData.photoUrl = downloadURL;
                showMessage('profileMessage', '‚úÖ Foto subida correctamente', 'success');
                
                // Agregar al historial de cambios
                await addChangeHistory('photoUrl', 'Foto actualizada');
                
            } catch (error) {
                console.error('Error subiendo foto:', error);
                showMessage('profileMessage', '‚ùå Error subiendo foto: ' + error.message, 'error');
            } finally {
                showGlobalLoader(false);
            }
        }

        async function saveProfile(e) {
            e.preventDefault();
            
            const name = document.getElementById('profileName').value.trim();
            const phone = document.getElementById('profilePhone').value.trim();
            const provincia = document.getElementById('profileProvincia').value;
            const ciudad = document.getElementById('profileCiudad').value;
            const zonas = document.getElementById('profileZonas').value.split(',').map(z => z.trim()).filter(z => z);
            const bio = document.getElementById('profileBio').value.trim();
            const experienceYears = parseInt(document.getElementById('profileExperience').value) || 0;
            
            // Validaci√≥n avanzada
            const errors = [];
            
            if (!name) errors.push('Nombre completo');
            if (!phone || !/^\d{10,13}$/.test(phone)) errors.push('Tel√©fono WhatsApp v√°lido (10-13 d√≠gitos)');
            if (!provincia) errors.push('Provincia');
            if (!ciudad) errors.push('Ciudad');
            if (zonas.length === 0) errors.push('Zonas de trabajo');
            if (!bio || bio.length < 20) errors.push('Descripci√≥n breve (m√≠nimo 20 caracteres)');
            if (!experienceYears || experienceYears < 0 || experienceYears > 50) errors.push('A√±os de experiencia v√°lidos');
            if (!professionalData.photoUrl) errors.push('Foto de perfil');
            
            const rubros = [];
            document.querySelectorAll('#rubrosCheckbox input:checked').forEach(checkbox => {
                rubros.push(checkbox.value);
            });
            
            if (rubros.length === 0) {
                errors.push('Al menos un rubro');
            }
            
            if (errors.length > 0) {
                showMessage('profileMessage', '‚ùå Complet√° los siguientes campos: ' + errors.join(', '), 'error');
                return;
            }
            
            showGlobalLoader(true);
            
            try {
                const oldData = { ...professionalData };
                const updateData = {
                    name,
                    phone,
                    provincia,
                    ciudad,
                    zonas,
                    rubros,
                    bio,
                    experienceYears,
                    profileCompleted: true,
                    lastActive: firebase.firestore.FieldValue.serverTimestamp(),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                // Detectar cambios para el historial
                const changes = [];
                Object.keys(updateData).forEach(key => {
                    if (key !== 'lastActive' && key !== 'updatedAt' && key !== 'profileCompleted') {
                        const oldValue = oldData[key];
                        const newValue = updateData[key];
                        
                        if (JSON.stringify(oldValue) !== JSON.stringify(newValue)) {
                            changes.push({
                                field: key,
                                oldValue: typeof oldValue === 'object' ? JSON.stringify(oldValue) : oldValue,
                                newValue: typeof newValue === 'object' ? JSON.stringify(newValue) : newValue
                            });
                        }
                    }
                });
                
                await db.collection('professionals').doc(professionalId).update(updateData);
                
                // Agregar cambios al historial
                for (const change of changes) {
                    await addChangeHistory(change.field, change.oldValue, change.newValue);
                }
                
                professionalData = { ...professionalData, ...updateData };
                updateProfileStatus();
                updateUserInfo();
                loadDashboardData();
                
                showMessage('profileMessage', '‚úÖ Perfil guardado correctamente', 'success');
                
            } catch (error) {
                console.error('Error guardando perfil:', error);
                showMessage('profileMessage', '‚ùå Error guardando perfil: ' + error.message, 'error');
            } finally {
                showGlobalLoader(false);
            }
        }

        async function addChangeHistory(field, oldValue, newValue = null) {
            try {
                const changeEntry = {
                    field: field,
                    oldValue: oldValue,
                    newValue: newValue,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    changedBy: 'professional'
                };
                
                await db.collection('professionals').doc(professionalId).update({
                    changeHistory: firebase.firestore.FieldValue.arrayUnion(changeEntry)
                });
                
            } catch (error) {
                console.error('Error agregando al historial:', error);
            }
        }

        async function loadChangeHistory() {
            try {
                const changeHistory = professionalData.changeHistory || [];
                
                if (changeHistory.length === 0) {
                    document.getElementById('changeHistorySection').style.display = 'none';
                    return;
                }
                
                document.getElementById('changeHistorySection').style.display = 'block';
                
                let html = '';
                changeHistory.slice(-10).reverse().forEach(change => {
                    const date = change.timestamp?.toDate ? change.timestamp.toDate().toLocaleString('es-AR') : 'Fecha desconocida';
                    
                    let changeText = '';
                    if (change.field === 'account_created') {
                        changeText = 'Cuenta creada';
                    } else if (change.newValue === null) {
                        changeText = `${getFieldLabel(change.field)}: ${change.oldValue}`;
                    } else {
                        changeText = `${getFieldLabel(change.field)} cambiado`;
                    }
                    
                    html += `
                        <div class="change-history-item">
                            <div style="display: flex; justify-content: space-between;">
                                <span class="change-field">${changeText}</span>
                                <small style="color: var(--gray);">${date}</small>
                            </div>
                            ${change.oldValue && change.newValue ? `
                                <div style="margin-top: 5px; font-size: 0.85rem;">
                                    <span style="color: var(--danger);">${formatChangeValue(change.oldValue)}</span>
                                    ‚Üí 
                                    <span style="color: var(--success);">${formatChangeValue(change.newValue)}</span>
                                </div>
                            ` : ''}
                        </div>
                    `;
                });
                
                document.getElementById('changeHistoryList').innerHTML = html;
                
            } catch (error) {
                console.error('Error cargando historial:', error);
            }
        }

        function getFieldLabel(field) {
            const labels = {
                'name': 'Nombre',
                'phone': 'Tel√©fono',
                'photoUrl': 'Foto',
                'provincia': 'Provincia',
                'ciudad': 'Ciudad',
                'zonas': 'Zonas',
                'rubros': 'Rubros',
                'bio': 'Descripci√≥n',
                'experienceYears': 'Experiencia'
            };
            return labels[field] || field;
        }

        function formatChangeValue(value) {
            if (value === null || value === undefined) return '-';
            if (typeof value === 'boolean') return value ? 'S√≠' : 'No';
            if (Array.isArray(value)) return value.join(', ');
            return value.toString().substring(0, 50) + (value.toString().length > 50 ? '...' : '');
        }

        async function updateActivity() {
            if (!professionalId) return;
            
            try {
                await db.collection('professionals').doc(professionalId).update({
                    lastActive: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                showMessage('profileMessage', '‚úÖ Actividad actualizada', 'success');
                
            } catch (error) {
                console.error('Error actualizando actividad:', error);
                showMessage('profileMessage', '‚ùå Error actualizando actividad', 'error');
            }
        }

        // Trabajos con paginaci√≥n
        async function loadJobs() {
            if (!professionalId) return;
            
            const container = document.getElementById('jobsList');
            const pagination = document.getElementById('jobsPagination');
            
            showGlobalLoader(true);
            
            try {
                let query = db.collection('jobs')
                    .where('professionalId', '==', professionalId);
                
                if (jobFilter) {
                    query = query.where('status', '==', jobFilter);
                }
                
                // Ordenamiento
                switch(jobSort) {
                    case 'fecha_desc':
                        query = query.orderBy('createdAt', 'desc');
                        break;
                    case 'fecha_asc':
                        query = query.orderBy('createdAt', 'asc');
                        break;
                    case 'precio_desc':
                        query = query.orderBy('price', 'desc');
                        break;
                    case 'precio_asc':
                        query = query.orderBy('price', 'asc');
                        break;
                }
                
                // Contar total
                const countQuery = db.collection('jobs')
                    .where('professionalId', '==', professionalId);
                    
                if (jobFilter) {
                    countQuery.where('status', '==', jobFilter);
                }
                
                const countSnapshot = await countQuery.get();
                totalJobs = countSnapshot.size;
                
                // Paginaci√≥n
                const startAt = (currentPage - 1) * jobsPerPage;
                const snapshot = await query.limit(jobsPerPage).get();
                
                container.innerHTML = '';
                
                if (snapshot.empty) {
                    container.innerHTML = '<p style="color: var(--gray); text-align: center; padding: 2rem;">No hay trabajos.</p>';
                    // Actualizar contadores a 0 cuando no hay trabajos
                    document.getElementById('pendingJobsCount').textContent = 0;
                    document.getElementById('inProgressJobsCount').textContent = 0;
                    document.getElementById('completedJobsCount').textContent = 0;
                    document.getElementById('cancelledJobsCount').textContent = 0;
                    pagination.style.display = 'none';
                    return;
                }
                
                let pendingCount = 0;
                let inProgressCount = 0;
                let completedCount = 0;
                let cancelledCount = 0;
                
                const now = new Date();
                
                snapshot.forEach(doc => {
                    const job = { id: doc.id, ...doc.data() };
                    
                    // Contar por estado
                    switch(job.status) {
                        case 'pendiente': pendingCount++; break;
                        case 'en_progreso': inProgressCount++; break;
                        case 'completado': completedCount++; break;
                        case 'cancelado': cancelledCount++; break;
                    }
                    
                    const date = job.createdAt?.toDate ? job.createdAt.toDate() : new Date(job.createdAt);
                    const daysPassed = Math.floor((now - date) / (1000 * 60 * 60 * 24));
                    
                    let timeIndicator = '';
                    if (job.status === 'en_progreso') {
                        if (daysPassed > 30) {
                            timeIndicator = `<span class="job-time-indicator job-time-danger">+${daysPassed}d</span>`;
                        } else if (daysPassed > 20) {
                            timeIndicator = `<span class="job-time-indicator job-time-warning">+${daysPassed}d</span>`;
                        } else {
                            timeIndicator = `<span class="job-time-indicator job-time-normal">+${daysPassed}d</span>`;
                        }
                    }
                    
                    let statusBadge = '';
                    switch(job.status) {
                        case 'pendiente':
                            statusBadge = '<span class="job-status job-pending">PENDIENTE</span>';
                            break;
                        case 'en_progreso':
                            statusBadge = '<span class="job-status job-in-progress">EN PROGRESO</span>';
                            break;
                        case 'completado':
                            statusBadge = '<span class="job-status job-completed">COMPLETADO</span>';
                            break;
                        case 'cancelado':
                            statusBadge = '<span class="job-status job-cancelled">CANCELADO</span>';
                            break;
                    }
                    
                    const html = `
                        <div class="job-card">
                            <div class="job-header">
                                <div>
                                    <h4 style="margin: 0;">${job.serviceType || 'Servicio'} ${timeIndicator}</h4>
                                    <p style="color: var(--gray); margin: 0.5rem 0;">${date.toLocaleDateString('es-AR')}</p>
                                </div>
                                <div>
                                    ${statusBadge}
                                    ${job.price ? `<div style="font-size: 1.5rem; font-weight: 700; color: var(--primary); margin-top: 0.5rem;">$${job.price.toLocaleString('es-AR')}</div>` : ''}
                                </div>
                            </div>
                            
                            <div style="margin-bottom: 1rem;">
                                <p><strong>Cliente:</strong> ${job.userName || 'Sin nombre'}</p>
                                <p><strong>Tel√©fono:</strong> ${job.userPhone || 'Sin tel√©fono'}</p>
                                <p><strong>Direcci√≥n:</strong> ${job.address || 'Sin direcci√≥n'}</p>
                                ${job.preferredDate ? `<p><strong>Fecha preferida:</strong> ${new Date(job.preferredDate).toLocaleDateString('es-AR')}</p>` : ''}
                            </div>
                            
                            <p style="color: var(--dark); margin-bottom: 1rem;">${job.description || ''}</p>
                            
                            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                <button onclick="viewJob('${doc.id}')" class="btn btn-primary btn-sm">
                                    üëÅÔ∏è Ver Detalles
                                </button>
                                ${job.status === 'pendiente' ? `
                                    <button onclick="updateJobStatus('${doc.id}', 'en_progreso')" class="btn btn-success btn-sm">
                                        üöÄ Iniciar Trabajo
                                    </button>
                                    <button onclick="updateJobStatus('${doc.id}', 'cancelado')" class="btn btn-danger btn-sm">
                                        ‚ùå Cancelar
                                    </button>
                                ` : ''}
                                ${job.status === 'en_progreso' ? `
                                    <button onclick="updateJobStatus('${doc.id}', 'completado')" class="btn btn-success btn-sm">
                                        ‚úÖ Completar
                                    </button>
                                    <button onclick="updateJobStatus('${doc.id}', 'cancelado')" class="btn btn-danger btn-sm">
                                        ‚ùå Cancelar
                                    </button>
                                ` : ''}
                                <button onclick="contactClient('${job.userPhone}', '${job.userName}')" class="btn btn-secondary btn-sm">
                                    üí¨ Contactar
                                </button>
                            </div>
                        </div>
                    `;
                    
                    container.innerHTML += html;
                });
                
                // Actualizar estad√≠sticas
                document.getElementById('pendingJobsCount').textContent = pendingCount;
                document.getElementById('inProgressJobsCount').textContent = inProgressCount;
                document.getElementById('completedJobsCount').textContent = completedCount;
                document.getElementById('cancelledJobsCount').textContent = cancelledCount;
                
                // Actualizar paginaci√≥n
                updatePaginationUI();
                pagination.style.display = 'flex';
                
            } catch (error) {
                console.error('Error cargando trabajos:', error);
                container.innerHTML = '<p style="color: var(--danger); text-align: center; padding: 2rem;">Error cargando trabajos.</p>';
                pagination.style.display = 'none';
            } finally {
                showGlobalLoader(false);
            }
        }

        function updatePaginationUI() {
            const totalPages = Math.ceil(totalJobs / jobsPerPage);
            document.getElementById('pageInfo').textContent = `P√°gina ${currentPage} de ${totalPages}`;
            
            document.getElementById('prevPage').disabled = currentPage === 1;
            document.getElementById('nextPage').disabled = currentPage === totalPages;
        }

        async function sendJobReminders() {
            if (!professionalId) return;
            
            try {
                const now = new Date();
                const fifteenDaysAgo = new Date(now.getTime() - (15 * 24 * 60 * 60 * 1000));
                
                const snapshot = await db.collection('jobs')
                    .where('professionalId', '==', professionalId)
                    .where('status', '==', 'en_progreso')
                    .where('createdAt', '<', fifteenDaysAgo)
                    .get();
                
                if (snapshot.empty) {
                    showMessage('profileMessage', '‚úÖ No hay trabajos pendientes de recordatorio', 'success');
                    return;
                }
                
                let remindersSent = 0;
                const promises = [];
                
                snapshot.forEach(doc => {
                    const job = doc.data();
                    if (job.userPhone) {
                        const message = `Hola ${job.userName}, soy ${professionalData.name} de TecniYa. Te recuerdo que tenemos un trabajo pendiente. ¬øPodemos coordinar para finalizarlo?`;
                        promises.push(
                            db.collection('reminders').add({
                                jobId: doc.id,
                                professionalId: professionalId,
                                professionalName: professionalData.name,
                                userPhone: job.userPhone,
                                userName: job.userName,
                                message: message,
                                sentAt: firebase.firestore.FieldValue.serverTimestamp(),
                                status: 'pending'
                            })
                        );
                        remindersSent++;
                    }
                });
                
                await Promise.all(promises);
                
                showMessage('profileMessage', `‚úÖ ${remindersSent} recordatorio(s) programado(s) para enviar`, 'success');
                
            } catch (error) {
                console.error('Error enviando recordatorios:', error);
                showMessage('profileMessage', '‚ùå Error enviando recordatorios', 'error');
            }
        }

        async function exportJobsToCSV() {
            if (!professionalId) return;
            
            try {
                const snapshot = await db.collection('jobs')
                    .where('professionalId', '==', professionalId)
                    .orderBy('createdAt', 'desc')
                    .get();
                
                if (snapshot.empty) {
                    showMessage('profileMessage', '‚ùå No hay trabajos para exportar', 'error');
                    return;
                }
                
                let csvContent = "Fecha,Cliente,Servicio,Estado,Precio,Descripci√≥n\n";
                
                snapshot.forEach(doc => {
                    const job = doc.data();
                    const date = job.createdAt?.toDate ? job.createdAt.toDate().toLocaleDateString('es-AR') : '-';
                    
                    const row = [
                        date,
                        `"${(job.userName || '').replace(/"/g, '""')}"`,
                        `"${(job.serviceType || '').replace(/"/g, '""')}"`,
                        job.status,
                        job.price || '0',
                        `"${(job.description || '').replace(/"/g, '""')}"`
                    ];
                    
                    csvContent += row.join(',') + '\n';
                });
                
                // Crear y descargar archivo
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                
                link.setAttribute('href', url);
                link.setAttribute('download', `trabajos_${new Date().toISOString().split('T')[0]}.csv`);
                link.style.visibility = 'hidden';
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                showMessage('profileMessage', '‚úÖ CSV exportado correctamente', 'success');
                
            } catch (error) {
                console.error('Error exportando trabajos:', error);
                showMessage('profileMessage', '‚ùå Error exportando trabajos', 'error');
            }
        }

        window.viewJob = async function(jobId) {
            try {
                const doc = await db.collection('jobs').doc(jobId).get();
                if (!doc.exists) return;
                
                const job = doc.data();
                const date = job.createdAt?.toDate ? job.createdAt.toDate() : new Date(job.createdAt);
                const now = new Date();
                const daysPassed = Math.floor((now - date) / (1000 * 60 * 60 * 24));
                
                let timeIndicator = '';
                if (job.status === 'en_progreso') {
                    if (daysPassed > 30) {
                        timeIndicator = `<span class="job-time-indicator job-time-danger" style="margin-left: 10px;">+${daysPassed} d√≠as</span>`;
                    } else if (daysPassed > 20) {
                        timeIndicator = `<span class="job-time-indicator job-time-warning" style="margin-left: 10px;">+${daysPassed} d√≠as</span>`;
                    }
                }
                
                let statusBadge = '';
                switch(job.status) {
                    case 'pendiente': statusBadge = '<span class="job-status job-pending">PENDIENTE</span>'; break;
                    case 'en_progreso': statusBadge = '<span class="job-status job-in-progress">EN PROGRESO</span>'; break;
                    case 'completado': statusBadge = '<span class="job-status job-completed">COMPLETADO</span>'; break;
                    case 'cancelado': statusBadge = '<span class="job-status job-cancelled">CANCELADO</span>'; break;
                }
                
                document.getElementById('jobModalTitle').textContent = 'Detalle del Trabajo';
                document.getElementById('jobModalContent').innerHTML = `
                    <div style="margin-bottom: 2rem;">
                        <h4>${job.serviceType || 'Servicio'} ${timeIndicator}</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin: 1rem 0;">
                            <div>
                                <strong>Estado:</strong> ${statusBadge}
                            </div>
                            <div>
                                <strong>Fecha:</strong> ${date.toLocaleDateString('es-AR')}
                            </div>
                            ${job.price ? `<div><strong>Precio:</strong> $${job.price.toLocaleString('es-AR')}</div>` : ''}
                            ${job.preferredDate ? `<div><strong>Fecha preferida:</strong> ${new Date(job.preferredDate).toLocaleDateString('es-AR')}</div>` : ''}
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 1.5rem;">
                        <h5>üìã Informaci√≥n del Cliente</h5>
                        <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px;">
                            <p><strong>Nombre:</strong> ${job.userName || 'No especificado'}</p>
                            <p><strong>Tel√©fono:</strong> ${job.userPhone || 'No especificado'}</p>
                            <p><strong>Email:</strong> ${job.userEmail || 'No especificado'}</p>
                            <p><strong>Direcci√≥n:</strong> ${job.address || 'No especificado'}</p>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 1.5rem;">
                        <h5>üìù Descripci√≥n del Trabajo</h5>
                        <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px;">
                            ${job.description || 'Sin descripci√≥n'}
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-top: 2rem;">
                        ${job.status === 'pendiente' ? `
                            <button onclick="updateJobStatus('${jobId}', 'en_progreso')" class="btn btn-success">
                                üöÄ Iniciar Trabajo
                            </button>
                            <button onclick="updateJobStatus('${jobId}', 'cancelado')" class="btn btn-danger">
                                ‚ùå Cancelar
                            </button>
                        ` : ''}
                        ${job.status === 'en_progreso' ? `
                            <button onclick="updateJobStatus('${jobId}', 'completado')" class="btn btn-success">
                                ‚úÖ Completar
                            </button>
                            <button onclick="updateJobStatus('${jobId}', 'cancelado')" class="btn btn-danger">
                                ‚ùå Cancelar
                            </button>
                        ` : ''}
                        <button onclick="contactClient('${job.userPhone}', '${job.userName}')" class="btn btn-secondary">
                            üí¨ Contactar Cliente
                        </button>
                        <button onclick="closeJobModal()" class="btn btn-primary">
                            Cerrar
                        </button>
                    </div>
                `;
                
                document.getElementById('jobModal').style.display = 'flex';
                
            } catch (error) {
                console.error('Error cargando trabajo:', error);
            }
        };

        function closeJobModal() {
            document.getElementById('jobModal').style.display = 'none';
        }

        function closeBulkConfirmModal() {
            document.getElementById('bulkConfirmModal').style.display = 'none';
        }

        window.updateJobStatus = async function(jobId, newStatus) {
            const statusText = {
                'pendiente': 'pendiente',
                'en_progreso': 'en progreso',
                'completado': 'completado',
                'cancelado': 'cancelado'
            };
            
            if (!confirm(`¬øEst√°s seguro de querer marcar este trabajo como "${statusText[newStatus]}"?`)) {
                return;
            }
            
            showGlobalLoader(true);
            
            try {
                const updateData = {
                    status: newStatus,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                if (newStatus === 'completado' || newStatus === 'cancelado') {
                    updateData.completedAt = firebase.firestore.FieldValue.serverTimestamp();
                    
                    // Incrementar contador de trabajos completados
                    if (newStatus === 'completado') {
                        await db.collection('professionals').doc(professionalId).update({
                            completedJobs: firebase.firestore.FieldValue.increment(1),
                            lastActive: firebase.firestore.FieldValue.serverTimestamp()
                        });
                        
                        // Crear notificaci√≥n para el usuario para calificar
                        const jobDoc = await db.collection('jobs').doc(jobId).get();
                        const job = jobDoc.data();
                        
                        if (job.userId) {
                            await db.collection('user_notifications').add({
                                userId: job.userId,
                                type: 'rating_reminder',
                                title: 'Calific√° el trabajo realizado',
                                message: `El trabajo con ${professionalData.name} ha sido ${newStatus === 'completado' ? 'completado' : 'cancelado'}. ¬°Calific√° tu experiencia!`,
                                jobId: jobId,
                                professionalId: professionalId,
                                professionalName: professionalData.name,
                                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                                read: false
                            });
                        }
                    }
                }
                
                await db.collection('jobs').doc(jobId).update(updateData);
                
                showMessage('profileMessage', `‚úÖ Trabajo actualizado a "${statusText[newStatus]}"`, 'success');
                
                // Recargar trabajos
                loadJobs();
                closeJobModal();
                
            } catch (error) {
                console.error('Error actualizando estado del trabajo:', error);
                showMessage('profileMessage', '‚ùå Error actualizando estado del trabajo', 'error');
            } finally {
                showGlobalLoader(false);
            }
        };

        window.contactClient = function(phone, clientName) {
            if (!phone) {
                showMessage('profileMessage', '‚ùå El cliente no tiene tel√©fono registrado', 'error');
                return;
            }
            
            const message = `Hola ${clientName}, soy ${professionalData.name} de TecniYa. Te contacto respecto al trabajo que realizamos.`;
            const whatsappUrl = `https://wa.me/549${phone}?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
        };

        // Notificaciones persistentes
        async function loadNotifications() {
            const container = document.getElementById('notificationsList');
            if (!container) return;
            
            try {
                const notifications = professionalData.notifications || [];
                
                if (notifications.length === 0) {
                    container.innerHTML = '<p style="color: var(--gray); text-align: center; padding: 2rem;">No ten√©s notificaciones.</p>';
                    return;
                }
                
                let html = '';
                notifications.reverse().forEach(notif => {
                    html += `
                        <div class="notification-card ${notif.type === 'urgent' ? 'notification-urgent' : ''}">
                            <div style="display: flex; justify-content: space-between; align-items: start;">
                                <div>
                                    <h4 style="margin: 0;">${notif.title}</h4>
                                    <p style="margin: 0.5rem 0;">${notif.message}</p>
                                    <small style="color: var(--gray);">${new Date(notif.date).toLocaleDateString('es-AR')}</small>
                                </div>
                                <div>
                                    ${!notif.read ? '<span style="background: var(--primary); color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.8rem;">NUEVO</span>' : ''}
                                    <br>
                                    <label style="display: flex; align-items: center; gap: 5px; margin-top: 5px; font-size: 0.8rem;">
                                        <input type="checkbox" ${notif.read ? 'checked' : ''} 
                                               onchange="toggleNotificationRead('${notif.id}', this.checked)">
                                        Le√≠da
                                    </label>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
                
                // Marcar como le√≠das autom√°ticamente si est√° configurado
                const autoMarkRead = document.getElementById('autoMarkRead').checked;
                if (autoMarkRead) {
                    await markNotificationsAsRead();
                }
                
            } catch (error) {
                console.error('Error cargando notificaciones:', error);
            }
        }

        async function toggleNotificationRead(notificationId, read) {
            try {
                const notifications = professionalData.notifications || [];
                const updatedNotifications = notifications.map(notif => {
                    if (notif.id === notificationId) {
                        return { ...notif, read: read };
                    }
                    return notif;
                });
                
                await db.collection('professionals').doc(professionalId).update({
                    notifications: updatedNotifications
                });
                
                professionalData.notifications = updatedNotifications;
                
            } catch (error) {
                console.error('Error marcando notificaci√≥n como le√≠da:', error);
            }
        }

        async function markNotificationsAsRead() {
            try {
                const notifications = professionalData.notifications || [];
                const updatedNotifications = notifications.map(notif => ({
                    ...notif,
                    read: true
                }));
                
                await db.collection('professionals').doc(professionalId).update({
                    notifications: updatedNotifications
                });
                
                professionalData.notifications = updatedNotifications;
            } catch (error) {
                console.error('Error marcando notificaciones como le√≠das:', error);
            }
        }

        // Destacados
        function checkFeaturedStatus() {
            const now = new Date();
            const isFeaturedActive = professionalData.isFeatured && 
                professionalData.featuredUntil && 
                new Date(professionalData.featuredUntil) > now;
            
            const statusBadge = document.getElementById('featuredStatusBadge');
            const infoDiv = document.getElementById('featuredInfo');
            
            if (isFeaturedActive) {
                const featuredUntil = new Date(professionalData.featuredUntil);
                const daysRemaining = Math.ceil((featuredUntil - now) / (1000 * 60 * 60 * 24));
                
                statusBadge.textContent = 'DESTACADO';
                statusBadge.className = 'status-badge status-featured';
                
                infoDiv.innerHTML = `
                    <p style="color: var(--gray); margin-bottom: 1rem;">
                        ‚úÖ Tu perfil est√° destacado y aparece primero en las b√∫squedas.
                    </p>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 1rem;">
                        <div style="text-align: center;">
                            <div style="font-size: 2rem; font-weight: 700; color: var(--primary);">${daysRemaining}</div>
                            <div style="color: var(--gray); font-size: 0.9rem;">D√≠as restantes</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 2rem; font-weight: 700; color: var(--secondary);">${featuredUntil.toLocaleDateString('es-AR')}</div>
                            <div style="color: var(--gray); font-size: 0.9rem;">Vence el</div>
                        </div>
                    </div>
                `;
                
            } else {
                statusBadge.textContent = 'NO DESTACADO';
                statusBadge.className = 'status-badge status-incomplete';
                
                infoDiv.innerHTML = `
                    <p style="color: var(--gray); margin-bottom: 1rem;">
                        Tu perfil no est√° destacado actualmente. Los perfiles destacados aparecen primero en las b√∫squedas.
                    </p>
                `;
            }
            
            // Verificar Plan Profesional
            const certificationSection = document.getElementById('certificationUploadSection');
            const certificationBadge = document.getElementById('certificationStatusBadge');
            
            if (professionalData.hasProfessionalPlan) {
                certificationBadge.textContent = 'DISPONIBLE';
                certificationBadge.className = 'status-badge status-professional';
                certificationSection.style.display = 'block';
                loadCertifications();
            } else {
                certificationBadge.textContent = 'NO DISPONIBLE';
                certificationBadge.className = 'status-badge status-incomplete';
                certificationSection.style.display = 'none';
            }
        }

        window.selectFeaturedPlan = function(months) {
            selectedFeaturedPlan = months;
            const amount = months === 1 ? 5000 : 42000;
            
            if (confirm(`¬øConfirm√°s la activaci√≥n del destacado por ${months} ${months === 1 ? 'mes' : 'meses'} por $${amount.toLocaleString('es-AR')}?`)) {
                showGlobalLoader(true);
                
                setTimeout(() => {
                    // En producci√≥n, aqu√≠ se integrar√≠a con un sistema de pagos
                    alert(`Para activar el plan destacado, realiz√° la transferencia de $${amount.toLocaleString('es-AR')} y envianos el comprobante a comprobantes@tecniya.com\n\nTambi√©n pod√©s pagar con Mercado Pago: https://mpago.li/tecniya-destacado`);
                    showGlobalLoader(false);
                }, 1000);
            }
        };

        // Certificaciones con validaci√≥n
        function handleCertificationUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const validTypes = ['application/pdf', 'image/jpeg', 'image/jpg', 'image/png'];
            if (!validTypes.includes(file.type)) {
                alert('‚ùå Por favor sub√≠ un archivo PDF o imagen (JPG, PNG)');
                return;
            }
            
            if (file.size > 10 * 1024 * 1024) {
                alert('‚ùå El archivo debe ser menor a 10MB');
                return;
            }
            
            currentCertificationFile = file;
            document.getElementById('addCertificationBtn').disabled = false;
            
            // Mostrar preview si es imagen
            if (file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.createElement('img');
                    preview.src = e.target.result;
                    preview.className = 'certification-preview';
                    
                    const uploadDiv = document.querySelector('#certificationUploadSection .file-upload');
                    const existingPreview = uploadDiv.querySelector('.certification-preview');
                    if (existingPreview) {
                        existingPreview.remove();
                    }
                    uploadDiv.appendChild(preview);
                };
                reader.readAsDataURL(file);
            }
            
            showMessage('profileMessage', '‚úÖ Archivo cargado. Complet√° los datos y hac√© clic en "Agregar Certificaci√≥n"', 'success');
        }

        async function addCertification() {
            const title = document.getElementById('certificationTitle').value.trim();
            const institution = document.getElementById('certificationInstitution').value.trim();
            const number = document.getElementById('certificationNumber').value.trim();
            
            if (!title || !institution) {
                showMessage('profileMessage', '‚ùå Complet√° t√≠tulo e instituci√≥n', 'error');
                return;
            }
            
            if (!currentCertificationFile) {
                showMessage('profileMessage', '‚ùå Sub√≠ un archivo primero', 'error');
                return;
            }
            
            showGlobalLoader(true);
            
            try {
                // Subir archivo a Storage
                const storageRef = storage.ref(`professionals/${professionalId}/certifications/${Date.now()}_${currentCertificationFile.name}`);
                const snapshot = await storageRef.put(currentCertificationFile);
                const downloadURL = await snapshot.ref.getDownloadURL();
                
                // Crear certificaci√≥n
                const certificationData = {
                    professionalId,
                    title,
                    institution,
                    certificationNumber: number || '',
                    documentUrl: downloadURL,
                    status: 'pendiente',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    reviewedAt: null,
                    reviewerId: null
                };
                
                await db.collection('certifications').add(certificationData);
                
                // Agregar a la lista del profesional
                await db.collection('professionals').doc(professionalId).update({
                    certifications: firebase.firestore.FieldValue.arrayUnion({
                        title,
                        institution,
                        documentUrl: downloadURL,
                        uploadedAt: new Date().toISOString(),
                        status: 'pendiente'
                    })
                });
                
                // Notificar al administrador
                await db.collection('admin_notifications').add({
                    type: 'certification_pending',
                    professionalId: professionalId,
                    professionalName: professionalData.name,
                    certificationTitle: title,
                    institution: institution,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // Limpiar formulario
                document.getElementById('certificationTitle').value = '';
                document.getElementById('certificationInstitution').value = '';
                document.getElementById('certificationNumber').value = '';
                document.getElementById('certificationUpload').value = '';
                document.getElementById('addCertificationBtn').disabled = true;
                currentCertificationFile = null;
                
                // Limpiar preview
                const preview = document.querySelector('#certificationUploadSection .certification-preview');
                if (preview) preview.remove();
                
                showMessage('profileMessage', '‚úÖ Certificaci√≥n enviada para revisi√≥n', 'success');
                loadCertifications();
                
            } catch (error) {
                console.error('Error agregando certificaci√≥n:', error);
                showMessage('profileMessage', '‚ùå Error agregando certificaci√≥n: ' + error.message, 'error');
            } finally {
                showGlobalLoader(false);
            }
        }

        async function loadCertifications() {
            const container = document.getElementById('certificationsList');
            if (!container) return;
            
            try {
                const snapshot = await db.collection('certifications')
                    .where('professionalId', '==', professionalId)
                    .orderBy('createdAt', 'desc')
                    .get();
                
                if (snapshot.empty) {
                    container.innerHTML = '<p style="color: var(--gray); text-align: center; padding: 2rem;">No hay certificaciones cargadas.</p>';
                    return;
                }
                
                let html = '';
                snapshot.forEach(doc => {
                    const cert = doc.data();
                    const date = cert.createdAt?.toDate ? cert.createdAt.toDate().toLocaleDateString('es-AR') : '';
                    const reviewedDate = cert.reviewedAt?.toDate ? cert.reviewedAt.toDate().toLocaleDateString('es-AR') : '';
                    
                    let statusText = '';
                    let statusClass = '';
                    let reviewInfo = '';
                    
                    switch(cert.status) {
                        case 'aprobada':
                            statusText = '‚úÖ APROBADA';
                            statusClass = 'badge-success';
                            if (reviewedDate) {
                                reviewInfo = `<small style="display: block; margin-top: 5px;">Aprobada el: ${reviewedDate}</small>`;
                            }
                            break;
                        case 'rechazada':
                            statusText = '‚ùå RECHAZADA';
                            statusClass = 'badge-danger';
                            if (reviewedDate) {
                                reviewInfo = `<small style="display: block; margin-top: 5px;">Rechazada el: ${reviewedDate}</small>`;
                                if (cert.rejectionReason) {
                                    reviewInfo += `<small style="display: block; color: var(--danger);">Motivo: ${cert.rejectionReason}</small>`;
                                }
                            }
                            break;
                        default:
                            statusText = '‚è≥ PENDIENTE';
                            statusClass = 'badge-warning';
                    }
                    
                    html += `
                        <div class="job-card">
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
                                <div>
                                    <h4 style="margin: 0;">${cert.title}</h4>
                                    <p style="color: var(--gray); margin: 0.25rem 0;">${cert.institution}</p>
                                    ${cert.certificationNumber ? `<p style="font-size: 0.9rem; color: var(--dark);">N¬∫: ${cert.certificationNumber}</p>` : ''}
                                </div>
                                <span class="badge ${statusClass}" style="padding: 4px 12px; border-radius: 12px; font-size: 0.8rem;">
                                    ${statusText}
                                </span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; font-size: 0.9rem; color: var(--gray);">
                                <span>Subida: ${date}</span>
                                ${cert.documentUrl ? `
                                    <a href="${cert.documentUrl}" target="_blank" style="color: var(--primary); text-decoration: none;">
                                        üìÑ Ver documento
                                    </a>
                                ` : ''}
                            </div>
                            ${reviewInfo}
                        </div>
                    `;
                });
                
                container.innerHTML = html;
                
            } catch (error) {
                console.error('Error cargando certificaciones:', error);
            }
        }

        // Utilidades
        function showMessage(containerId, text, type) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            container.textContent = text;
            container.className = `message message-${type}`;
            container.style.display = 'block';
            
            setTimeout(() => {
                container.style.display = 'none';
            }, 5000);
        }

        function showGlobalLoader(show) {
            const loader = document.getElementById('globalLoader');
            if (loader) {
                loader.style.display = show ? 'flex' : 'none';
            }
        }

        // Funciones globales
        window.switchTab = switchTab;
        window.closeJobModal = closeJobModal;
        window.toggleAllFeatured = async function() {
            const modal = document.getElementById('bulkConfirmModal');
            const content = document.getElementById('bulkConfirmContent');
            
            content.innerHTML = `
                <div class="bulk-action-confirm">
                    <p><strong>‚ö†Ô∏è ATENCI√ìN: ACCI√ìN MASIVA</strong></p>
                    <p>Esta acci√≥n cambiar√° el estado de destacado de TODOS los profesionales del sistema.</p>
                    <p>¬øEst√°s seguro de continuar?</p>
                </div>
                <p>Esta operaci√≥n puede tardar varios minutos y afectar√° a todos los usuarios.</p>
            `;
            
            modal.style.display = 'flex';
            
            document.getElementById('confirmBulkAction').onclick = async function() {
                showGlobalLoader(true);
                modal.style.display = 'none';
                
                try {
                    // En un sistema real, esto se har√≠a con Cloud Functions
                    // Por ahora, solo mostramos un mensaje
                    showMessage('profileMessage', '‚úÖ Acci√≥n masiva programada. Los cambios se aplicar√°n en breve.', 'success');
                } catch (error) {
                    showMessage('profileMessage', '‚ùå Error en acci√≥n masiva', 'error');
                } finally {
                    showGlobalLoader(false);
                }
            };
        };

        window.deleteProfessional = async function(id) {
            if (!confirm('¬øEST√ÅS SEGURO? Esta acci√≥n eliminar√° permanentemente al profesional, sus trabajos y certificaciones.')) {
                return;
            }
            
            const modal = document.getElementById('bulkConfirmModal');
            const content = document.getElementById('bulkConfirmContent');
            
            content.innerHTML = `
                <div class="bulk-action-confirm">
                    <p><strong>üö® ELIMINACI√ìN PERMANENTE</strong></p>
                    <p>Esta acci√≥n eliminar√° permanentemente:</p>
                    <ul>
                        <li>El perfil del profesional</li>
                        <li>Todos sus trabajos asociados</li>
                        <li>Todas sus certificaciones</li>
                        <li>Su historial de calificaciones</li>
                    </ul>
                    <p>Esta acci√≥n NO se puede deshacer.</p>
                </div>
                <p>¬øConfirm√°s la eliminaci√≥n permanente?</p>
            `;
            
            modal.style.display = 'flex';
            
            document.getElementById('confirmBulkAction').onclick = async function() {
                showGlobalLoader(true);
                modal.style.display = 'none';
                
                try {
                    // En un sistema real, esto se har√≠a con Cloud Functions para cascada
                    // Por ahora, solo eliminamos el profesional
                    await db.collection('professionals').doc(id).delete();
                    
                    // Notificar eliminaci√≥n (en producci√≥n, Cloud Functions manejar√≠a la cascada)
                    await db.collection('admin_notifications').add({
                        type: 'professional_deleted',
                        professionalId: id,
                        deletedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    showMessage('profileMessage', '‚úÖ Profesional eliminado', 'success');
                    
                } catch (error) {
                    console.error('Error eliminando profesional:', error);
                    showMessage('profileMessage', '‚ùå Error eliminando profesional', 'error');
                } finally {
                    showGlobalLoader(false);
                }
            };
        };
    </script>
</body>
</html>
