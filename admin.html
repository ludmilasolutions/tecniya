<!DOCTYPE html>
<html lang="es-AR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TecniYa - Panel Administrador</title>
    <meta name="description" content="Panel de administraci√≥n para gestionar profesionales, trabajos y sistema.">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%23dc3545'/><text x='50' y='70' text-anchor='middle' font-size='60' fill='white'>üîß</text></svg>">
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    
    <!-- CSS -->
    <style>
        :root {
            --primary: #0a4fd8;
            --primary-dark: #083bb5;
            --secondary: #1db954;
            --danger: #dc3545;
            --warning: #ffc107;
            --info: #17a2b8;
            --light: #f8f9fa;
            --dark: #333;
            --gray: #666;
            --light-gray: #e1e5e9;
            --shadow: 0 4px 12px rgba(10, 79, 216, 0.15);
            --radius: 12px;
        }
        
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: var(--dark);
            line-height: 1.6;
        }
        
        /* Layout */
        .container { 
            width: 100%; 
            max-width: 1400px; 
            margin: 0 auto; 
            padding: 20px; 
        }
        
        /* Header */
        .header { 
            background: linear-gradient(135deg, var(--dark) 0%, #555 100%); 
            color: white; 
            padding: 25px 20px; 
            text-align: center; 
        }
        
        .header h1 { 
            font-size: 2rem; 
            margin-bottom: 8px; 
            font-weight: 800; 
        }
        
        /* Login */
        .login-container { 
            max-width: 500px; 
            margin: 80px auto; 
            padding: 40px; 
            background: white; 
            border-radius: 16px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); 
        }
        
        .login-title { 
            text-align: center; 
            font-size: 1.8rem; 
            margin-bottom: 30px; 
        }
        
        /* Tabs */
        .tabs { 
            display: flex; 
            background: white; 
            border-bottom: 2px solid #eaeaea; 
            overflow-x: auto; 
            flex-wrap: wrap; 
        }
        
        .tab { 
            padding: 18px 25px; 
            font-weight: 600; 
            cursor: pointer; 
            border-bottom: 3px solid transparent; 
            white-space: nowrap; 
        }
        
        .tab.active { 
            border-bottom-color: var(--danger); 
            color: var(--danger); 
            background-color: #fff5f5; 
        }
        
        /* Panels */
        .panel { 
            display: none; 
            background: white; 
            padding: 30px; 
            border-radius: 0 0 var(--radius) var(--radius); 
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); 
        }
        
        .panel.active { 
            display: block; 
        }
        
        /* Forms */
        .form-group { 
            margin-bottom: 25px; 
        }
        
        .form-label { 
            display: block; 
            font-weight: 600; 
            margin-bottom: 10px; 
        }
        
        .form-input, .form-select { 
            width: 100%; 
            padding: 15px; 
            border: 2px solid var(--light-gray); 
            border-radius: 10px; 
            font-size: 1rem; 
        }
        
        /* Tables */
        .data-table { 
            width: 100%; 
            border-collapse: collapse; 
            margin-top: 20px; 
        }
        
        .data-table th, .data-table td { 
            padding: 15px; 
            text-align: left; 
            border-bottom: 1px solid #eaeaea; 
        }
        
        .data-table th { 
            background-color: #f8f9fa; 
            font-weight: 700; 
        }
        
        .table-container { 
            max-height: 600px; 
            overflow-y: auto; 
            border: 1px solid #eaeaea; 
            border-radius: var(--radius); 
        }
        
        /* Stats */
        .stats-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
            gap: 25px; 
            margin: 30px 0; 
        }
        
        .stat-card { 
            background: #f8f9fa; 
            padding: 25px; 
            border-radius: var(--radius); 
            text-align: center; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }
        
        .stat-number { 
            font-size: 2.5rem; 
            font-weight: 700; 
            color: var(--primary); 
        }
        
        /* Buttons */
        .btn { 
            padding: 12px 24px; 
            border-radius: 8px; 
            font-size: 1rem; 
            font-weight: 600; 
            cursor: pointer; 
            border: none; 
            transition: all 0.3s; 
            display: inline-flex; 
            align-items: center; 
            gap: 8px; 
        }
        
        .btn-primary { 
            background-color: var(--primary); 
            color: white; 
        }
        
        .btn-danger { 
            background-color: var(--danger); 
            color: white; 
        }
        
        .btn-success { 
            background-color: var(--secondary); 
            color: white; 
        }
        
        .btn-sm { 
            padding: 8px 16px; 
            font-size: 0.9rem; 
        }
        
        .btn-group { 
            display: flex; 
            gap: 10px; 
            flex-wrap: wrap; 
        }
        
        /* Badges */
        .badge { 
            display: inline-block; 
            padding: 5px 12px; 
            border-radius: 20px; 
            font-size: 0.85rem; 
            font-weight: 700; 
        }
        
        .badge-success { 
            background: #d4edda; 
            color: #155724; 
        }
        
        .badge-warning { 
            background: #fff3cd; 
            color: #856404; 
        }
        
        .badge-danger { 
            background: #f8d7da; 
            color: #721c24; 
        }
        
        /* Messages */
        .message {
            padding: 1.5rem;
            border-radius: var(--radius);
            margin-bottom: 1.5rem;
            font-weight: 600;
        }
        
        .message-success {
            background: #d4edda;
            color: #155724;
        }
        
        .message-error {
            background: #f8d7da;
            color: #721c24;
        }
        
        /* Filters */
        .filters { 
            background: #f8f9fa; 
            padding: 20px; 
            border-radius: var(--radius); 
            margin-bottom: 30px; 
            display: flex; 
            gap: 20px; 
            flex-wrap: wrap; 
        }
        
        .filter-group { 
            display: flex; 
            align-items: center; 
            gap: 10px; 
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .filters { 
                flex-direction: column; 
            }
            
            .tabs { 
                flex-direction: column; 
            }
            
            .tab { 
                text-align: center; 
            }
        }
    </style>
</head>
<body>
    <!-- Login -->
    <div id="loginContainer" class="login-container">
        <h2 class="login-title">üîê Admin TecniYa</h2>
        <div class="form-group">
            <label class="form-label">Email</label>
            <input type="email" id="loginEmail" class="form-input" placeholder="admin@tecniya.com">
        </div>
        <div class="form-group">
            <label class="form-label">Contrase√±a</label>
            <input type="password" id="loginPassword" class="form-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
        </div>
        <button id="loginBtn" class="btn btn-primary" style="width: 100%;">Ingresar</button>
        <div id="loginMessage" class="message" style="display: none;"></div>
    </div>
    
    <!-- Admin Panel -->
    <div id="adminPanel" style="display: none;">
        <header class="header">
            <h1>‚öô Panel Administrador TecniYa</h1>
            <p style="opacity: 0.9;">Gesti√≥n completa del sistema</p>
        </header>
        
        <div class="container">
            <!-- Tabs -->
            <div class="tabs">
                <div class="tab active" data-tab="dashboard">üìä Dashboard</div>
                <div class="tab" data-tab="professionals">üë®‚Äçüîß Profesionales</div>
                <div class="tab" data-tab="jobs">üõ†Ô∏è Trabajos</div>
                <div class="tab" data-tab="notifications">üîî Notificaciones</div>
                <div class="tab" data-tab="certifications">üìú Certificaciones</div>
                <div class="tab" data-tab="banners">üéØ Banners</div>
                <div class="tab" id="logoutBtn">üö™ Cerrar Sesi√≥n</div>
            </div>
            
            <!-- Dashboard -->
            <div id="dashboardPanel" class="panel active">
                <h2>Dashboard del Sistema</h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalProfessionals">0</div>
                        <div>Total Profesionales</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="activeJobs">0</div>
                        <div>Trabajos Activos</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="pendingCertifications">0</div>
                        <div>Cert. Pendientes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="blockedAccounts">0</div>
                        <div>Cuentas Bloqueadas</div>
                    </div>
                </div>
                
                <div style="margin-top: 50px;">
                    <h3>üìà Actividad Reciente</h3>
                    <div id="recentActivity"></div>
                </div>
            </div>
            
            <!-- Professionals -->
            <div id="professionalsPanel" class="panel">
                <h2>Gesti√≥n de Profesionales</h2>
                
                <div class="filters">
                    <div class="filter-group">
                        <label>Estado:</label>
                        <select id="filterProfessionalStatus" class="form-select" style="width: 200px;">
                            <option value="">Todos</option>
                            <option value="active">Activos</option>
                            <option value="blocked">Bloqueados</option>
                            <option value="incomplete">Incompletos</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Provincia:</label>
                        <select id="filterProfessionalProvincia" class="form-select" style="width: 200px;">
                            <option value="">Todas</option>
                        </select>
                    </div>
                    <button id="applyProfessionalFilters" class="btn btn-primary">üîç Filtrar</button>
                </div>
                
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Nombre</th>
                                <th>Contacto</th>
                                <th>Ubicaci√≥n</th>
                                <th>Estado</th>
                                <th>Rating</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="professionalsTable">
                            <!-- JS llenar√° esto -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Jobs -->
            <div id="jobsPanel" class="panel">
                <h2>Gesti√≥n de Trabajos</h2>
                
                <div class="filters">
                    <div class="filter-group">
                        <label>Estado:</label>
                        <select id="filterJobStatus" class="form-select" style="width: 200px;">
                            <option value="">Todos</option>
                            <option value="pendiente">Pendientes</option>
                            <option value="en_progreso">En Progreso</option>
                            <option value="completado">Completados</option>
                            <option value="cancelado">Cancelados</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Desde:</label>
                        <input type="date" id="filterJobDateFrom" class="form-input" style="width: 150px;">
                    </div>
                    <button id="applyJobFilters" class="btn btn-primary">üîç Filtrar</button>
                </div>
                
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Profesional</th>
                                <th>Cliente</th>
                                <th>Servicio</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="jobsTable">
                            <!-- JS llenar√° esto -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Notifications -->
            <div id="notificationsPanel" class="panel">
                <h2>Sistema de Notificaciones</h2>
                
                <div class="filters">
                    <div class="filter-group">
                        <label>Tipo:</label>
                        <select id="filterNotificationType" class="form-select" style="width: 200px;">
                            <option value="">Todas</option>
                            <option value="account_blocked">Cuentas Bloqueadas</option>
                            <option value="job_overdue">Trabajos Vencidos</option>
                            <option value="system">Sistema</option>
                        </select>
                    </div>
                    <button id="applyNotificationFilters" class="btn btn-primary">üîç Filtrar</button>
                    <button onclick="clearAllNotifications()" class="btn btn-danger">üóëÔ∏è Limpiar Todas</button>
                </div>
                
                <div id="notificationsList"></div>
            </div>
            
            <!-- Certifications -->
            <div id="certificationsPanel" class="panel">
                <h2>Gesti√≥n de Certificaciones</h2>
                
                <div class="filters">
                    <div class="filter-group">
                        <label>Estado:</label>
                        <select id="filterCertificationStatus" class="form-select" style="width: 200px;">
                            <option value="pendiente">Pendientes</option>
                            <option value="aprobada">Aprobadas</option>
                            <option value="rechazada">Rechazadas</option>
                        </select>
                    </div>
                    <button id="applyCertificationFilters" class="btn btn-primary">üîç Filtrar</button>
                </div>
                
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Profesional</th>
                                <th>Certificaci√≥n</th>
                                <th>Instituci√≥n</th>
                                <th>Fecha</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="certificationsTable">
                            <!-- JS llenar√° esto -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Banners -->
            <div id="bannersPanel" class="panel">
                <h2>Gesti√≥n de Banners</h2>
                
                <div style="background: #f8f9fa; padding: 25px; border-radius: var(--radius); margin-bottom: 30px;">
                    <h3>Crear Nuevo Banner</h3>
                    <div class="form-group">
                        <label class="form-label">URL de la Imagen</label>
                        <input type="text" id="bannerImageUrl" class="form-input" placeholder="https://ejemplo.com/banner.jpg">
                    </div>
                    <div class="form-group">
                        <label class="form-label">URL de Enlace</label>
                        <input type="text" id="bannerLinkUrl" class="form-input" placeholder="https://ejemplo.com/promocion">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Tipo</label>
                        <select id="bannerType" class="form-select">
                            <option value="nacional">Nacional</option>
                            <option value="provincial">Provincial</option>
                        </select>
                    </div>
                    <button onclick="createBanner()" class="btn btn-primary">üéØ Crear Banner</button>
                </div>
                
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Imagen</th>
                                <th>Enlace</th>
                                <th>Tipo</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="bannersTable">
                            <!-- JS llenar√° esto -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuraci√≥n Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBzDfYDdzmN9J_Y8gG06aqH0OtlzFhafFY",
            authDomain: "tecniya-b4206.firebaseapp.com",
            projectId: "tecniya-b4206",
            storageBucket: "tecniya-b4206.firebasestorage.app",
            messagingSenderId: "166424133304",
            appId: "1:166424133304:web:d1ad23bd4ea1af10437e4d"
        };

        // Variables globales
        let auth, db;

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', () => {
            try {
                firebase.initializeApp(firebaseConfig);
                auth = firebase.auth();
                db = firebase.firestore();
                
                // Event listeners
                document.getElementById('loginBtn').addEventListener('click', handleLogin);
                document.getElementById('logoutBtn').addEventListener('click', handleLogout);
                
                // Tabs
                document.querySelectorAll('.tab[data-tab]').forEach(tab => {
                    tab.addEventListener('click', () => switchTab(tab.dataset.tab));
                });
                
                // Filtros
                document.getElementById('applyProfessionalFilters').addEventListener('click', loadProfessionals);
                document.getElementById('applyJobFilters').addEventListener('click', loadJobs);
                document.getElementById('applyNotificationFilters').addEventListener('click', loadNotifications);
                document.getElementById('applyCertificationFilters').addEventListener('click', loadCertifications);
                
                // Cargar provincias
                loadProvincias();
                
                // Verificar autenticaci√≥n
                auth.onAuthStateChanged(handleAuthStateChange);
                
            } catch (error) {
                console.error('Error inicializando:', error);
            }
        });

        // Autenticaci√≥n
        async function handleLogin() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            try {
                await auth.signInWithEmailAndPassword(email, password);
            } catch (error) {
                showMessage('loginMessage', '‚ùå Error: ' + error.message, 'error');
            }
        }

        function handleLogout() {
            auth.signOut();
        }

        function handleAuthStateChange(user) {
            if (user && user.email === 'admin@tecniya.com') {
                document.getElementById('loginContainer').style.display = 'none';
                document.getElementById('adminPanel').style.display = 'block';
                loadDashboard();
                loadProfessionals();
            } else {
                document.getElementById('loginContainer').style.display = 'block';
                document.getElementById('adminPanel').style.display = 'none';
                if (user) auth.signOut();
            }
        }

        // Navegaci√≥n
        function switchTab(tabId) {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.panel').forEach(panel => {
                panel.classList.remove('active');
            });
            
            document.querySelector(`.tab[data-tab="${tabId}"]`).classList.add('active');
            document.getElementById(`${tabId}Panel`).classList.add('active');
            
            if (tabId === 'dashboard') loadDashboard();
            if (tabId === 'professionals') loadProfessionals();
            if (tabId === 'jobs') loadJobs();
            if (tabId === 'notifications') loadNotifications();
            if (tabId === 'certifications') loadCertifications();
            if (tabId === 'banners') loadBanners();
        }

        // Dashboard
        async function loadDashboard() {
            try {
                // Total profesionales
                const professionalsSnapshot = await db.collection('professionals').get();
                document.getElementById('totalProfessionals').textContent = professionalsSnapshot.size;
                
                // Trabajos activos
                const jobsSnapshot = await db.collection('jobs')
                    .where('status', 'in', ['pendiente', 'en_progreso'])
                    .get();
                document.getElementById('activeJobs').textContent = jobsSnapshot.size;
                
                // Certificaciones pendientes
                const certsSnapshot = await db.collection('certifications')
                    .where('status', '==', 'pendiente')
                    .get();
                document.getElementById('pendingCertifications').textContent = certsSnapshot.size;
                
                // Cuentas bloqueadas
                const blockedSnapshot = await db.collection('professionals')
                    .where('blocked', '==', true)
                    .get();
                document.getElementById('blockedAccounts').textContent = blockedSnapshot.size;
                
                // Actividad reciente
                loadRecentActivity();
                
            } catch (error) {
                console.error('Error cargando dashboard:', error);
            }
        }

        async function loadRecentActivity() {
            const container = document.getElementById('recentActivity');
            
            try {
                // √öltimos trabajos
                const jobsSnapshot = await db.collection('jobs')
                    .orderBy('createdAt', 'desc')
                    .limit(10)
                    .get();
                
                let html = '<table class="data-table">';
                html += '<tr><th>Fecha</th><th>Profesional</th><th>Cliente</th><th>Estado</th></tr>';
                
                jobsSnapshot.forEach(doc => {
                    const job = doc.data();
                    const date = job.createdAt?.toDate ? job.createdAt.toDate().toLocaleDateString('es-AR') : '-';
                    
                    html += `
                        <tr>
                            <td>${date}</td>
                            <td>${job.professionalName || '-'}</td>
                            <td>${job.userName || '-'}</td>
                            <td>${job.status}</td>
                        </tr>
                    `;
                });
                
                html += '</table>';
                container.innerHTML = html;
                
            } catch (error) {
                console.error('Error cargando actividad:', error);
            }
        }

        // Profesionales
        function loadProvincias() {
            const provincias = [
                "Buenos Aires", "CABA", "Catamarca", "Chaco", "Chubut",
                "C√≥rdoba", "Corrientes", "Entre R√≠os", "Formosa", "Jujuy",
                "La Pampa", "La Rioja", "Mendoza", "Misiones", "Neuqu√©n",
                "R√≠o Negro", "Salta", "San Juan", "San Luis", "Santa Cruz",
                "Santa Fe", "Santiago del Estero", "Tierra del Fuego", "Tucum√°n"
            ];
            
            const select = document.getElementById('filterProfessionalProvincia');
            provincias.sort().forEach(provincia => {
                const option = document.createElement('option');
                option.value = provincia;
                option.textContent = provincia;
                select.appendChild(option);
            });
        }

        async function loadProfessionals() {
            const statusFilter = document.getElementById('filterProfessionalStatus').value;
            const provinciaFilter = document.getElementById('filterProfessionalProvincia').value;
            
            try {
                let query = db.collection('professionals');
                
                if (statusFilter === 'blocked') {
                    query = query.where('blocked', '==', true);
                } else if (statusFilter === 'active') {
                    query = query.where('active', '==', true);
                } else if (statusFilter === 'incomplete') {
                    query = query.where('profileCompleted', '==', false);
                }
                
                if (provinciaFilter) {
                    query = query.where('provincia', '==', provinciaFilter);
                }
                
                const snapshot = await query.get();
                const tbody = document.getElementById('professionalsTable');
                tbody.innerHTML = '';
                
                snapshot.forEach(doc => {
                    const prof = doc.data();
                    const id = doc.id;
                    
                    let statusBadge = '';
                    if (prof.blocked) {
                        statusBadge = '<span class="badge badge-danger">BLOQUEADO</span>';
                    } else if (!prof.profileCompleted) {
                        statusBadge = '<span class="badge badge-warning">INCOMPLETO</span>';
                    } else {
                        statusBadge = '<span class="badge badge-success">ACTIVO</span>';
                    }
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>
                            <strong>${prof.name || 'Sin nombre'}</strong><br>
                            <small>${prof.email || ''}</small>
                        </td>
                        <td>${prof.phone || 'Sin tel√©fono'}</td>
                        <td>${prof.ciudad || ''}, ${prof.provincia || ''}</td>
                        <td>${statusBadge}</td>
                        <td>${prof.averageRating ? prof.averageRating.toFixed(1) : '0.0'} ‚≠ê</td>
                        <td>
                            <div class="btn-group">
                                <button onclick="viewProfessional('${id}')" class="btn btn-sm">üëÅ Ver</button>
                                ${prof.blocked ? 
                                    `<button onclick="unblockProfessional('${id}')" class="btn btn-success btn-sm">üîì Desbloquear</button>` :
                                    `<button onclick="blockProfessional('${id}')" class="btn btn-danger btn-sm">üö´ Bloquear</button>`
                                }
                            </div>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
                
            } catch (error) {
                console.error('Error cargando profesionales:', error);
            }
        }

        window.viewProfessional = async function(id) {
            const doc = await db.collection('professionals').doc(id).get();
            if (!doc.exists) return;
            
            const prof = doc.data();
            
            let html = `
                <h3>${prof.name || 'Sin nombre'}</h3>
                <p><strong>Email:</strong> ${prof.email || '-'}</p>
                <p><strong>Tel√©fono:</strong> ${prof.phone || '-'}</p>
                <p><strong>Ubicaci√≥n:</strong> ${prof.ciudad || ''}, ${prof.provincia || ''}</p>
                <p><strong>Rubros:</strong> ${prof.rubros ? prof.rubros.join(', ') : '-'}</p>
                <p><strong>Rating:</strong> ${prof.averageRating ? prof.averageRating.toFixed(1) : '0.0'} ‚≠ê (${prof.totalRatings || 0} calificaciones)</p>
                <p><strong>Trabajos completados:</strong> ${prof.completedJobs || 0}</p>
                <p><strong>Perfil completo:</strong> ${prof.profileCompleted ? '‚úÖ S√≠' : '‚ùå No'}</p>
                <p><strong>Cuenta bloqueada:</strong> ${prof.blocked ? '‚úÖ S√≠' : '‚ùå No'}</p>
                <p><strong>√öltima actividad:</strong> ${prof.lastActive ? new Date(prof.lastActive).toLocaleDateString('es-AR') : '-'}</p>
            `;
            
            alert(html);
        };

        window.blockProfessional = async function(id) {
            if (confirm('¬øBloquear esta cuenta?')) {
                await db.collection('professionals').doc(id).update({
                    blocked: true,
                    blockedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                loadProfessionals();
            }
        };

        window.unblockProfessional = async function(id) {
            if (confirm('¬øDesbloquear esta cuenta?')) {
                await db.collection('professionals').doc(id).update({
                    blocked: false,
                    blockedAt: null
                });
                loadProfessionals();
            }
        };

        // Trabajos
        async function loadJobs() {
            const statusFilter = document.getElementById('filterJobStatus').value;
            const dateFilter = document.getElementById('filterJobDateFrom').value;
            
            try {
                let query = db.collection('jobs').orderBy('createdAt', 'desc');
                
                if (statusFilter) {
                    query = query.where('status', '==', statusFilter);
                }
                
                const snapshot = await query.limit(100).get();
                const tbody = document.getElementById('jobsTable');
                tbody.innerHTML = '';
                
                snapshot.forEach(doc => {
                    const job = doc.data();
                    const id = doc.id;
                    
                    // Filtrar por fecha
                    if (dateFilter && job.createdAt) {
                        const jobDate = job.createdAt?.toDate ? job.createdAt.toDate() : new Date(job.createdAt);
                        const filterDate = new Date(dateFilter);
                        if (jobDate < filterDate) return;
                    }
                    
                    const date = job.createdAt?.toDate ? job.createdAt.toDate().toLocaleDateString('es-AR') : '-';
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${date}</td>
                        <td>${job.professionalName || '-'}</td>
                        <td>${job.userName || '-'}</td>
                        <td>${job.serviceType || '-'}</td>
                        <td>${job.status}</td>
                        <td>
                            <button onclick="viewJob('${id}')" class="btn btn-sm">üëÅ Ver</button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
                
            } catch (error) {
                console.error('Error cargando trabajos:', error);
            }
        }

        window.viewJob = async function(id) {
            const doc = await db.collection('jobs').doc(id).get();
            if (!doc.exists) return;
            
            const job = doc.data();
            const date = job.createdAt?.toDate ? job.createdAt.toDate().toLocaleDateString('es-AR') : '-';
            
            let html = `
                <h3>Detalle del Trabajo</h3>
                <p><strong>Servicio:</strong> ${job.serviceType || '-'}</p>
                <p><strong>Fecha:</strong> ${date}</p>
                <p><strong>Estado:</strong> ${job.status}</p>
                <p><strong>Profesional:</strong> ${job.professionalName || '-'} (${job.professionalPhone || '-'})</p>
                <p><strong>Cliente:</strong> ${job.userName || '-'} (${job.userPhone || '-'})</p>
                <p><strong>Descripci√≥n:</strong> ${job.description || '-'}</p>
                ${job.price ? `<p><strong>Precio:</strong> $${job.price.toLocaleString('es-AR')}</p>` : ''}
            `;
            
            alert(html);
        };

        // Notificaciones
        async function loadNotifications() {
            const typeFilter = document.getElementById('filterNotificationType').value;
            const container = document.getElementById('notificationsList');
            
            try {
                let query = db.collection('admin_notifications').orderBy('createdAt', 'desc');
                
                if (typeFilter) {
                    query = query.where('type', '==', typeFilter);
                }
                
                const snapshot = await query.limit(50).get();
                container.innerHTML = '';
                
                if (snapshot.empty) {
                    container.innerHTML = '<p style="color: var(--gray); text-align: center; padding: 2rem;">No hay notificaciones.</p>';
                    return;
                }
                
                snapshot.forEach(doc => {
                    const notif = doc.data();
                    const id = doc.id;
                    const date = notif.createdAt?.toDate ? notif.createdAt.toDate().toLocaleDateString('es-AR') : '-';
                    
                    let typeText = '';
                    switch(notif.type) {
                        case 'account_blocked':
                            typeText = 'üî¥ Cuenta Bloqueada';
                            break;
                        case 'job_overdue':
                            typeText = '‚ö†Ô∏è Trabajo Vencido';
                            break;
                        default:
                            typeText = '‚ÑπÔ∏è Sistema';
                    }
                    
                    container.innerHTML += `
                        <div style="background: white; border-radius: var(--radius); padding: 1.5rem; margin-bottom: 1rem; border-left: 4px solid var(--warning);">
                            <div style="display: flex; justify-content: space-between; align-items: start;">
                                <div>
                                    <h4 style="margin: 0;">${typeText}</h4>
                                    <p style="margin: 0.5rem 0;">${notif.reason || notif.message || ''}</p>
                                    <small style="color: var(--gray);">${date}</small>
                                </div>
                                <button onclick="deleteNotification('${id}')" class="btn btn-sm btn-danger">üóëÔ∏è</button>
                            </div>
                            ${notif.professionalName ? `<p><strong>Profesional:</strong> ${notif.professionalName}</p>` : ''}
                        </div>
                    `;
                });
                
            } catch (error) {
                console.error('Error cargando notificaciones:', error);
            }
        }

        window.deleteNotification = async function(id) {
            if (confirm('¬øEliminar esta notificaci√≥n?')) {
                await db.collection('admin_notifications').doc(id).delete();
                loadNotifications();
            }
        };

        window.clearAllNotifications = async function() {
            if (confirm('¬øEliminar todas las notificaciones?')) {
                const snapshot = await db.collection('admin_notifications').get();
                const batch = db.batch();
                
                snapshot.forEach(doc => {
                    batch.delete(doc.ref);
                });
                
                await batch.commit();
                loadNotifications();
            }
        };

        // Certificaciones
        async function loadCertifications() {
            const statusFilter = document.getElementById('filterCertificationStatus').value;
            
            try {
                const query = db.collection('certifications')
                    .where('status', '==', statusFilter)
                    .orderBy('createdAt', 'desc');
                
                const snapshot = await query.get();
                const tbody = document.getElementById('certificationsTable');
                tbody.innerHTML = '';
                
                for (const doc of snapshot.docs) {
                    const cert = doc.data();
                    const id = doc.id;
                    
                    // Obtener informaci√≥n del profesional
                    let professionalName = 'Desconocido';
                    try {
                        const profDoc = await db.collection('professionals').doc(cert.professionalId).get();
                        if (profDoc.exists) {
                            professionalName = profDoc.data().name || 'Desconocido';
                        }
                    } catch (error) {
                        console.error('Error obteniendo profesional:', error);
                    }
                    
                    const date = cert.createdAt?.toDate ? cert.createdAt.toDate().toLocaleDateString('es-AR') : '-';
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${professionalName}</td>
                        <td>${cert.title}</td>
                        <td>${cert.institution}</td>
                        <td>${date}</td>
                        <td>
                            <span class="badge ${cert.status === 'aprobada' ? 'badge-success' : cert.status === 'rechazada' ? 'badge-danger' : 'badge-warning'}">
                                ${cert.status === 'aprobada' ? 'APROBADA' : cert.status === 'rechazada' ? 'RECHAZADA' : 'PENDIENTE'}
                            </span>
                        </td>
                        <td>
                            <div class="btn-group">
                                ${cert.status === 'pendiente' ? `
                                    <button onclick="approveCertification('${id}')" class="btn btn-success btn-sm">‚úÖ Aprobar</button>
                                    <button onclick="rejectCertification('${id}')" class="btn btn-danger btn-sm">‚ùå Rechazar</button>
                                ` : ''}
                                ${cert.documentUrl ? `
                                    <button onclick="window.open('${cert.documentUrl}', '_blank')" class="btn btn-sm">üìÑ Ver</button>
                                ` : ''}
                            </div>
                        </td>
                    `;
                    tbody.appendChild(row);
                }
                
            } catch (error) {
                console.error('Error cargando certificaciones:', error);
            }
        }

        window.approveCertification = async function(id) {
            if (confirm('¬øAprobar esta certificaci√≥n?')) {
                try {
                    const certDoc = await db.collection('certifications').doc(id).get();
                    const cert = certDoc.data();
                    
                    await db.collection('certifications').doc(id).update({
                        status: 'aprobada',
                        approvedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    // Actualizar perfil del profesional
                    await db.collection('professionals').doc(cert.professionalId).update({
                        certifications: firebase.firestore.FieldValue.arrayUnion({
                            title: cert.title,
                            institution: cert.institution,
                            documentUrl: cert.documentUrl,
                            approvedAt: new Date().toISOString()
                        })
                    });
                    
                    loadCertifications();
                    
                } catch (error) {
                    console.error('Error aprobando certificaci√≥n:', error);
                }
            }
        };

        window.rejectCertification = async function(id) {
            if (confirm('¬øRechazar esta certificaci√≥n?')) {
                await db.collection('certifications').doc(id).update({
                    status: 'rechazada',
                    rejectedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                loadCertifications();
            }
        };

        // Banners
        async function loadBanners() {
            try {
                const snapshot = await db.collection('banners').orderBy('createdAt', 'desc').get();
                const tbody = document.getElementById('bannersTable');
                tbody.innerHTML = '';
                
                snapshot.forEach(doc => {
                    const banner = doc.data();
                    const id = doc.id;
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>
                            <img src="${banner.imageUrl}" 
                                 style="width: 100px; height: 60px; object-fit: cover; border-radius: 4px;"
                                 onerror="this.src='https://via.placeholder.com/100x60'">
                        </td>
                        <td>${banner.link || '-'}</td>
                        <td>${banner.type || 'nacional'}</td>
                        <td>
                            <span class="badge ${banner.active ? 'badge-success' : 'badge-danger'}">
                                ${banner.active ? 'ACTIVO' : 'INACTIVO'}
                            </span>
                        </td>
                        <td>
                            <div class="btn-group">
                                ${banner.active ? 
                                    `<button onclick="toggleBanner('${id}', false)" class="btn btn-warning btn-sm">üö´ Desactivar</button>` :
                                    `<button onclick="toggleBanner('${id}', true)" class="btn btn-success btn-sm">‚úÖ Activar</button>`
                                }
                                <button onclick="deleteBanner('${id}')" class="btn btn-danger btn-sm">üóëÔ∏è Eliminar</button>
                            </div>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
                
            } catch (error) {
                console.error('Error cargando banners:', error);
            }
        }

        window.createBanner = async function() {
            const imageUrl = document.getElementById('bannerImageUrl').value.trim();
            const linkUrl = document.getElementById('bannerLinkUrl').value.trim();
            const type = document.getElementById('bannerType').value;
            
            if (!imageUrl || !linkUrl) {
                alert('Complet√° todos los campos');
                return;
            }
            
            try {
                await db.collection('banners').add({
                    imageUrl,
                    link: linkUrl,
                    type,
                    active: true,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                document.getElementById('bannerImageUrl').value = '';
                document.getElementById('bannerLinkUrl').value = '';
                loadBanners();
                
            } catch (error) {
                console.error('Error creando banner:', error);
            }
        };

        window.toggleBanner = async function(id, activate) {
            await db.collection('banners').doc(id).update({
                active: activate
            });
            loadBanners();
        };

        window.deleteBanner = async function(id) {
            if (confirm('¬øEliminar este banner?')) {
                await db.collection('banners').doc(id).delete();
                loadBanners();
            }
        };

        // Utilidades
        function showMessage(elementId, text, type) {
            const el = document.getElementById(elementId);
            el.textContent = text;
            el.className = `message message-${type}`;
            el.style.display = 'block';
        }
    </script>
</body>
</html>
