<!DOCTYPE html>
<html lang="es-AR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TecniYa - Panel Administrador</title>
    <meta name="description" content="Panel de administraci√≥n para gestionar profesionales, trabajos y sistema.">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%23dc3545'/><text x='50' y='70' text-anchor='middle' font-size='60' fill='white'>üîß</text></svg>">
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    
    <!-- CSS -->
    <style>
        :root {
            --primary: #0a4fd8;
            --primary-dark: #083bb5;
            --secondary: #1db954;
            --danger: #dc3545;
            --warning: #ffc107;
            --info: #17a2b8;
            --light: #f8f9fa;
            --dark: #333;
            --gray: #666;
            --light-gray: #e1e5e9;
            --shadow: 0 4px 12px rgba(10, 79, 216, 0.15);
            --radius: 12px;
        }
        
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
        }
        
        /* Layout */
        .container { 
            width: 100%; 
            max-width: 1400px; 
            margin: 0 auto; 
            padding: 20px; 
        }
        
        /* Header */
        .header { 
            background: linear-gradient(135deg, var(--dark) 0%, #555 100%); 
            color: white; 
            padding: 25px 20px; 
            text-align: center; 
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .header h1 { 
            font-size: 2rem; 
            margin-bottom: 8px; 
            font-weight: 800; 
        }
        
        /* Login */
        .login-container { 
            max-width: 500px; 
            margin: 80px auto; 
            padding: 40px; 
            background: white; 
            border-radius: 16px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); 
        }
        
        .login-title { 
            text-align: center; 
            font-size: 1.8rem; 
            margin-bottom: 30px; 
        }
        
        /* Tabs */
        .tabs { 
            display: flex; 
            background: white; 
            border-bottom: 2px solid #eaeaea; 
            overflow-x: auto; 
            flex-wrap: wrap; 
            position: sticky;
            top: 0;
            z-index: 90;
        }
        
        .tab { 
            padding: 18px 25px; 
            font-weight: 600; 
            cursor: pointer; 
            border-bottom: 3px solid transparent; 
            white-space: nowrap; 
            transition: all 0.2s;
        }
        
        .tab:hover {
            background-color: #f8f9fa;
        }
        
        .tab.active { 
            border-bottom-color: var(--danger); 
            color: var(--danger); 
            background-color: #fff5f5; 
        }
        
        /* Panels */
        .panel { 
            display: none; 
            background: white; 
            padding: 30px; 
            border-radius: 0 0 var(--radius) var(--radius); 
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); 
            min-height: 500px;
        }
        
        .panel.active { 
            display: block; 
        }
        
        /* Forms */
        .form-group { 
            margin-bottom: 25px; 
        }
        
        .form-label { 
            display: block; 
            font-weight: 600; 
            margin-bottom: 10px; 
        }
        
        .form-input, .form-select { 
            width: 100%; 
            padding: 15px; 
            border: 2px solid var(--light-gray); 
            border-radius: 10px; 
            font-size: 1rem; 
            transition: border-color 0.3s;
        }
        
        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        /* Tables */
        .data-table { 
            width: 100%; 
            border-collapse: collapse; 
            margin-top: 20px; 
        }
        
        .data-table th, .data-table td { 
            padding: 15px; 
            text-align: left; 
            border-bottom: 1px solid #eaeaea; 
        }
        
        .data-table th { 
            background-color: #f8f9fa; 
            font-weight: 700; 
            position: sticky;
            top: 0;
        }
        
        .table-container { 
            max-height: 600px; 
            overflow-y: auto; 
            border: 1px solid #eaeaea; 
            border-radius: var(--radius); 
        }
        
        /* Stats */
        .stats-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
            gap: 25px; 
            margin: 30px 0; 
        }
        
        .stat-card { 
            background: #f8f9fa; 
            padding: 25px; 
            border-radius: var(--radius); 
            text-align: center; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            transition: transform 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-number { 
            font-size: 2.5rem; 
            font-weight: 700; 
            color: var(--primary); 
        }
        
        /* Buttons */
        .btn { 
            padding: 12px 24px; 
            border-radius: 8px; 
            font-size: 1rem; 
            font-weight: 600; 
            cursor: pointer; 
            border: none; 
            transition: all 0.3s; 
            display: inline-flex; 
            align-items: center; 
            gap: 8px; 
        }
        
        .btn-primary { 
            background-color: var(--primary); 
            color: white; 
        }
        
        .btn-primary:hover {
            background-color: var(--primary-dark);
        }
        
        .btn-danger { 
            background-color: var(--danger); 
            color: white; 
        }
        
        .btn-success { 
            background-color: var(--secondary); 
            color: white; 
        }
        
        .btn-sm { 
            padding: 8px 16px; 
            font-size: 0.9rem; 
        }
        
        .btn-group { 
            display: flex; 
            gap: 10px; 
            flex-wrap: wrap; 
        }
        
        /* Badges */
        .badge { 
            display: inline-block; 
            padding: 5px 12px; 
            border-radius: 20px; 
            font-size: 0.85rem; 
            font-weight: 700; 
        }
        
        .badge-success { 
            background: #d4edda; 
            color: #155724; 
        }
        
        .badge-warning { 
            background: #fff3cd; 
            color: #856404; 
        }
        
        .badge-danger { 
            background: #f8d7da; 
            color: #721c24; 
        }
        
        /* Messages */
        .message {
            padding: 1.5rem;
            border-radius: var(--radius);
            margin-bottom: 1.5rem;
            font-weight: 600;
        }
        
        .message-success {
            background: #d4edda;
            color: #155724;
        }
        
        .message-error {
            background: #f8d7da;
            color: #721c24;
        }
        
        /* Filters */
        .filters { 
            background: #f8f9fa; 
            padding: 20px; 
            border-radius: var(--radius); 
            margin-bottom: 30px; 
            display: flex; 
            gap: 20px; 
            flex-wrap: wrap; 
        }
        
        .filter-group { 
            display: flex; 
            align-items: center; 
            gap: 10px; 
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            padding: 2.5rem;
            border-radius: var(--radius);
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        /* Loader */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 2rem auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .filters { 
                flex-direction: column; 
            }
            
            .tabs { 
                flex-direction: column; 
            }
            
            .tab { 
                text-align: center; 
            }
            
            .btn-group {
                flex-direction: column;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Login -->
    <div id="loginContainer" class="login-container">
        <h2 class="login-title">üîê Admin TecniYa</h2>
        <div class="form-group">
            <label class="form-label">Email</label>
            <input type="email" id="loginEmail" class="form-input" placeholder="admin@tecniya.com">
        </div>
        <div class="form-group">
            <label class="form-label">Contrase√±a</label>
            <input type="password" id="loginPassword" class="form-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
        </div>
        <button id="loginBtn" class="btn btn-primary" style="width: 100%;">Ingresar</button>
        <div id="loginMessage" class="message" style="display: none;"></div>
        
        <div style="text-align: center; margin-top: 20px; color: #666;">
            <p>Credenciales de prueba:</p>
            <p><strong>Email:</strong> admin@tecniya.com</p>
            <p><strong>Contrase√±a:</strong> admin123</p>
        </div>
    </div>
    
    <!-- Admin Panel -->
    <div id="adminPanel" style="display: none;">
        <header class="header">
            <h1>‚öô Panel Administrador TecniYa</h1>
            <p style="opacity: 0.9;">Gesti√≥n completa del sistema</p>
        </header>
        
        <div class="container">
            <!-- Tabs -->
            <div class="tabs">
                <div class="tab active" data-tab="dashboard">üìä Dashboard</div>
                <div class="tab" data-tab="professionals">üë®‚Äçüîß Profesionales</div>
                <div class="tab" data-tab="jobs">üõ†Ô∏è Trabajos</div>
                <div class="tab" data-tab="notifications">üîî Notificaciones</div>
                <div class="tab" data-tab="certifications">üìú Certificaciones</div>
                <div class="tab" data-tab="banners">üéØ Banners</div>
                <div class="tab" data-tab="system">‚öôÔ∏è Sistema</div>
                <div class="tab" id="logoutBtn">üö™ Cerrar Sesi√≥n</div>
            </div>
            
            <!-- Dashboard -->
            <div id="dashboardPanel" class="panel active">
                <h2>Dashboard del Sistema</h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalProfessionals">0</div>
                        <div>Total Profesionales</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="activeJobs">0</div>
                        <div>Trabajos Activos</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="pendingCertifications">0</div>
                        <div>Cert. Pendientes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="blockedAccounts">0</div>
                        <div>Cuentas Bloqueadas</div>
                    </div>
                </div>
                
                <div style="margin-top: 50px;">
                    <h3>üìà Actividad Reciente</h3>
                    <div id="recentActivity" class="table-container">
                        <div class="loader" id="activityLoader"></div>
                    </div>
                </div>
            </div>
            
            <!-- Professionals -->
            <div id="professionalsPanel" class="panel">
                <h2>Gesti√≥n de Profesionales</h2>
                
                <div class="filters">
                    <div class="filter-group">
                        <label>Estado:</label>
                        <select id="filterProfessionalStatus" class="form-select" style="width: 200px;">
                            <option value="">Todos</option>
                            <option value="active">Activos</option>
                            <option value="blocked">Bloqueados</option>
                            <option value="incomplete">Incompletos</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Provincia:</label>
                        <select id="filterProfessionalProvincia" class="form-select" style="width: 200px;">
                            <option value="">Todas</option>
                        </select>
                    </div>
                    <button id="applyProfessionalFilters" class="btn btn-primary">üîç Filtrar</button>
                    <button id="resetProfessionalFilters" class="btn btn-secondary">üîÑ Limpiar</button>
                </div>
                
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Nombre</th>
                                <th>Contacto</th>
                                <th>Ubicaci√≥n</th>
                                <th>Estado</th>
                                <th>Rating</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="professionalsTable">
                            <!-- JS llenar√° esto -->
                        </tbody>
                    </table>
                    <div class="loader" id="professionalsLoader" style="display: none;"></div>
                </div>
            </div>
            
            <!-- Jobs -->
            <div id="jobsPanel" class="panel">
                <h2>Gesti√≥n de Trabajos</h2>
                
                <div class="filters">
                    <div class="filter-group">
                        <label>Estado:</label>
                        <select id="filterJobStatus" class="form-select" style="width: 200px;">
                            <option value="">Todos</option>
                            <option value="pendiente">Pendientes</option>
                            <option value="en_progreso">En Progreso</option>
                            <option value="completado">Completados</option>
                            <option value="cancelado">Cancelados</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Desde:</label>
                        <input type="date" id="filterJobDateFrom" class="form-input" style="width: 150px;">
                    </div>
                    <button id="applyJobFilters" class="btn btn-primary">üîç Filtrar</button>
                    <button id="resetJobFilters" class="btn btn-secondary">üîÑ Limpiar</button>
                </div>
                
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Profesional</th>
                                <th>Cliente</th>
                                <th>Servicio</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="jobsTable">
                            <!-- JS llenar√° esto -->
                        </tbody>
                    </table>
                    <div class="loader" id="jobsLoader" style="display: none;"></div>
                </div>
            </div>
            
            <!-- Notifications -->
            <div id="notificationsPanel" class="panel">
                <h2>Sistema de Notificaciones</h2>
                
                <div class="filters">
                    <div class="filter-group">
                        <label>Tipo:</label>
                        <select id="filterNotificationType" class="form-select" style="width: 200px;">
                            <option value="">Todas</option>
                            <option value="account_blocked">Cuentas Bloqueadas</option>
                            <option value="job_overdue">Trabajos Vencidos</option>
                            <option value="system">Sistema</option>
                        </select>
                    </div>
                    <button id="applyNotificationFilters" class="btn btn-primary">üîç Filtrar</button>
                    <button onclick="clearAllNotifications()" class="btn btn-danger">üóëÔ∏è Limpiar Todas</button>
                </div>
                
                <div id="notificationsList">
                    <div class="loader" id="notificationsLoader"></div>
                </div>
            </div>
            
            <!-- Certifications -->
            <div id="certificationsPanel" class="panel">
                <h2>Gesti√≥n de Certificaciones</h2>
                
                <div class="filters">
                    <div class="filter-group">
                        <label>Estado:</label>
                        <select id="filterCertificationStatus" class="form-select" style="width: 200px;">
                            <option value="pendiente">Pendientes</option>
                            <option value="aprobada">Aprobadas</option>
                            <option value="rechazada">Rechazadas</option>
                        </select>
                    </div>
                    <button id="applyCertificationFilters" class="btn btn-primary">üîç Filtrar</button>
                </div>
                
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Profesional</th>
                                <th>Certificaci√≥n</th>
                                <th>Instituci√≥n</th>
                                <th>Fecha</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="certificationsTable">
                            <!-- JS llenar√° esto -->
                        </tbody>
                    </table>
                    <div class="loader" id="certificationsLoader" style="display: none;"></div>
                </div>
            </div>
            
            <!-- Banners -->
            <div id="bannersPanel" class="panel">
                <h2>Gesti√≥n de Banners</h2>
                
                <div style="background: #f8f9fa; padding: 25px; border-radius: var(--radius); margin-bottom: 30px;">
                    <h3>Crear Nuevo Banner</h3>
                    <div class="form-group">
                        <label class="form-label">URL de la Imagen</label>
                        <input type="text" id="bannerImageUrl" class="form-input" placeholder="https://ejemplo.com/banner.jpg">
                    </div>
                    <div class="form-group">
                        <label class="form-label">URL de Enlace</label>
                        <input type="text" id="bannerLinkUrl" class="form-input" placeholder="https://ejemplo.com/promocion">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Tipo</label>
                        <select id="bannerType" class="form-select">
                            <option value="nacional">Nacional</option>
                            <option value="provincial">Provincial</option>
                        </select>
                    </div>
                    <button onclick="createBanner()" class="btn btn-primary">üéØ Crear Banner</button>
                </div>
                
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Imagen</th>
                                <th>Enlace</th>
                                <th>Tipo</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="bannersTable">
                            <!-- JS llenar√° esto -->
                        </tbody>
                    </table>
                    <div class="loader" id="bannersLoader" style="display: none;"></div>
                </div>
            </div>
            
            <!-- System Configuration -->
            <div id="systemPanel" class="panel">
                <h2>‚öôÔ∏è Configuraci√≥n del Sistema</h2>
                
                <div style="background: #f8f9fa; padding: 25px; border-radius: var(--radius); margin-bottom: 30px;">
                    <h3>üîß Configuraci√≥n General</h3>
                    <div class="form-group">
                        <label class="form-label">Nombre del Sistema</label>
                        <input type="text" id="systemName" class="form-input" placeholder="TecniYa" value="TecniYa">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email de Contacto</label>
                        <input type="email" id="systemEmail" class="form-input" placeholder="contacto@tecniya.com" value="contacto@tecniya.com">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Tel√©fono de Contacto</label>
                        <input type="tel" id="systemPhone" class="form-input" placeholder="341 755-8966" value="341 755-8966">
                    </div>
                    <button onclick="saveSystemConfig()" class="btn btn-primary">üíæ Guardar Configuraci√≥n</button>
                </div>
                
                <div style="background: #f8f9fa; padding: 25px; border-radius: var(--radius); margin-bottom: 30px;">
                    <h3>üìä Datos de Prueba</h3>
                    <p>Genera datos de prueba para probar todas las funcionalidades del sistema.</p>
                    <div class="btn-group">
                        <button onclick="generateTestData()" class="btn btn-primary">üì¶ Generar Datos de Prueba</button>
                        <button onclick="clearTestData()" class="btn btn-danger">üóëÔ∏è Limpiar Datos de Prueba</button>
                    </div>
                </div>
                
                <div style="background: #f8f9fa; padding: 25px; border-radius: var(--radius);">
                    <h3>üìã Informaci√≥n del Sistema</h3>
                    <div id="systemInfo">
                        <p><strong>Versi√≥n:</strong> 2.0.0</p>
                        <p><strong>Firebase:</strong> Conectado</p>
                        <p><strong>√öltima Actualizaci√≥n:</strong> <span id="lastUpdate">Hoy</span></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Professional Details Modal -->
    <div id="professionalModal" class="modal">
        <div class="modal-content">
            <h3>Detalles del Profesional</h3>
            <div id="professionalDetails"></div>
            <div style="text-align: right; margin-top: 20px;">
                <button onclick="closeProfessionalModal()" class="btn btn-secondary">Cerrar</button>
            </div>
        </div>
    </div>
    
    <!-- Job Details Modal -->
    <div id="jobModal" class="modal">
        <div class="modal-content">
            <h3>Detalles del Trabajo</h3>
            <div id="jobDetails"></div>
            <div style="text-align: right; margin-top: 20px;">
                <button onclick="closeJobModal()" class="btn btn-secondary">Cerrar</button>
            </div>
        </div>
    </div>

    <script>
        // Configuraci√≥n Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBzDfYDdzmN9J_Y8gG06aqH0OtlzFhafFY",
            authDomain: "tecniya-b4206.firebaseapp.com",
            projectId: "tecniya-b4206",
            storageBucket: "tecniya-b4206.firebasestorage.app",
            messagingSenderId: "166424133304",
            appId: "1:166424133304:web:d1ad23bd4ea1af10437e4d"
        };

        // Variables globales
        let auth, db;
        let currentProfessionalData = null;

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', () => {
            try {
                firebase.initializeApp(firebaseConfig);
                auth = firebase.auth();
                db = firebase.firestore();
                
                // Event listeners
                document.getElementById('loginBtn').addEventListener('click', handleLogin);
                document.getElementById('logoutBtn').addEventListener('click', handleLogout);
                
                // Tabs
                document.querySelectorAll('.tab[data-tab]').forEach(tab => {
                    tab.addEventListener('click', () => switchTab(tab.dataset.tab));
                });
                
                // Filtros
                document.getElementById('applyProfessionalFilters').addEventListener('click', loadProfessionals);
                document.getElementById('resetProfessionalFilters').addEventListener('click', resetProfessionalFilters);
                document.getElementById('applyJobFilters').addEventListener('click', loadJobs);
                document.getElementById('resetJobFilters').addEventListener('click', resetJobFilters);
                document.getElementById('applyNotificationFilters').addEventListener('click', loadNotifications);
                document.getElementById('applyCertificationFilters').addEventListener('click', loadCertifications);
                
                // Enter key for login
                document.getElementById('loginPassword').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') handleLogin();
                });
                
                // Cargar provincias
                loadProvincias();
                
                // Verificar autenticaci√≥n
                auth.onAuthStateChanged(handleAuthStateChange);
                
            } catch (error) {
                console.error('Error inicializando:', error);
                showMessage('loginMessage', '‚ùå Error inicializando Firebase: ' + error.message, 'error');
            }
        });

        // Autenticaci√≥n
        async function handleLogin() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                showMessage('loginMessage', '‚ùå Por favor completa todos los campos', 'error');
                return;
            }
            
            showMessage('loginMessage', 'üîê Iniciando sesi√≥n...', 'success');
            
            try {
                await auth.signInWithEmailAndPassword(email, password);
            } catch (error) {
                console.error('Error login:', error);
                showMessage('loginMessage', '‚ùå Error: ' + error.message, 'error');
            }
        }

        function handleLogout() {
            if (confirm('¬øEst√°s seguro de cerrar sesi√≥n?')) {
                auth.signOut();
            }
        }

        function handleAuthStateChange(user) {
            const loginContainer = document.getElementById('loginContainer');
            const adminPanel = document.getElementById('adminPanel');
            
            // Permitir cualquier usuario de Firebase para pruebas
            // En producci√≥n, restringir a admin@tecniya.com
            if (user) {
                console.log('Usuario autenticado:', user.email);
                loginContainer.style.display = 'none';
                adminPanel.style.display = 'block';
                loadDashboard();
                loadProfessionals();
            } else {
                loginContainer.style.display = 'block';
                adminPanel.style.display = 'none';
                // Resetear campos de login
                document.getElementById('loginPassword').value = '';
            }
        }

        // Navegaci√≥n
        function switchTab(tabId) {
            // Actualizar tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelector(`.tab[data-tab="${tabId}"]`).classList.add('active');
            
            // Actualizar paneles
            document.querySelectorAll('.panel').forEach(panel => {
                panel.classList.remove('active');
            });
            
            document.getElementById(`${tabId}Panel`).classList.add('active');
            
            // Cargar datos espec√≠ficos de cada tab
            if (tabId === 'dashboard') loadDashboard();
            if (tabId === 'professionals') loadProfessionals();
            if (tabId === 'jobs') loadJobs();
            if (tabId === 'notifications') loadNotifications();
            if (tabId === 'certifications') loadCertifications();
            if (tabId === 'banners') loadBanners();
            if (tabId === 'system') loadSystemInfo();
        }

        // Dashboard
        async function loadDashboard() {
            try {
                // Total profesionales
                const professionalsSnapshot = await db.collection('professionals').get();
                document.getElementById('totalProfessionals').textContent = professionalsSnapshot.size;
                
                // Trabajos activos
                const jobsSnapshot = await db.collection('jobs')
                    .where('status', 'in', ['pendiente', 'en_progreso'])
                    .get();
                document.getElementById('activeJobs').textContent = jobsSnapshot.size;
                
                // Certificaciones pendientes
                const certsSnapshot = await db.collection('certifications')
                    .where('status', '==', 'pendiente')
                    .get();
                document.getElementById('pendingCertifications').textContent = certsSnapshot.size;
                
                // Cuentas bloqueadas
                const blockedSnapshot = await db.collection('professionals')
                    .where('blocked', '==', true)
                    .get();
                document.getElementById('blockedAccounts').textContent = blockedSnapshot.size;
                
                // Actividad reciente
                loadRecentActivity();
                
            } catch (error) {
                console.error('Error cargando dashboard:', error);
            }
        }

        async function loadRecentActivity() {
            const container = document.getElementById('recentActivity');
            
            try {
                // Ocultar loader
                document.getElementById('activityLoader').style.display = 'none';
                
                // √öltimos trabajos
                const jobsSnapshot = await db.collection('jobs')
                    .orderBy('createdAt', 'desc')
                    .limit(10)
                    .get();
                
                if (jobsSnapshot.empty) {
                    container.innerHTML = '<p style="text-align: center; padding: 20px; color: #666;">No hay actividad reciente</p>';
                    return;
                }
                
                let html = '<table class="data-table">';
                html += '<tr><th>Fecha</th><th>Profesional</th><th>Cliente</th><th>Estado</th></tr>';
                
                jobsSnapshot.forEach(doc => {
                    const job = doc.data();
                    const date = job.createdAt?.toDate ? job.createdAt.toDate().toLocaleDateString('es-AR') : '-';
                    
                    html += `
                        <tr>
                            <td>${date}</td>
                            <td>${job.professionalName || '-'}</td>
                            <td>${job.userName || '-'}</td>
                            <td><span class="badge ${getStatusBadgeClass(job.status)}">${getStatusText(job.status)}</span></td>
                        </tr>
                    `;
                });
                
                html += '</table>';
                container.innerHTML = html;
                
            } catch (error) {
                console.error('Error cargando actividad:', error);
                container.innerHTML = '<p style="color: var(--danger); text-align: center; padding: 20px;">Error cargando actividad</p>';
            }
        }

        function getStatusBadgeClass(status) {
            switch(status) {
                case 'completado': return 'badge-success';
                case 'cancelado': return 'badge-danger';
                case 'en_progreso': return 'badge-warning';
                default: return 'badge-warning';
            }
        }

        function getStatusText(status) {
            const statusMap = {
                'pendiente': 'Pendiente',
                'en_progreso': 'En Progreso',
                'completado': 'Completado',
                'cancelado': 'Cancelado'
            };
            return statusMap[status] || status;
        }

        // Profesionales
        function loadProvincias() {
            const provincias = [
                "Buenos Aires", "CABA", "Catamarca", "Chaco", "Chubut",
                "C√≥rdoba", "Corrientes", "Entre R√≠os", "Formosa", "Jujuy",
                "La Pampa", "La Rioja", "Mendoza", "Misiones", "Neuqu√©n",
                "R√≠o Negro", "Salta", "San Juan", "San Luis", "Santa Cruz",
                "Santa Fe", "Santiago del Estero", "Tierra del Fuego", "Tucum√°n"
            ];
            
            const select = document.getElementById('filterProfessionalProvincia');
            provincias.sort().forEach(provincia => {
                const option = document.createElement('option');
                option.value = provincia;
                option.textContent = provincia;
                select.appendChild(option);
            });
        }

        function resetProfessionalFilters() {
            document.getElementById('filterProfessionalStatus').value = '';
            document.getElementById('filterProfessionalProvincia').value = '';
            loadProfessionals();
        }

        function resetJobFilters() {
            document.getElementById('filterJobStatus').value = '';
            document.getElementById('filterJobDateFrom').value = '';
            loadJobs();
        }

        async function loadProfessionals() {
            const statusFilter = document.getElementById('filterProfessionalStatus').value;
            const provinciaFilter = document.getElementById('filterProfessionalProvincia').value;
            const tbody = document.getElementById('professionalsTable');
            
            // Mostrar loader
            tbody.innerHTML = '';
            document.getElementById('professionalsLoader').style.display = 'block';
            
            try {
                let query = db.collection('professionals');
                
                if (statusFilter === 'blocked') {
                    query = query.where('blocked', '==', true);
                } else if (statusFilter === 'active') {
                    query = query.where('active', '==', true);
                } else if (statusFilter === 'incomplete') {
                    query = query.where('profileCompleted', '==', false);
                }
                
                if (provinciaFilter) {
                    query = query.where('provincia', '==', provinciaFilter);
                }
                
                const snapshot = await query.get();
                
                // Ocultar loader
                document.getElementById('professionalsLoader').style.display = 'none';
                
                if (snapshot.empty) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 40px; color: #666;">
                                No se encontraron profesionales con los filtros seleccionados
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                let html = '';
                snapshot.forEach(doc => {
                    const prof = doc.data();
                    const id = doc.id;
                    
                    let statusBadge = '';
                    if (prof.blocked) {
                        statusBadge = '<span class="badge badge-danger">BLOQUEADO</span>';
                    } else if (!prof.profileCompleted) {
                        statusBadge = '<span class="badge badge-warning">INCOMPLETO</span>';
                    } else {
                        statusBadge = '<span class="badge badge-success">ACTIVO</span>';
                    }
                    
                    const rating = prof.averageRating || 0;
                    const stars = '‚≠ê'.repeat(Math.floor(rating)) + '‚òÜ'.repeat(5 - Math.floor(rating));
                    
                    html += `
                        <tr>
                            <td>
                                <strong>${prof.name || 'Sin nombre'}</strong><br>
                                <small>${prof.email || ''}</small>
                            </td>
                            <td>${prof.phone || 'Sin tel√©fono'}<br>
                                <small>${prof.email || ''}</small>
                            </td>
                            <td>${prof.ciudad || ''}, ${prof.provincia || ''}</td>
                            <td>${statusBadge}</td>
                            <td>${stars}<br>${rating.toFixed(1)}/5</td>
                            <td>
                                <div class="btn-group">
                                    <button onclick="viewProfessionalDetails('${id}')" class="btn btn-sm">üëÅ Ver</button>
                                    ${prof.blocked ? 
                                        `<button onclick="unblockProfessional('${id}')" class="btn btn-success btn-sm">üîì Desbloquear</button>` :
                                        `<button onclick="blockProfessional('${id}')" class="btn btn-danger btn-sm">üö´ Bloquear</button>`
                                    }
                                </div>
                            </td>
                        </tr>
                    `;
                });
                
                tbody.innerHTML = html;
                
            } catch (error) {
                console.error('Error cargando profesionales:', error);
                document.getElementById('professionalsLoader').style.display = 'none';
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px; color: var(--danger);">
                            Error cargando profesionales: ${error.message}
                        </td>
                    </tr>
                `;
            }
        }

        window.viewProfessionalDetails = async function(id) {
            try {
                const doc = await db.collection('professionals').doc(id).get();
                if (!doc.exists) {
                    alert('Profesional no encontrado');
                    return;
                }
                
                const prof = doc.data();
                currentProfessionalData = { id, ...prof };
                
                let html = `
                    <div style="display: flex; gap: 20px; margin-bottom: 20px; flex-wrap: wrap;">
                        <div>
                            <img src="${prof.photoUrl || 'https://via.placeholder.com/150x150/2563eb/ffffff?text=T'}" 
                                 style="width: 150px; height: 150px; border-radius: 50%; object-fit: cover; border: 3px solid var(--primary);"
                                 onerror="this.src='https://via.placeholder.com/150x150/2563eb/ffffff?text=T'">
                        </div>
                        <div style="flex: 1;">
                            <h4 style="margin-bottom: 10px;">${prof.name || 'Sin nombre'}</h4>
                            <p><strong>Email:</strong> ${prof.email || '-'}</p>
                            <p><strong>Tel√©fono:</strong> ${prof.phone || '-'}</p>
                            <p><strong>Ubicaci√≥n:</strong> ${prof.ciudad || ''}, ${prof.provincia || ''}</p>
                            <p><strong>Rating:</strong> ${prof.averageRating ? prof.averageRating.toFixed(1) : '0.0'} ‚≠ê (${prof.totalRatings || 0} calificaciones)</p>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0;">
                        <div style="background: #f8f9fa; padding: 15px; border-radius: var(--radius);">
                            <strong>Trabajos Completados</strong><br>
                            <span style="font-size: 1.5rem;">${prof.completedJobs || 0}</span>
                        </div>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: var(--radius);">
                            <strong>Perfil Completo</strong><br>
                            <span style="font-size: 1.5rem;">${prof.profileCompleted ? '‚úÖ S√≠' : '‚ùå No'}</span>
                        </div>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: var(--radius);">
                            <strong>Estado</strong><br>
                            <span style="font-size: 1.5rem;">${prof.blocked ? 'üö´ Bloqueado' : '‚úÖ Activo'}</span>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <strong>Rubros:</strong><br>
                        <div style="display: flex; flex-wrap: wrap; gap: 5px; margin-top: 10px;">
                            ${prof.rubros ? prof.rubros.map(r => `<span style="background: var(--primary-light); color: var(--primary); padding: 4px 8px; border-radius: 12px; font-size: 0.9rem;">${r}</span>`).join('') : 'Sin rubros'}
                        </div>
                    </div>
                    
                    ${prof.bio ? `<div style="margin-top: 20px;"><strong>Bio:</strong><br>${prof.bio}</div>` : ''}
                    
                    <div style="margin-top: 20px;">
                        <strong>√öltima actividad:</strong> ${prof.lastActive ? new Date(prof.lastActive).toLocaleString('es-AR') : '-'}
                    </div>
                `;
                
                document.getElementById('professionalDetails').innerHTML = html;
                document.getElementById('professionalModal').classList.add('active');
                
            } catch (error) {
                console.error('Error cargando detalles:', error);
                alert('Error al cargar detalles del profesional');
            }
        };

        window.closeProfessionalModal = function() {
            document.getElementById('professionalModal').classList.remove('active');
            currentProfessionalData = null;
        };

        window.blockProfessional = async function(id) {
            if (confirm('¬øEst√°s seguro de bloquear esta cuenta? El profesional no podr√° acceder al sistema.')) {
                try {
                    await db.collection('professionals').doc(id).update({
                        blocked: true,
                        blockedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    // Crear notificaci√≥n
                    await db.collection('admin_notifications').add({
                        type: 'account_blocked',
                        professionalId: id,
                        professionalName: currentProfessionalData?.name || 'Profesional',
                        reason: 'Cuenta bloqueada por administrador',
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    loadProfessionals();
                    showNotification('‚úÖ Profesional bloqueado exitosamente');
                    
                } catch (error) {
                    console.error('Error bloqueando profesional:', error);
                    alert('Error al bloquear profesional: ' + error.message);
                }
            }
        };

        window.unblockProfessional = async function(id) {
            if (confirm('¬øEst√°s seguro de desbloquear esta cuenta?')) {
                try {
                    await db.collection('professionals').doc(id).update({
                        blocked: false,
                        blockedAt: null
                    });
                    
                    loadProfessionals();
                    showNotification('‚úÖ Profesional desbloqueado exitosamente');
                    
                } catch (error) {
                    console.error('Error desbloqueando profesional:', error);
                    alert('Error al desbloquear profesional: ' + error.message);
                }
            }
        };

        // Trabajos
        async function loadJobs() {
            const statusFilter = document.getElementById('filterJobStatus').value;
            const dateFilter = document.getElementById('filterJobDateFrom').value;
            const tbody = document.getElementById('jobsTable');
            
            // Mostrar loader
            tbody.innerHTML = '';
            document.getElementById('jobsLoader').style.display = 'block';
            
            try {
                let query = db.collection('jobs').orderBy('createdAt', 'desc');
                
                if (statusFilter) {
                    query = query.where('status', '==', statusFilter);
                }
                
                const snapshot = await query.limit(100).get();
                
                // Ocultar loader
                document.getElementById('jobsLoader').style.display = 'none';
                
                if (snapshot.empty) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 40px; color: #666;">
                                No se encontraron trabajos con los filtros seleccionados
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                let html = '';
                snapshot.forEach(doc => {
                    const job = doc.data();
                    const id = doc.id;
                    
                    // Filtrar por fecha
                    if (dateFilter && job.createdAt) {
                        const jobDate = job.createdAt?.toDate ? job.createdAt.toDate() : new Date(job.createdAt);
                        const filterDate = new Date(dateFilter);
                        if (jobDate < filterDate) return;
                    }
                    
                    const date = job.createdAt?.toDate ? job.createdAt.toDate().toLocaleDateString('es-AR') : '-';
                    const statusBadge = `<span class="badge ${getStatusBadgeClass(job.status)}">${getStatusText(job.status)}</span>`;
                    
                    html += `
                        <tr>
                            <td>${date}</td>
                            <td>${job.professionalName || '-'}</td>
                            <td>${job.userName || '-'}<br>
                                <small>${job.userEmail || ''}</small>
                            </td>
                            <td>${job.serviceType || '-'}</td>
                            <td>${statusBadge}</td>
                            <td>
                                <button onclick="viewJobDetails('${id}')" class="btn btn-sm">üëÅ Ver</button>
                            </td>
                        </tr>
                    `;
                });
                
                tbody.innerHTML = html;
                
            } catch (error) {
                console.error('Error cargando trabajos:', error);
                document.getElementById('jobsLoader').style.display = 'none';
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px; color: var(--danger);">
                            Error cargando trabajos: ${error.message}
                        </td>
                    </tr>
                `;
            }
        }

        window.viewJobDetails = async function(id) {
            try {
                const doc = await db.collection('jobs').doc(id).get();
                if (!doc.exists) {
                    alert('Trabajo no encontrado');
                    return;
                }
                
                const job = doc.data();
                const date = job.createdAt?.toDate ? job.createdAt.toDate().toLocaleString('es-AR') : '-';
                
                let html = `
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div>
                            <h4 style="margin-bottom: 10px;">Informaci√≥n del Trabajo</h4>
                            <p><strong>Servicio:</strong> ${job.serviceType || '-'}</p>
                            <p><strong>Fecha:</strong> ${date}</p>
                            <p><strong>Estado:</strong> <span class="badge ${getStatusBadgeClass(job.status)}">${getStatusText(job.status)}</span></p>
                            ${job.price ? `<p><strong>Precio:</strong> $${job.price.toLocaleString('es-AR')}</p>` : ''}
                        </div>
                        <div>
                            <h4 style="margin-bottom: 10px;">Contacto</h4>
                            <p><strong>Profesional:</strong> ${job.professionalName || '-'}</p>
                            <p><strong>Tel√©fono:</strong> ${job.professionalPhone || '-'}</p>
                            <p><strong>Cliente:</strong> ${job.userName || '-'}</p>
                            <p><strong>Tel√©fono:</strong> ${job.userPhone || '-'}</p>
                        </div>
                    </div>
                    
                    ${job.description ? `
                        <div style="margin-top: 20px;">
                            <strong>Descripci√≥n:</strong><br>
                            <div style="background: #f8f9fa; padding: 15px; border-radius: var(--radius); margin-top: 10px;">
                                ${job.description}
                            </div>
                        </div>
                    ` : ''}
                    
                    ${job.address ? `
                        <div style="margin-top: 20px;">
                            <strong>Direcci√≥n:</strong> ${job.address}
                        </div>
                    ` : ''}
                    
                    ${job.rated ? `
                        <div style="margin-top: 20px; background: #e8f5e8; padding: 15px; border-radius: var(--radius);">
                            <strong>Calificado:</strong> ${job.rating || 'Sin calificaci√≥n'} ‚≠ê
                            ${job.comment ? `<br><strong>Comentario:</strong> "${job.comment}"` : ''}
                        </div>
                    ` : ''}
                `;
                
                document.getElementById('jobDetails').innerHTML = html;
                document.getElementById('jobModal').classList.add('active');
                
            } catch (error) {
                console.error('Error cargando detalles:', error);
                alert('Error al cargar detalles del trabajo');
            }
        };

        window.closeJobModal = function() {
            document.getElementById('jobModal').classList.remove('active');
        };

        // Notificaciones
        async function loadNotifications() {
            const typeFilter = document.getElementById('filterNotificationType').value;
            const container = document.getElementById('notificationsList');
            
            // Mostrar loader
            container.innerHTML = '<div class="loader" id="notificationsLoader"></div>';
            
            try {
                let query = db.collection('admin_notifications').orderBy('createdAt', 'desc');
                
                if (typeFilter) {
                    query = query.where('type', '==', typeFilter);
                }
                
                const snapshot = await query.limit(50).get();
                
                container.innerHTML = '';
                
                if (snapshot.empty) {
                    container.innerHTML = '<p style="color: var(--gray); text-align: center; padding: 2rem;">No hay notificaciones.</p>';
                    return;
                }
                
                snapshot.forEach(doc => {
                    const notif = doc.data();
                    const id = doc.id;
                    const date = notif.createdAt?.toDate ? notif.createdAt.toDate().toLocaleString('es-AR') : '-';
                    
                    let typeText = '';
                    let icon = '';
                    let bgColor = '#fff3cd';
                    
                    switch(notif.type) {
                        case 'account_blocked':
                            typeText = 'Cuenta Bloqueada';
                            icon = 'üî¥';
                            bgColor = '#f8d7da';
                            break;
                        case 'job_overdue':
                            typeText = 'Trabajo Vencido';
                            icon = '‚ö†Ô∏è';
                            bgColor = '#fff3cd';
                            break;
                        default:
                            typeText = 'Sistema';
                            icon = '‚ÑπÔ∏è';
                            bgColor = '#d1ecf1';
                    }
                    
                    container.innerHTML += `
                        <div style="background: ${bgColor}; border-radius: var(--radius); padding: 1.5rem; margin-bottom: 1rem; border-left: 4px solid var(--warning);">
                            <div style="display: flex; justify-content: space-between; align-items: start;">
                                <div>
                                    <h4 style="margin: 0;">${icon} ${typeText}</h4>
                                    <p style="margin: 0.5rem 0;">${notif.reason || notif.message || ''}</p>
                                    <small style="color: var(--gray);">${date}</small>
                                </div>
                                <button onclick="deleteNotification('${id}')" class="btn btn-sm btn-danger">üóëÔ∏è</button>
                            </div>
                            ${notif.professionalName ? `<p style="margin-top: 10px;"><strong>Profesional:</strong> ${notif.professionalName}</p>` : ''}
                        </div>
                    `;
                });
                
            } catch (error) {
                console.error('Error cargando notificaciones:', error);
                container.innerHTML = '<p style="color: var(--danger); text-align: center; padding: 2rem;">Error cargando notificaciones</p>';
            }
        }

        window.deleteNotification = async function(id) {
            if (confirm('¬øEliminar esta notificaci√≥n?')) {
                await db.collection('admin_notifications').doc(id).delete();
                loadNotifications();
            }
        };

        window.clearAllNotifications = async function() {
            if (confirm('¬øEliminar todas las notificaciones? Esta acci√≥n no se puede deshacer.')) {
                const snapshot = await db.collection('admin_notifications').get();
                const batch = db.batch();
                
                snapshot.forEach(doc => {
                    batch.delete(doc.ref);
                });
                
                await batch.commit();
                loadNotifications();
            }
        };

        // Certificaciones
        async function loadCertifications() {
            const statusFilter = document.getElementById('filterCertificationStatus').value;
            const tbody = document.getElementById('certificationsTable');
            
            // Mostrar loader
            tbody.innerHTML = '';
            document.getElementById('certificationsLoader').style.display = 'block';
            
            try {
                const query = db.collection('certifications')
                    .where('status', '==', statusFilter)
                    .orderBy('createdAt', 'desc');
                
                const snapshot = await query.get();
                
                // Ocultar loader
                document.getElementById('certificationsLoader').style.display = 'none';
                
                if (snapshot.empty) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 40px; color: #666;">
                                No se encontraron certificaciones ${statusFilter === 'pendiente' ? 'pendientes' : statusFilter}
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                for (const doc of snapshot.docs) {
                    const cert = doc.data();
                    const id = doc.id;
                    
                    // Obtener informaci√≥n del profesional
                    let professionalName = 'Desconocido';
                    let professionalEmail = '';
                    
                    try {
                        const profDoc = await db.collection('professionals').doc(cert.professionalId).get();
                        if (profDoc.exists) {
                            const profData = profDoc.data();
                            professionalName = profData.name || 'Desconocido';
                            professionalEmail = profData.email || '';
                        }
                    } catch (error) {
                        console.error('Error obteniendo profesional:', error);
                    }
                    
                    const date = cert.createdAt?.toDate ? cert.createdAt.toDate().toLocaleDateString('es-AR') : '-';
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>
                            <strong>${professionalName}</strong><br>
                            <small>${professionalEmail}</small>
                        </td>
                        <td>${cert.title}</td>
                        <td>${cert.institution}</td>
                        <td>${date}</td>
                        <td>
                            <span class="badge ${cert.status === 'aprobada' ? 'badge-success' : cert.status === 'rechazada' ? 'badge-danger' : 'badge-warning'}">
                                ${cert.status === 'aprobada' ? 'APROBADA' : cert.status === 'rechazada' ? 'RECHAZADA' : 'PENDIENTE'}
                            </span>
                        </td>
                        <td>
                            <div class="btn-group">
                                ${cert.status === 'pendiente' ? `
                                    <button onclick="approveCertification('${id}')" class="btn btn-success btn-sm">‚úÖ Aprobar</button>
                                    <button onclick="rejectCertification('${id}')" class="btn btn-danger btn-sm">‚ùå Rechazar</button>
                                ` : ''}
                                ${cert.documentUrl ? `
                                    <button onclick="window.open('${cert.documentUrl}', '_blank')" class="btn btn-sm">üìÑ Ver</button>
                                ` : ''}
                            </div>
                        </td>
                    `;
                    tbody.appendChild(row);
                }
                
            } catch (error) {
                console.error('Error cargando certificaciones:', error);
                document.getElementById('certificationsLoader').style.display = 'none';
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px; color: var(--danger);">
                            Error cargando certificaciones: ${error.message}
                        </td>
                    </tr>
                `;
            }
        }

        window.approveCertification = async function(id) {
            if (confirm('¬øAprobar esta certificaci√≥n?')) {
                try {
                    const certDoc = await db.collection('certifications').doc(id).get();
                    const cert = certDoc.data();
                    
                    await db.collection('certifications').doc(id).update({
                        status: 'aprobada',
                        approvedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    // Actualizar perfil del profesional
                    await db.collection('professionals').doc(cert.professionalId).update({
                        certifications: firebase.firestore.FieldValue.arrayUnion({
                            title: cert.title,
                            institution: cert.institution,
                            documentUrl: cert.documentUrl,
                            approvedAt: new Date().toISOString()
                        }),
                        lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    loadCertifications();
                    showNotification('‚úÖ Certificaci√≥n aprobada exitosamente');
                    
                } catch (error) {
                    console.error('Error aprobando certificaci√≥n:', error);
                    alert('Error al aprobar certificaci√≥n: ' + error.message);
                }
            }
        };

        window.rejectCertification = async function(id) {
            if (confirm('¬øRechazar esta certificaci√≥n?')) {
                try {
                    const certDoc = await db.collection('certifications').doc(id).get();
                    const cert = certDoc.data();
                    
                    await db.collection('certifications').doc(id).update({
                        status: 'rechazada',
                        rejectedAt: firebase.firestore.FieldValue.serverTimestamp(),
                        rejectionReason: prompt('Ingrese el motivo del rechazo:', 'Documentaci√≥n insuficiente')
                    });
                    
                    loadCertifications();
                    showNotification('‚úÖ Certificaci√≥n rechazada');
                    
                } catch (error) {
                    console.error('Error rechazando certificaci√≥n:', error);
                    alert('Error al rechazar certificaci√≥n: ' + error.message);
                }
            }
        };

        // Banners
        async function loadBanners() {
            const tbody = document.getElementById('bannersTable');
            
            // Mostrar loader
            tbody.innerHTML = '';
            document.getElementById('bannersLoader').style.display = 'block';
            
            try {
                const snapshot = await db.collection('banners').orderBy('createdAt', 'desc').get();
                
                // Ocultar loader
                document.getElementById('bannersLoader').style.display = 'none';
                
                if (snapshot.empty) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="5" style="text-align: center; padding: 40px; color: #666;">
                                No hay banners creados
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                snapshot.forEach(doc => {
                    const banner = doc.data();
                    const id = doc.id;
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>
                            <img src="${banner.imageUrl}" 
                                 style="width: 100px; height: 60px; object-fit: cover; border-radius: 4px;"
                                 onerror="this.src='https://via.placeholder.com/100x60/2563eb/ffffff?text=BANNER'">
                        </td>
                        <td>${banner.link || '-'}</td>
                        <td>${banner.type === 'nacional' ? 'Nacional' : 'Provincial'}</td>
                        <td>
                            <span class="badge ${banner.active ? 'badge-success' : 'badge-danger'}">
                                ${banner.active ? 'ACTIVO' : 'INACTIVO'}
                            </span>
                        </td>
                        <td>
                            <div class="btn-group">
                                ${banner.active ? 
                                    `<button onclick="toggleBanner('${id}', false)" class="btn btn-warning btn-sm">üö´ Desactivar</button>` :
                                    `<button onclick="toggleBanner('${id}', true)" class="btn btn-success btn-sm">‚úÖ Activar</button>`
                                }
                                <button onclick="deleteBanner('${id}')" class="btn btn-danger btn-sm">üóëÔ∏è Eliminar</button>
                            </div>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
                
            } catch (error) {
                console.error('Error cargando banners:', error);
                document.getElementById('bannersLoader').style.display = 'none';
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 40px; color: var(--danger);">
                            Error cargando banners: ${error.message}
                        </td>
                    </tr>
                `;
            }
        }

        window.createBanner = async function() {
            const imageUrl = document.getElementById('bannerImageUrl').value.trim();
            const linkUrl = document.getElementById('bannerLinkUrl').value.trim();
            const type = document.getElementById('bannerType').value;
            
            if (!imageUrl) {
                alert('Por favor ingresa la URL de la imagen');
                return;
            }
            
            if (!linkUrl) {
                alert('Por favor ingresa la URL del enlace');
                return;
            }
            
            try {
                await db.collection('banners').add({
                    imageUrl,
                    link: linkUrl,
                    type,
                    active: true,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // Limpiar campos
                document.getElementById('bannerImageUrl').value = '';
                document.getElementById('bannerLinkUrl').value = '';
                
                loadBanners();
                showNotification('‚úÖ Banner creado exitosamente');
                
            } catch (error) {
                console.error('Error creando banner:', error);
                alert('Error al crear banner: ' + error.message);
            }
        };

        window.toggleBanner = async function(id, activate) {
            try {
                await db.collection('banners').doc(id).update({
                    active: activate,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                loadBanners();
                showNotification(`‚úÖ Banner ${activate ? 'activado' : 'desactivado'} exitosamente`);
            } catch (error) {
                console.error('Error actualizando banner:', error);
                alert('Error al actualizar banner: ' + error.message);
            }
        };

        window.deleteBanner = async function(id) {
            if (confirm('¬øEst√°s seguro de eliminar este banner?')) {
                try {
                    await db.collection('banners').doc(id).delete();
                    loadBanners();
                    showNotification('‚úÖ Banner eliminado exitosamente');
                } catch (error) {
                    console.error('Error eliminando banner:', error);
                    alert('Error al eliminar banner: ' + error.message);
                }
            }
        };

        // Sistema
        function loadSystemInfo() {
            document.getElementById('lastUpdate').textContent = new Date().toLocaleString('es-AR');
        }

        async function saveSystemConfig() {
            const name = document.getElementById('systemName').value;
            const email = document.getElementById('systemEmail').value;
            const phone = document.getElementById('systemPhone').value;
            
            try {
                await db.collection('system_config').doc('general').set({
                    name,
                    email,
                    phone,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                }, { merge: true });
                
                showNotification('‚úÖ Configuraci√≥n guardada exitosamente');
                
            } catch (error) {
                console.error('Error guardando configuraci√≥n:', error);
                alert('Error al guardar configuraci√≥n: ' + error.message);
            }
        }

        // Generar datos de prueba
        async function generateTestData() {
            if (!confirm('¬øGenerar datos de prueba? Esto agregar√° profesionales, trabajos y certificaciones de ejemplo.')) {
                return;
            }
            
            try {
                // Crear profesionales de prueba
                const testProfessionals = [
                    {
                        name: "Juan P√©rez",
                        email: "juan@ejemplo.com",
                        phone: "3415551234",
                        provincia: "Santa Fe",
                        ciudad: "Rosario",
                        rubros: ["plomeria", "electricidad"],
                        bio: "Plomero con 10 a√±os de experiencia",
                        averageRating: 4.5,
                        totalRatings: 12,
                        completedJobs: 45,
                        profileCompleted: true,
                        active: true,
                        blocked: false,
                        photoUrl: "https://randomuser.me/api/portraits/men/32.jpg",
                        createdAt: new Date()
                    },
                    {
                        name: "Mar√≠a L√≥pez",
                        email: "maria@ejemplo.com",
                        phone: "3415555678",
                        provincia: "Buenos Aires",
                        ciudad: "CABA",
                        rubros: ["gas", "aire"],
                        bio: "T√©cnica en refrigeraci√≥n certificada",
                        averageRating: 4.8,
                        totalRatings: 8,
                        completedJobs: 32,
                        profileCompleted: true,
                        active: true,
                        blocked: false,
                        photoUrl: "https://randomuser.me/api/portraits/women/44.jpg",
                        createdAt: new Date()
                    }
                ];
                
                for (const prof of testProfessionals) {
                    await db.collection('professionals').add(prof);
                }
                
                // Crear trabajos de prueba
                const testJobs = [
                    {
                        professionalName: "Juan P√©rez",
                        professionalPhone: "3415551234",
                        userName: "Cliente Test",
                        userEmail: "cliente@ejemplo.com",
                        userPhone: "3415559999",
                        serviceType: "plomeria",
                        description: "Reparaci√≥n de p√©rdida en ba√±o",
                        status: "completado",
                        price: 2500,
                        rated: false,
                        createdAt: new Date(Date.now() - 86400000), // Ayer
                        address: "Calle Falsa 123, Rosario"
                    },
                    {
                        professionalName: "Mar√≠a L√≥pez",
                        professionalPhone: "3415555678",
                        userName: "Otro Cliente",
                        userEmail: "otro@ejemplo.com",
                        userPhone: "3415558888",
                        serviceType: "aire",
                        description: "Mantenimiento de aire acondicionado",
                        status: "en_progreso",
                        price: 3500,
                        rated: false,
                        createdAt: new Date(),
                        address: "Av. Siempre Viva 456, CABA"
                    }
                ];
                
                for (const job of testJobs) {
                    await db.collection('jobs').add(job);
                }
                
                // Crear certificaciones de prueba
                const testCerts = [
                    {
                        professionalId: (await db.collection('professionals').where('email', '==', 'juan@ejemplo.com').get()).docs[0]?.id,
                        title: "T√©cnico en Plomer√≠a",
                        institution: "Instituto T√©cnico Rosario",
                        status: "pendiente",
                        documentUrl: "https://ejemplo.com/certificado.pdf",
                        createdAt: new Date()
                    }
                ];
                
                for (const cert of testCerts) {
                    if (cert.professionalId) {
                        await db.collection('certifications').add(cert);
                    }
                }
                
                // Crear notificaciones de prueba
                const testNotifications = [
                    {
                        type: "system",
                        message: "Sistema inicializado correctamente",
                        createdAt: new Date()
                    }
                ];
                
                for (const notif of testNotifications) {
                    await db.collection('admin_notifications').add(notif);
                }
                
                // Actualizar dashboard
                loadDashboard();
                loadProfessionals();
                loadJobs();
                loadCertifications();
                loadNotifications();
                
                showNotification('‚úÖ Datos de prueba generados exitosamente');
                
            } catch (error) {
                console.error('Error generando datos de prueba:', error);
                alert('Error al generar datos de prueba: ' + error.message);
            }
        }

        async function clearTestData() {
            if (!confirm('¬øEliminar datos de prueba? Esto eliminar√° todos los datos generados para pruebas.')) {
                return;
            }
            
            try {
                // Eliminar profesionales de prueba
                const profSnapshot = await db.collection('professionals')
                    .where('email', 'in', ['juan@ejemplo.com', 'maria@ejemplo.com'])
                    .get();
                
                const batch = db.batch();
                profSnapshot.forEach(doc => {
                    batch.delete(doc.ref);
                });
                
                // Eliminar trabajos de prueba
                const jobsSnapshot = await db.collection('jobs')
                    .where('userEmail', 'in', ['cliente@ejemplo.com', 'otro@ejemplo.com'])
                    .get();
                
                jobsSnapshot.forEach(doc => {
                    batch.delete(doc.ref);
                });
                
                await batch.commit();
                
                // Actualizar vistas
                loadDashboard();
                loadProfessionals();
                loadJobs();
                
                showNotification('‚úÖ Datos de prueba eliminados');
                
            } catch (error) {
                console.error('Error eliminando datos de prueba:', error);
                alert('Error al eliminar datos de prueba: ' + error.message);
            }
        }

        // Utilidades
        function showMessage(elementId, text, type) {
            const el = document.getElementById(elementId);
            el.textContent = text;
            el.className = `message message-${type}`;
            el.style.display = 'block';
            
            // Ocultar despu√©s de 5 segundos
            setTimeout(() => {
                el.style.display = 'none';
            }, 5000);
        }

        function showNotification(text) {
            // Crear notificaci√≥n toast
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: var(--secondary);
                color: white;
                padding: 15px 20px;
                border-radius: var(--radius);
                box-shadow: var(--shadow-lg);
                z-index: 10000;
                animation: slideIn 0.3s ease;
            `;
            toast.textContent = text;
            document.body.appendChild(toast);
            
            // Remover despu√©s de 3 segundos
            setTimeout(() => {
                toast.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 300);
            }, 3000);
        }

        // A√±adir estilos para animaciones
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
